/*------------------------------------------------------------------------------------------------------/
| Program : INCLUDES_ACCELA_FUNCTIONS.js
| Event   : N/A
|
| Usage   : Accela Inc. Developed Master Script Functions.  This file should not be modified.  For custom
			includes make additions and overrides to the INCLUDES_CUSTOM script file.
|
| Notes   : For Application Submit Before see INCLUDES_ACCELA_FUNCTIONS_ASB
|
/------------------------------------------------------------------------------------------------------*/

var INCLUDE_VERSION = 3.0;

// Compressed Version

function activateTask(e){var t=false;var n="";if(arguments.length==2){n=arguments[1];t=true}var r=aa.workflow.getTaskItems(capId,e,n,null,null,null);if(r.getSuccess())var s=r.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in s){var o=s[i];if(o.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||o.getProcessCode().equals(n))){var u=o.getStepNumber();var a=o.getProcessID();if(t){aa.workflow.adjustTask(capId,u,a,"Y","N",null,null)}else{aa.workflow.adjustTask(capId,u,"Y","N",null,null)}logMessage("Activating Workflow Task: "+e);logDebug("Activating Workflow Task: "+e)}}}function activeLicense(e){if(e==null||aa.util.instanceOfString(e)){return false}var t=aa.expiration.activeLicensesByCapID(e);if(t.getSuccess()){return true}else{aa.print("ERROR: Failed to activate License with CAP("+e+"): "+t.getErrorMessage())}return false}function activeTasksCheck(){var e=aa.workflow.getTasks(capId);if(e.getSuccess())wfObj=e.getOutput();else{logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){fTask=wfObj[i];if(fTask.getActiveFlag().equals("Y"))return true}return false}function addAddressCondition(e,t,n,r,i,s){if(!e){var o=aa.address.getAddressByCapId(capId);if(o.getSuccess()){var u=o.getOutput();for(zz in u){if(u[zz].getRefAddressId()){var a=aa.addressCondition.addAddressCondition(u[zz].getRefAddressId(),t,r,i,null,null,s,n,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(a.getSuccess()){logDebug("Successfully added condition to reference Address "+u[zz].getRefAddressId()+"  ("+s+") "+r)}else{logDebug("**ERROR: adding condition to reference Address "+u[zz].getRefAddressId()+"  ("+s+"): "+a.getErrorMessage())}}}}}else{var a=aa.addressCondition.addAddressCondition(e,t,r,i,null,null,s,n,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(a.getSuccess()){logDebug("Successfully added condition to Address "+e+"  ("+s+") "+r)}else{logDebug("**ERROR: adding condition to Address "+e+"  ("+s+"): "+a.getErrorMessage())}}}function addAddressStdCondition(e,t,n){var r=false;cStatus="Applied";if(arguments.length>3)cStatus=arguments[3];if(!aa.capCondition.getStandardConditions){logDebug("addAddressStdCondition function is not available in this version of Accela Automation.")}else{standardConditions=aa.capCondition.getStandardConditions(t,n).getOutput();for(i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==t.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==n.toUpperCase()){standardCondition=standardConditions[i];r=true;if(!e){var s=aa.address.getAddressByCapId(capId);if(s.getSuccess()){var o=s.getOutput();for(zz in o){if(o[zz].getRefAddressId()){var u=aa.addressCondition.addAddressCondition(o[zz].getRefAddressId(),standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,null,systemUserObj,systemUserObj);if(u.getSuccess()){logDebug("Successfully added condition to reference Address "+o[zz].getRefAddressId()+" "+n)}else{logDebug("**ERROR: adding condition to reference Address "+o[zz].getRefAddressId()+" "+u.getErrorMessage())}}}}}else{var u=aa.addressCondition.addAddressCondition(e,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,null,systemUserObj,systemUserObj);if(u.getSuccess()){logDebug("Successfully added condition to Address "+e+" "+n)}else{logDebug("**ERROR: adding condition to Address "+e+" "+u.getErrorMessage())}}}}if(!r)logDebug("**WARNING: couldn't find standard condition for "+t+" / "+n)}function addAdHocTask(e,t,n){var r=capId;var i=currentUserID;if(arguments.length>3)i=arguments[3];if(arguments.length>4)r=arguments[4];var s=aa.person.getUser(i);if(!s.getSuccess()){logDebug("Could not find user to assign to");return false}var o=aa.workflow.getTasks(r).getOutput()[0].getTaskItem();o.setProcessCode(e);o.setTaskDescription(t);o.setDispositionNote(n);o.setProcessID(0);o.setAssignmentDate(aa.util.now());o.setDueDate(aa.util.now());o.setAssignedUser(s.getOutput());wf=aa.proxyInvoker.newInstance("com.accela.aa.workflow.workflow.WorkflowBusiness").getOutput();wf.createAdHocTaskItem(o);return true}function addAllFees(e,t,n,r){var i=aa.finance.getFeeItemList(null,e,null).getOutput();for(xx in i){var s=i[xx].getFeeCod();var o=aa.finance.createFeeItem(capId,e,s,t,n);if(o.getSuccess()){var u=o.getOutput();logMessage("Added Fee "+s+", Qty "+n);logDebug("The assessed fee Sequence Number "+u);if(r=="Y"){feeSeqList.push(u);paymentPeriodList.push(t)}}else{logDebug("**ERROR: assessing fee ("+s+"): "+o.getErrorMessage())}}}function addAppCondition(e,t,n,r,i,s){var o;if(arguments.length>5){o=aa.capCondition.addCapCondition(capId,e,n,r,sysDate,null,sysDate,null,null,i,systemUserObj,systemUserObj,t,currentUserID,"A",s)}else{o=aa.capCondition.addCapCondition(capId,e,n,r,sysDate,null,sysDate,null,null,i,systemUserObj,systemUserObj,t,currentUserID,"A")}if(o.getSuccess()){logDebug("Successfully added condition ("+i+") "+n);logDebug("Successfully added condition ("+i+") "+n)}else{logDebug("**ERROR: adding condition ("+i+"): "+o.getErrorMessage())}}function addASITable(e,t){var n=capId;if(arguments.length>2)n=arguments[2];var r=aa.appSpecificTableScript.getAppSpecificTableModel(n,e);if(!r.getSuccess()){logDebug("**WARNING: error retrieving app specific table "+e+" "+r.getErrorMessage());return false}var i=r.getOutput();var s=i.getAppSpecificTableModel();var o=s.getTableField();var u=s.getReadonlyField();for(thisrow in t){var a=s.getColumns();var f=a.iterator();while(f.hasNext()){var l=f.next();if(typeof t[thisrow][l.getColumnName()]=="object"){o.add(t[thisrow][l.getColumnName()].fieldValue);u.add(null)}else{o.add(t[thisrow][l.getColumnName()]);u.add(null)}}s.setTableField(o);s.setReadonlyField(u)}var c=aa.appSpecificTableScript.editAppSpecificTableInfos(s,n,currentUserID);if(!c.getSuccess()){logDebug("**WARNING: error adding record to ASI Table:  "+e+" "+c.getErrorMessage());return false}else logDebug("Successfully added record to ASI Table: "+e)}function addASITable4ACAPageFlow(e,t,n){var r=capId;if(arguments.length>3)r=arguments[3];var i=e.getTablesMap().values();var s=i.iterator();var o=false;while(s.hasNext()){var u=s.next();if(u.getTableName().equals(t)){o=true;break}}if(!o){logDebug("cannot update asit for ACA, no matching table name");return false}var a=aa.util.newArrayList();var f=aa.util.newArrayList();var l=-1;for(thisrow in n){var c=u.getColumns();var h=c.iterator();while(h.hasNext()){var p=h.next();if(typeof n[thisrow][p.getColumnName()]=="object"){var d=new Array(n[thisrow][p.getColumnName()].fieldValue?n[thisrow][p.getColumnName()].fieldValue:"",p);var v=aa.proxyInvoker.newInstance("com.accela.aa.aamain.appspectable.AppSpecificTableField",d).getOutput();v.setRowIndex(l);v.setFieldLabel(p.getColumnName());v.setFieldGroup(t.replace(/ /g,"+"));v.setReadOnly(n[thisrow][p.getColumnName()].readOnly.equals("Y"));a.add(v);f.add(n[thisrow][p.getColumnName()].readOnly)}else{var d=new Array(n[thisrow][p.getColumnName()]?n[thisrow][p.getColumnName()]:"",p);var v=aa.proxyInvoker.newInstance("com.accela.aa.aamain.appspectable.AppSpecificTableField",d).getOutput();v.setRowIndex(l);v.setFieldLabel(p.getColumnName());v.setFieldGroup(t.replace(/ /g,"+"));v.setReadOnly(false);a.add(v);f.add("N")}}l--;u.setTableField(a);u.setReadonlyField(f)}tssm=u;return e}function addContactStdCondition(e,t,n){var r=false;var s=new Date;var o=aa.date.transToJavaUtilDate(s.getTime());cStatus="Applied";if(arguments.length>3)cStatus=arguments[3];if(!aa.capCondition.getStandardConditions){logDebug("addAddressStdCondition function is not available in this version of Accela Automation.")}else{standardConditions=aa.capCondition.getStandardConditions(t,n).getOutput();for(i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==t.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==n.toUpperCase()){standardCondition=standardConditions[i];r=true;if(!e){var u=aa.people.getCapContactByCapID(capId);if(u.getSuccess()){var a=u.getOutput();for(var f in a){var l=a[f].getCapContactModel().getPeople().getRefContactNumber();if(l){var c=aa.commonCondition.getNewCommonConditionModel().getOutput();c.setServiceProviderCode(aa.getServiceProviderCode());c.setEntityType("CONTACT");c.setEntityID(l);c.setConditionDescription(standardCondition.getConditionDesc());c.setConditionGroup(standardCondition.getConditionGroup());c.setConditionType(standardCondition.getConditionType());c.setConditionComment(standardCondition.getConditionComment());c.setImpactCode(standardCondition.getImpactCode());c.setConditionStatus(cStatus);c.setAuditStatus("A");c.setIssuedByUser(systemUserObj);c.setIssuedDate(o);c.setEffectDate(o);c.setAuditID(currentUserID);var h=aa.commonCondition.addCommonCondition(c);if(h.getSuccess()){logDebug("Successfully added reference contact ("+l+") condition: "+n)}else{logDebug("**ERROR: adding reference contact ("+l+") condition: "+h.getErrorMessage())}}}}}else{var c=aa.commonCondition.getNewCommonConditionModel().getOutput();c.setServiceProviderCode(aa.getServiceProviderCode());c.setEntityType("CONTACT");c.setEntityID(e);c.setConditionDescription(standardCondition.getConditionDesc());c.setConditionGroup(standardCondition.getConditionGroup());c.setConditionType(standardCondition.getConditionType());c.setConditionComment(standardCondition.getConditionComment());c.setImpactCode(standardCondition.getImpactCode());c.setConditionStatus(cStatus);c.setAuditStatus("A");c.setIssuedByUser(systemUserObj);c.setIssuedDate(o);c.setEffectDate(o);c.setAuditID(currentUserID);var h=aa.commonCondition.addCommonCondition(c);if(h.getSuccess()){logDebug("Successfully added reference contact ("+e+") condition: "+n)}else{logDebug("**ERROR: adding reference contact ("+e+") condition: "+h.getErrorMessage())}}}}if(!r)logDebug("**WARNING: couldn't find standard condition for "+t+" / "+n)}function addCustomFee(e,t,n,r,i,s){var o=capId;if(s==null){s="FINAL"}var u=aa.finance.createFeeItem(o,e,t,s,r);if(u.getSuccess()){var a=u.getOutput();var f=aa.finance.getFeeItemByPK(o,a).getOutput().getF4FeeItem();f.setFeeDescription(n);if(i)f.setAccCodeL1(i);var l=aa.finance.editFeeItem(f);if(l.getSuccess()){logDebug("Added Custom Fee "+n)}else{logDebug("Error Adding Fee "+l.getErrorMessage())}}else{logDebug("Error Adding Fee "+u.getErrorMessage())}}function addFee(e,t,n,r,i){var s=capId;var o="";var u=new Array;var a=new Array;var f=null;if(arguments.length>5){s=arguments[5];o=" to specified CAP"}assessFeeResult=aa.finance.createFeeItem(s,t,e,n,r);if(assessFeeResult.getSuccess()){f=assessFeeResult.getOutput();logMessage("Successfully added Fee "+e+", Qty "+r+o);logDebug("The assessed fee Sequence Number "+f+o);if(i=="Y"&&arguments.length==5){feeSeqList.push(f);paymentPeriodList.push(n)}if(i=="Y"&&arguments.length>5){u.push(f);a.push(n);var l=aa.finance.createInvoice(s,u,a);if(l.getSuccess())logMessage("Invoicing assessed fee items"+o+" is successful.");else logDebug("**ERROR: Invoicing the fee items assessed"+o+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}updateFeeItemInvoiceFlag(f,i)}else{logDebug("**ERROR: assessing fee ("+e+"): "+assessFeeResult.getErrorMessage());f=null}return f}function addFeeWithExtraData(e,t,n,r,i,s,o,u,a){var f="";var l=new Array;var c=new Array;assessFeeResult=aa.finance.createFeeItem(s,t,e,n,r);if(assessFeeResult.getSuccess()){feeSeq=assessFeeResult.getOutput();logMessage("Successfully added Fee "+e+", Qty "+r+f);logDebug("The assessed fee Sequence Number "+feeSeq+f);fsm=aa.finance.getFeeItemByPK(s,feeSeq).getOutput().getF4FeeItem();if(o)fsm.setFeeNotes(o);if(u)fsm.setUdf1(u);if(a)fsm.setUdf2(a);aa.finance.editFeeItem(fsm);if(i=="Y"&&arguments.length==5){feeSeqList.push(feeSeq);paymentPeriodList.push(n)}if(i=="Y"&&arguments.length>5){l.push(feeSeq);c.push(n);var h=aa.finance.createInvoice(s,l,c);if(h.getSuccess())logMessage("Invoicing assessed fee items is successful.");else logDebug("**ERROR: Invoicing the fee items assessed was not successful.  Reason: "+invoiceResult.getErrorMessage())}}else{logDebug("**ERROR: assessing fee ("+e+"): "+assessFeeResult.getErrorMessage());return null}return feeSeq}function addGuideSheet(e,t,n){var r=null;var i=aa.proxyInvoker.newInstance("com.accela.aa.inspection.guidesheet.RGuideSheetBusiness").getOutput();if(i){r=i.getRGuideSheet(aa.getServiceProviderCode(),n)}var s=aa.proxyInvoker.newInstance("com.accela.aa.inspection.guidesheet.GGuideSheetBusiness").getOutput();if(r){var o=s.createGGuideSheet(e,r,t,"ADMIN");return o}}function addLicenseCondition(e,t,n,r,i){o=new Array;if(arguments.length==6){o.push(getRefLicenseProf(arguments[5]))}else{var s=aa.licenseScript.getLicenseProf(capId);if(s.getSuccess()){var o=s.getOutput()}else{logDebug("**ERROR: getting lic profs from Cap: "+s.getErrorMessage());return false}}for(var u in o){if(arguments.length==6)licSeq=o[u].getLicSeqNbr();else licSeq=o[u].getLicenseProfessionalModel().getLicSeqNbr();if(licSeq>=0){var a=aa.caeCondition.addCAECondition(licSeq,e,n,r,null,null,i,t,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(a.getSuccess()){logDebug("Successfully added licensed professional ("+licSeq+") condition ("+i+") "+n)}else{logDebug("**ERROR: adding licensed professional ("+licSeq+") condition ("+i+"): "+a.getErrorMessage())}}else logDebug("No reference link to license : "+o[u].getLicenseNbr())}}function addLicenseStdCondition(e,t,n){var r=false;cStatus="Applied";if(arguments.length>3)cStatus=arguments[3];if(!aa.capCondition.getStandardConditions){logDebug("addLicenseStdCondition function is not available in this version of Accela Automation.")}else{standardConditions=aa.capCondition.getStandardConditions(t,n).getOutput();for(i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==t.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==n.toUpperCase()){standardCondition=standardConditions[i];r=true;if(!e){var s=aa.licenseScript.getLicenseProf(capId);if(s.getSuccess()){var o=s.getOutput()}else{logDebug("**ERROR: getting lic profs from Cap: "+s.getErrorMessage());return false}for(var u in o)if(o[u].getLicenseProfessionalModel().getLicSeqNbr()){licSeq=o[u].getLicenseProfessionalModel().getLicSeqNbr();var a=aa.caeCondition.addCAECondition(licSeq,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(a.getSuccess()){logDebug("Successfully added licensed professional ("+licSeq+") condition: "+n)}else{logDebug("**ERROR: adding licensed professional ("+licSeq+") condition: "+a.getErrorMessage())}}}else{var a=aa.caeCondition.addCAECondition(e,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(a.getSuccess()){logDebug("Successfully added licensed professional ("+e+") condition: "+n)}else{logDebug("**ERROR: adding licensed professional ("+e+") condition: "+a.getErrorMessage())}}}}if(!r)logDebug("**WARNING: couldn't find standard condition for "+t+" / "+n)}function addLookup(e,t,n){var r=aa.bizDomain.getBizDomainByValue(e,t);if(r.getSuccess()){logDebug("Standard Choices Item "+e+" and Value "+t+" already exist.  Lookup is not added or updated.");return false}var i;if(e!=null&&e.length&&t!=null&&t.length&&n!=null&&n.length){var r=aa.bizDomain.createBizDomain(e,t,"A",n);if(r.getSuccess())logDebug("Successfully created Std Choice("+e+","+t+") = "+n);else logDebug("**ERROR creating Std Choice "+r.getErrorMessage())}else logDebug("Could not create std choice, one or more null values")}function addParameter(e,t,n){if(t!=null){if(n==null){n=""}e.put(t,n)}}function addParcelAndOwnerFromRefAddress(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.parcel.getPrimaryParcelByRefAddressID(e,"Y");if(n.getSuccess())var r=n.getOutput();else{logDebug("**ERROR: Failed to get primary parcel for ref Address "+e+" , "+n.getErrorMessage());return false}var i=aa.parcel.warpCapIdParcelModel2CapParcelModel(t,r).getOutput();var s=aa.parcel.createCapParcel(i);if(s.getSuccess())logDebug("created CAP Parcel");else{logDebug("**WARNING: Failed to create the cap Parcel "+s.getErrorMessage())}var o=aa.parcel.getParcelDailyByCapID(t,null);if(o.getSuccess())var u=o.getOutput();else{logDebug("**ERROR: Failed to get Parcel List "+o.getErrorMessage());return false}for(var a in u){var f=aa.owner.getOwnersByParcel(u[a]);if(f.getSuccess())var l=f.getOutput();else{logDebug("**ERROR: Failed to get Owner List "+f.getErrorMessage());return false}for(var c in l){l[c].setCapID(t);createOResult=aa.owner.createCapOwnerWithAPOAttribute(l[c]);if(createOResult.getSuccess())logDebug("Created CAP Owner");else{logDebug("**WARNING: Failed to create CAP Owner "+createOResult.getErrorMessage())}}}}function addParcelCondition(e,t,n,r,i,s){if(!e){var o=aa.parcel.getParcelandAttribute(capId,null);if(o.getSuccess()){var u=o.getOutput().toArray();for(zz in u){logDebug("Adding Condition to parcel #"+zz+" = "+u[zz].getParcelNumber());var a=aa.parcelCondition.addParcelCondition(u[zz].getParcelNumber(),t,r,i,null,null,s,n,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(a.getSuccess()){logMessage("Successfully added condition to Parcel "+u[zz].getParcelNumber()+"  ("+s+") "+r);logDebug("Successfully added condition to Parcel "+u[zz].getParcelNumber()+"  ("+s+") "+r)}else{logDebug("**ERROR: adding condition to Parcel "+u[zz].getParcelNumber()+"  ("+s+"): "+a.getErrorMessage())}}}}else{var a=aa.parcelCondition.addParcelCondition(e,t,r,i,null,null,s,n,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(a.getSuccess()){logMessage("Successfully added condition to Parcel "+e+"  ("+s+") "+r);logDebug("Successfully added condition to Parcel "+e+"  ("+s+") "+r)}else{logDebug("**ERROR: adding condition to Parcel "+e+"  ("+s+"): "+a.getErrorMessage())}}}function addParcelDistrict(e,t){if(!e){var n=aa.parcel.getParcelandAttribute(capId,null);if(n.getSuccess()){var r=n.getOutput().toArray();for(zz in r){apdResult=aa.parcel.addParceDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),r[zz].getParcelNumber(),t);if(!apdResult.getSuccess()){logDebug("**ERROR Adding District "+t+" to parcel #"+r[zz].getParcelNumber()+" : "+apdResult.getErrorMessage());return false}else logDebug("Successfully added district "+t+" to parcel #"+r[zz].getParcelNumber())}}}else{apdResult=aa.parcel.addParceDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),e,t);if(!apdResult.getSuccess()){logDebug("**ERROR Adding District "+t+" to parcel #"+e+" : "+apdResult.getErrorMessage());return false}else logDebug("Successfully added district "+t+" to parcel #"+e)}}function addParent(e){if(typeof e!="object"){var t=aa.cap.getCapID(e);if(t.getSuccess()){var n=t.getOutput()}else{logDebug("**ERROR: getting parent cap id ("+e+"): "+t.getErrorMessage());return false}}else{n=e}var r=aa.cap.createAppHierarchy(n,capId);if(r.getSuccess())logDebug("Successfully linked to Parent Application : "+e);else logDebug("**ERROR: linking to parent application parent cap id ("+e+"): "+r.getErrorMessage())}function addPublicUserLPsToRecord(e,t){var n=aa.publicUser.getPublicUserByPUser(t);if(!n.getSuccess()||!n.getOutput()){logDebug("**WARNING** couldn't find public user "+t+" "+n.getErrorMessage());return false}var r=n.getOutput().getUserSeqNum();var i=aa.licenseScript.getRefLicProfByOnlineUser(r);if(!i.getSuccess()||!i.getOutput()){logDebug("**WARNING** no associated LPs to publuc user "+t+" "+i.getErrorMessage());return false}var s=i.getOutput();for(var o in s){var u=s[o];var a=aa.licenseScript.associateLpWithCap(capId,u);if(!a.getSuccess()){logDebug("**WARNING** failed to associate LP "+u.getStateLicense+" to Record "+a.getErrorMessage())}else logDebug("Associated LP "+u.getStateLicense()+" to Record "+e.getCustomID())}}function addrAddCondition(e,t,n,r,i,s,o){if(o=="Y")var u=false;else var u=true;var a=false;if(!e){var f=aa.address.getAddressByCapId(capId);if(f.getSuccess()){var l;var c;var h;var p;var d=f.getOutput();e:for(zz in d){var v=d[zz].getRefAddressId();if(v==null){logDebug("No reference address ID found for Address "+zz);continue}if(u){var m;var g;var y;var b;h=aa.addressCondition.getAddressConditions(v);p=h.getOutput();if(p.length>0){for(bb in p){m=p[bb].getConditionType();g=p[bb].getConditionStatus();y=p[bb].getConditionDescription();b=p[bb].getImpactCode();if(m==null)m=" ";if(g==null)g=" ";if(y==null)y=" ";if(b==null)b=" ";if((t==null||t.toUpperCase()==m.toUpperCase())&&(n==null||n.toUpperCase()==g.toUpperCase())&&(r==null||r.toUpperCase()==y.toUpperCase())&&(s==null||s.toUpperCase()==b.toUpperCase())){logMessage("Condition already exists: New condition not added to Address ID "+v);logDebug("Condition already exists: New condition not added to Address ID "+v);continue e}}}}logDebug("Adding Condition to address "+zz+" = "+v);l=aa.addressCondition.addAddressCondition(v,t,r,i,null,null,s,n,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(l.getSuccess()){logMessage("Successfully added condition to Address ID "+v+"  ("+s+") "+r);logDebug("Successfully added condition to Address ID "+v+"  ("+s+") "+r);a=true}else{logDebug("**ERROR: adding condition to Address "+v+"  ("+s+"): "+l.getErrorMessage())}}}}else{if(u){var m;var g;var y;var b;h=aa.addressCondition.getAddressConditions(e);p=h.getOutput();if(p.length>0){for(bb in p){m=p[bb].getConditionType();g=p[bb].getConditionStatus();y=p[bb].getConditionDescription();b=p[bb].getImpactCode();if(m==null)m=" ";if(g==null)g=" ";if(y==null)y=" ";if(b==null)b=" ";if((t==null||t.toUpperCase()==m.toUpperCase())&&(n==null||n.toUpperCase()==g.toUpperCase())&&(r==null||r.toUpperCase()==y.toUpperCase())&&(s==null||s.toUpperCase()==b.toUpperCase())){logMessage("Condition already exists: New condition not added to Address ID "+e);logDebug("Condition already exists: New condition not added to Address ID "+e);return false}}}}var l=aa.addressCondition.addAddressCondition(e,t,r,i,null,null,s,n,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);if(l.getSuccess()){logMessage("Successfully added condition to Address ID "+e+"  ("+s+") "+r);logDebug("Successfully added condition to Address ID "+e+"  ("+s+") "+r);a=true}else{logDebug("**ERROR: adding condition to Address "+e+"  ("+s+"): "+l.getErrorMessage())}}return a}function addReferenceContactByName(e,t,n){var r=e;var i=t;var s=n;var o=aa.people.getPeopleByFMLName(r,i,s);if(o.getSuccess()){var u=o.getOutput();if(u==null){logDebug("No reference user found.");return false}logDebug("No. of reference contacts found: "+u.length)}else{logDebug("**ERROR: Failed to get reference contact record: "+o.getErrorMessage());return false}var a=aa.people.createCapContactWithRefPeopleModel(capId,u[0]);if(a.getSuccess()){logDebug("Contact successfully added to CAP.");var f=aa.people.getCapContactByCapID(capId);if(f.getSuccess()){var l=f.getOutput();var c=l.length;var h=l[c-1].getCapContactModel().getPeople().getContactSeqNumber();logDebug("Contact Nbr = "+h);return h}else{logDebug("**ERROR: Failed to get Contact Nbr: "+f.getErrorMessage());return false}}else{logDebug("**ERROR: Cannot add contact: "+a.getErrorMessage());return false}}function addressExistsOnCap(){var e=capId;if(arguments.length==1)e=arguments[0];var t=null;var n=aa.address.getAddressByCapId(e);if(n.getSuccess())var t=n.getOutput();else{logDebug("**ERROR: Failed to get Address object: "+n.getErrorType()+":"+n.getErrorMessage());return false}for(i in t){return true}return false}function addStdCondition(e,t){var n=capId;if(arguments.length==3){n=arguments[2]}if(!aa.capCondition.getStandardConditions){logDebug("addStdCondition function is not available in this version of Accela Automation.")}else{standardConditions=aa.capCondition.getStandardConditions(e,t).getOutput();for(i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==e.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==t.toUpperCase()){standardCondition=standardConditions[i];var r=aa.capCondition.addCapCondition(n,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),sysDate,null,sysDate,null,null,standardCondition.getImpactCode(),systemUserObj,systemUserObj,"Applied",currentUserID,"A",null,standardCondition.getDisplayConditionNotice(),standardCondition.getIncludeInConditionName(),standardCondition.getIncludeInShortDescription(),standardCondition.getInheritable(),standardCondition.getLongDescripton(),standardCondition.getPublicDisplayMessage(),standardCondition.getResolutionAction(),null,null,standardCondition.getConditionNbr(),standardCondition.getConditionGroup(),standardCondition.getDisplayNoticeOnACA(),standardCondition.getDisplayNoticeOnACAFee(),standardCondition.getPriority(),standardCondition.getConditionOfApproval());if(r.getSuccess()){logDebug("Successfully added condition ("+standardCondition.getConditionDesc()+")")}else{logDebug("**ERROR: adding condition ("+standardCondition.getConditionDesc()+"): "+r.getErrorMessage())}}}}function addTask(e,t,n){var r=capId;if(arguments.length>3)r=arguments[3];if(!n.toUpperCase().equals("P")&&!n.toUpperCase().equals("N")){logDebug("WARNING: Insert Task Type must be P or N");return false}var i;var s;var o=aa.workflow.getTask(r,e);if(o.getSuccess()){s=o.getOutput()}else{logDebug("WARNING: Failed to get task! Path = "+e+";"+o.getErrorMessage());return false}s.setTaskDescription(t);var u=aa.workflow.insertTask(s,n);if(u.getSuccess()){var a=s.getProcessID();var f=s.getStepNumber();var o=aa.workflow.getTask(r,f,a);if(o.getSuccess()){s=o.getOutput();logDebug("add task successful : inserted task name = "+s.getTaskDescription()+"; Process name = "+s.getProcessCode())}else{logDebug("WARNING: Failed to get task! Path = "+taskPath+";"+o.getErrorMessage());return false}}else{logDebug("WARNING: Failed to add task! Path = "+taskPath+";"+u.getErrorMessage());return false}return s}function addTimeAccountingRecord(e,t,n,r,i,s,o){if(!aa.timeAccounting.getTimeTypeByTimeTypeName){logDebug("addTimeAccountingRecordToWorkflow function required AA 7.1SP3 or higher.");return false}userRight=aa.userright.getUserRight(appTypeArray[0],e).getOutput();TimeAccountingResult=aa.timeAccounting.getTimeLogModel();if(TimeAccountingResult.getSuccess());TimeAccounting=TimeAccountingResult.getOutput();var u="N";if(o)u="Y";TimeAccounting.setAccessModel("N");TimeAccounting.setBillable(u);TimeAccounting.setCreatedBy(e);TimeAccounting.setCreatedDate(aa.date.getCurrentDate());TimeAccounting.setDateLogged(aa.date.parseDate(r));TimeAccounting.setEndTime(null);TimeAccounting.setEntryCost(0);TimeAccounting.setEntryPct(0);TimeAccounting.setEntryRate(0);TimeAccounting.setLastChangeDate(aa.date.getCurrentDate());TimeAccounting.setLastChangeUser(e);TimeAccounting.setMaterials(null);TimeAccounting.setMaterialsCost(0);TimeAccounting.setMilageTotal(0);TimeAccounting.setMileageEnd(0);TimeAccounting.setMileageStart(0);TimeAccounting.setNotation(null);if(s)TimeAccounting.setReference(s);else TimeAccounting.setReference("N/A");TimeAccounting.setStartTime(null);TimeAccounting.setTotalMinutes(60*i);var a="";if(i.indexOf(".")!=-1){var f="";f=i.substr(i.indexOf("."))*60;f=f.toString();if(f.length==1)f="0"+f;a=r+" "+i.substr(0,i.indexOf("."))+":"+f+":00"}else{a=r+" "+i+":00:00"}var l=aa.timeAccounting.getTimeTypeByTimeTypeName(n);if(!l.getSuccess()||!l.getOutput()){logDebug("**WARNING: error retrieving Timeaccounting type : "+n+" : "+l.getErrorMessage());return false}var c=aa.timeAccounting.getTimeGroupByTimeGroupName(t);if(!c.getSuccess()||!c.getOutput()){logDebug("**WARNING: error retrieving Timeaccounting group : "+t+" : "+c.getErrorMessage());return false}TimeAccounting.setTimeElapsed(aa.date.parseDate(a));TimeAccounting.setTimeGroupSeq(c.getOutput().getTimeGroupSeq());TimeAccounting.setTimeTypeSeq(l.getOutput().getTimeTypeSeq());TimeAccounting.setUserGroupSeqNbr(userRight.getGroupSeqNumber());TimeAccounting.setVehicleId(null);addResult=aa.timeAccounting.addTimeLogModel(TimeAccounting);if(addResult.getSuccess()){logDebug("Successfully added Time Accounting Record.")}else{logDebug("**ERROR: adding Time Accounting Record: "+addResult.getErrorMessage())}}function addTimeAccountingRecordToWorkflow(e,t,n,r,i,s,o,u,a){if(!aa.timeAccounting.getTimeTypeByTimeTypeName){logDebug("addTimeAccountingRecordToWorkflow function required AA 7.1SP3 or higher.");return false}userRight=aa.userright.getUserRight(appTypeArray[0],e).getOutput();TimeAccountingResult=aa.timeAccounting.getTimeLogModel();if(TimeAccountingResult.getSuccess());TimeAccounting=TimeAccountingResult.getOutput();var f="N";if(a)f="Y";TimeAccounting.setAccessModel("N");TimeAccounting.setBillable(f);TimeAccounting.setCreatedBy(e);TimeAccounting.setCreatedDate(aa.date.getCurrentDate());TimeAccounting.setDateLogged(aa.date.parseDate(r));TimeAccounting.setEndTime(null);TimeAccounting.setEntryCost(0);TimeAccounting.setEntryPct(0);TimeAccounting.setEntryRate(0);TimeAccounting.setLastChangeDate(aa.date.getCurrentDate());TimeAccounting.setLastChangeUser(currentUserID);TimeAccounting.setMaterials(null);TimeAccounting.setMaterialsCost(0);TimeAccounting.setMilageTotal(0);TimeAccounting.setMileageEnd(0);TimeAccounting.setMileageStart(0);TimeAccounting.setNotation(null);TimeAccounting.setReference(s);TimeAccounting.setStartTime(null);TimeAccounting.setTotalMinutes(60*i);var l="";if(i.indexOf(".")!=-1){var c="";c=i.substr(i.indexOf("."))*60;c=c.toString();if(c.length==1)c="0"+c;l=r+" "+i.substr(0,i.indexOf("."))+":"+c+":00"}else{l=r+" "+i+":00:00"}var h=aa.timeAccounting.getTimeTypeByTimeTypeName(n);if(!h.getSuccess()||!h.getOutput()){logDebug("**WARNING: error retrieving Timeaccounting type : "+n+" : "+h.getErrorMessage());return false}var p=aa.timeAccounting.getTimeGroupByTimeGroupName(t);if(!p.getSuccess()||!p.getOutput()){logDebug("**WARNING: error retrieving Timeaccounting group : "+t+" : "+p.getErrorMessage());return false}TimeAccounting.setTimeElapsed(aa.date.parseDate(l));TimeAccounting.setTimeGroupSeq(p.getOutput().getTimeGroupSeq());TimeAccounting.setTimeTypeSeq(h.getOutput().getTimeTypeSeq());TimeAccounting.setUserGroupSeqNbr(userRight.getGroupSeqNumber());TimeAccounting.setVehicleId(null);var d=loadTasks(s);var v=null;for(var m in d)if(m.equals(o)&&(!u||d[m].process.equals(u))){v=TimeAccounting.getTimeLogModel();v.setEntityId(d[m].step+":"+d[m].processID);v.setEntityType("WORKFLOW");v.setCapIDModel(s)}if(v){addResult=aa.timeAccounting.addTimeLogModel(TimeAccounting);if(addResult.getSuccess()){logDebug("Successfully added Time Accounting Record to task: "+o)}else{logDebug("**WARNING: error adding Time Accounting Record to task: "+addResult.getErrorMessage())}}else{logDebug("**WARNING: error adding Time Accounting Record: task "+o+", process "+u+" not found.")}}function addToASITable(e,t){itemCap=capId;if(arguments.length>2)itemCap=arguments[2];var n=aa.appSpecificTableScript.getAppSpecificTableModel(itemCap,e);if(!n.getSuccess()){logDebug("**WARNING: error retrieving app specific table "+e+" "+n.getErrorMessage());return false}var r=n.getOutput();var i=r.getAppSpecificTableModel();var s=i.getTableField();var o=i.getColumns();var u=i.getReadonlyField();var a=o.iterator();while(a.hasNext()){colname=a.next();if(typeof t[colname.getColumnName()]=="object"){s.add(t[colname.getColumnName()].fieldValue);u.add(t[colname.getColumnName()].readOnly)}else{s.add(t[colname.getColumnName()]);u.add(null)}}i.setTableField(s);i.setReadonlyField(u);addResult=aa.appSpecificTableScript.editAppSpecificTableInfos(i,itemCap,currentUserID);if(!addResult.getSuccess()){logDebug("**WARNING: error adding record to ASI Table:  "+e+" "+addResult.getErrorMessage());return false}else logDebug("Successfully added record to ASI Table: "+e)}function allTasksComplete(e){var t=new Array;for(var n=1;n<arguments.length;n++)t.push(arguments[n]);var r=aa.workflow.getTasks(capId);if(r.getSuccess()){taskArr=r.getOutput()}else{logDebug("**ERROR: getting tasks : "+r.getErrorMessage());return false}for(xx in taskArr)if(taskArr[xx].getProcessCode().equals(e)&&taskArr[xx].getActiveFlag().equals("Y")&&!exists(taskArr[xx].getTaskDescription(),t))return false;return true}function appHasCondition(e,t,n,r){if(e==null)var i=aa.capCondition.getCapConditions(capId);else var i=aa.capCondition.getCapConditions(capId,e);if(i.getSuccess())var s=i.getOutput();else{logMessage("**ERROR: getting cap conditions: "+i.getErrorMessage());logDebug("**ERROR: getting cap conditions: "+i.getErrorMessage());return false}var o;var u;var a;for(cc in s){var f=s[cc];var o=f.getConditionStatus();var u=f.getConditionDescription();var a=f.getImpactCode();var l=f.getConditionType();if(o==null)o=" ";if(u==null)u=" ";if(a==null)a=" ";if((t==null||t.toUpperCase().equals(o.toUpperCase()))&&(n==null||n.toUpperCase().equals(u.toUpperCase()))&&(r==null||r.toUpperCase().equals(a.toUpperCase())))return true}return false}function applyPayments(){var e=aa.finance.getPaymentByCapID(capId,null);if(!e.getSuccess()){logDebug("**ERROR: error retrieving payments "+e.getErrorMessage());return false}var t=e.getOutput();for(var n in t){var r=t[n];var i=r.getAmountNotAllocated();var s=r.getPaymentStatus();if(i<=0)continue;if(s!="Paid")continue;var o=aa.finance.getFeeItemByCapID(capId);if(!o.getSuccess()){logDebug("**ERROR: error retrieving fee items "+o.getErrorMessage());return false}var u=o.getOutput();for(var a in u){var f=u[a];var l=0;var c=aa.finance.getPaymentFeeItems(capId,null);if(f.getFeeitemStatus()!="INVOICED")continue;if(!c.getSuccess()){logDebug("**ERROR: error retrieving fee payment items items "+c.getErrorMessage());return false}var h=c.getOutput();for(ij in h)if(f.getFeeSeqNbr()==h[ij].getFeeSeqNbr())l+=h[ij].getFeeAllocation();var p=f.getFee()-l;if(p<=0)continue;var d=new Array;var v=new Array;var m=new Array;var g=aa.finance.getFeeItemInvoiceByFeeNbr(capId,f.getFeeSeqNbr(),null);if(!g.getSuccess()){logDebug("**ERROR: error retrieving invoice items "+g.getErrorMessage());return false}var y=g.getOutput();if(y.length!=1){logDebug("**WARNING: fee item "+f.getFeeSeqNbr()+" returned "+y.length+" invoice matches")}else{d.push(f.getFeeSeqNbr());v.push(y[0].getInvoiceNbr());if(p>i)m.push(i);else m.push(p);applyResult=aa.finance.applyPayment(capId,r,d,v,m,"NA","NA","0");if(applyResult.getSuccess()){i=i-m[0];logDebug("Applied $"+m[0]+" to fee code "+f.getFeeCod()+".  Payment Balance: $"+i)}else{logDebug("**ERROR: error applying payment "+applyResult.getErrorMessage());return false}}if(i<=0)break}}}function appMatch(e){var t=appTypeArray;if(arguments.length==2){matchCapParm=arguments[1];if(typeof matchCapParm=="string")matchCapId=aa.cap.getCapID(matchCapParm).getOutput();else matchCapId=matchCapParm;if(!matchCapId){logDebug("**WARNING: CapId passed to appMatch was not valid: "+arguments[1]);return false}matchCap=aa.cap.getCap(matchCapId).getOutput();t=matchCap.getCapType().toString().split("/")}var n=true;var r=e.split("/");if(r.length!=4)logDebug("**ERROR in appMatch.  The following Application Type String is incorrectly formatted: "+e);else for(xx in r)if(!r[xx].equals(t[xx])&&!r[xx].equals("*"))n=false;return n}function appNameIsUnique(e,t,n){var r=aa.cap.getByAppType(e,t);if(r.getSuccess())var i=r.getOutput();else{logDebug("**ERROR: getting caps by app type: "+r.getErrorMessage());return null}for(aps in i){var s=aa.cap.getCap(i[aps].getCapID()).getOutput();if(s.getSpecialText())if(s.getSpecialText().toUpperCase().equals(n.toUpperCase())&&!capIDString.equals(i[aps].getCapID().getCustomID()))return false}return true}function asiTableValObj(e,t,n){this.columnName=e;this.fieldValue=t;this.readOnly=n;this.hasValue=Boolean(t!=null&t!="");asiTableValObj.prototype.toString=function(){return this.hasValue?String(this.fieldValue):String("")}}function assignCap(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();iNameResult=aa.person.getUser(e);if(!iNameResult.getSuccess()){logDebug("**ERROR retrieving  user model "+e+" : "+iNameResult.getErrorMessage());return false}iName=iNameResult.getOutput();cd.setAsgnDept(iName.getDeptOfUser());cd.setAsgnStaff(e);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("Assigned CAP to "+e)}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function assignInspection(e,t){var n=capId;if(arguments.length>2)n=arguments[2];iObjResult=aa.inspection.getInspection(n,e);if(!iObjResult.getSuccess()){logDebug("**WARNING retrieving inspection "+e+" : "+iObjResult.getErrorMessage());return false}iObj=iObjResult.getOutput();iInspector=aa.person.getUser(t).getOutput();if(!iInspector){var r=aa.people.getDepartmentList(null).getOutput();for(var i in r){var s=r[i];if(t.equals(s.getDeptName())){iNameResult=aa.person.getUser(null,null,null,null,s.getAgencyCode(),s.getBureauCode(),s.getDivisionCode(),s.getSectionCode(),s.getGroupCode(),s.getOfficeCode());if(!iNameResult.getSuccess()){logDebug("**WARNING retrieving department user model "+t+" : "+iNameResult.getErrorMessage());return false}iInspector=iNameResult.getOutput()}}}if(!iInspector){logDebug("**WARNING could not find inspector or department: "+t+", no assignment was made");return false}logDebug("assigning inspection "+e+" to "+t);iObj.setInspector(iInspector);if(iObj.getScheduledDate()==null){iObj.setScheduledDate(sysDate)}aa.inspection.editInspection(iObj)}function assignTask(e,t){var n=false;var r="";if(arguments.length==3){r=arguments[2];n=true}var s=aa.person.getUser(t);if(s.getSuccess())taskUserObj=s.getOutput();else{logMessage("**ERROR: Failed to get user object: "+s.getErrorMessage());return false}var o=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(o.getSuccess())var u=o.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in u){var a=u[i];if(a.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!n||a.getProcessCode().equals(r))){a.setAssignedUser(taskUserObj);var f=a.getTaskItem();var l=aa.workflow.assignTask(f);logMessage("Assigned Workflow Task: "+e+" to "+t);logDebug("Assigned Workflow Task: "+e+" to "+t)}}}function associateRefContactAddressToRecordContact(e,t,n){if(e&&t&&n){var r=aa.address.createXRefContactAddressModel().getOutput();r.setCapID(e);r.setAddressID(n.getAddressID());r.setEntityID(aa.util.parseLong(t));r.setEntityType(n.getEntityType());var i=aa.address.createXRefContactAddress(r.getXRefContactAddressModel());if(i.getSuccess){logDebug("Successfully assocaited reference contact address to cap contact: "+t);return true}else{logDebug("Failed to associate reference contact address to cap: "+i.getErrorMessage());return false}}else{logDebug("Could not associate reference contact address no address model, capId or cap contact sequence number");return false}}function autoAssignInspection(e){iObjResult=aa.inspection.getInspection(capId,e);if(!iObjResult.getSuccess()){logDebug("**ERROR retrieving inspection "+e+" : "+iObjResult.getErrorMessage());return false}iObj=iObjResult.getOutput();inspTypeResult=aa.inspection.getInspectionType(iObj.getInspection().getInspectionGroup(),iObj.getInspectionType());if(!inspTypeResult.getSuccess()){logDebug("**ERROR retrieving inspection Type "+inspTypeResult.getErrorMessage());return false}inspTypeArr=inspTypeResult.getOutput();if(inspTypeArr==null||inspTypeArr.length==0){logDebug("**ERROR no inspection type found");return false}inspType=inspTypeArr[0];inspSeq=inspType.getSequenceNumber();inspSchedDate=iObj.getScheduledDate().getYear()+"-"+iObj.getScheduledDate().getMonth()+"-"+iObj.getScheduledDate().getDayOfMonth();logDebug(inspSchedDate);iout=aa.inspection.autoAssignInspector(capId.getID1(),capId.getID2(),capId.getID3(),inspSeq,inspSchedDate);if(!iout.getSuccess()){logDebug("**ERROR retrieving auto assign inspector "+iout.getErrorMessage());return false}inspectorArr=iout.getOutput();if(inspectorArr==null||inspectorArr.length==0){logDebug("**WARNING no auto-assign inspector found");return false}inspectorObj=inspectorArr[0];iObj.setInspector(inspectorObj);assignResult=aa.inspection.editInspection(iObj);if(!assignResult.getSuccess()){logDebug("**ERROR re-assigning inspection "+assignResult.getErrorMessage());return false}else logDebug("Successfully reassigned inspection "+iObj.getInspectionType()+" to user "+inspectorObj.getUserID())}function branch(e){doStandardChoiceActions(e,true,0)}function branchTask(e,t,n,r){var s=false;var o="";if(arguments.length==5){o=arguments[4];s=true}var u=aa.workflow.getTaskItems(capId,e,o,null,null,null);if(u.getSuccess())var a=u.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}if(!t)t="NA";for(i in a){var f=a[i];if(f.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||f.getProcessCode().equals(o))){var l=aa.date.getCurrentDate();var c=f.getStepNumber();var h=f.getProcessID();if(s)aa.workflow.handleDisposition(capId,c,h,t,l,r,n,systemUserObj,"B");else aa.workflow.handleDisposition(capId,c,t,l,r,n,systemUserObj,"B");logMessage("Closing Workflow Task: "+e+" with status "+t+", Branching...");logDebug("Closing Workflow Task: "+e+" with status "+t+", Branching...")}}}function callWebService(e,t){aa.env.setValue("wsScriptParameters",t);aa.env.setValue("wsScriptDebug","");aa.env.setValue("wsScriptMessage","");var n="";var r="";logDebug("Executing Web Service wsSubScript: "+e);aa.runScriptInNewTransaction(e);n=aa.env.getValue("wsScriptDebug");r=aa.env.getValue("wsScriptMessage");if(n!=""){logDebug("Debug from wsSubScript: "+e);logDebug(n)}if(r!=""){logDebug("Message from wsSubScript: "+e);logDebug(r)}}function capHasExpiredLicProf(e,t,n){var r;if(e==null||e==""){logDebug("Invalid expiration type parameter");return false}else{r=e.toUpperCase();if(!matches(r,"EXPIRE","INSURANCE","BUSINESS")){logDebug("Invalid expiration type parameter");return false}}var s=n;if(n==null||n=="")s=capId;var o=aa.licenseScript.getLicenseProf(capId);if(!o.getSuccess()){logDebug("Error getting CAP's license professional: "+o.getErrorMessage());return false}var u=new Date;var a=false;var f=o.getOutput();if(f){for(i in f){if(t==null||t==""||t.equals(f[i].getLicenseType())){var l=f[i].getLicenseNbr();var c=refLicProfGetDate(l,r);if(c<u){a=true;logMessage("WARNING: Licence # "+l+" expired on "+jsDateToMMDDYYYY(c));logDebug("Licence # "+l+" expired on "+jsDateToMMDDYYYY(c))}}}}else{logDebug("No licensed professionals found on CAP");return false}return a}function capIdsFilterByFileDate(e,t,n){if(e.length==0||e[0]==undefined){logDebug("Invalid 1st parameter");return false}var r=new Array;var i=new Date(t);var s=new Date(n);var o;var u;logDebug("Filtering CAP array by file date between "+t+" and "+n);for(y in e){o=aa.cap.getCap(e[y]).getOutput();u=convertDate(o.getFileDate());if(u>=i&&u<=s)r.push(e[y])}return r}function capIdsGetByAddr(){var e=aa.address.getAddressByCapId(capId);if(!e.getSuccess()){logDebug("**ERROR: getting CAP addresses: "+e.getErrorMessage());return false}var t=new Array;var t=e.getOutput();if(t.length==0||t==undefined){logDebug("The current CAP has no address.  Unable to get CAPs with the same address.");return false}var n=t[0].getStreetName();var r=t[0].getHouseNumberStart();var s=t[0].getStreetSuffix();var o=t[0].getZip();var u=t[0].getStreetDirection();if(u=="")u=null;if(s=="")s=null;if(o=="")o=null;if(r&&!isNaN(r)){r=parseInt(r)}else{r=null}var a=aa.cap.getCapListByDetailAddress(n,r,s,o,u,null);if(a.getSuccess())var f=a.getOutput();else{logDebug("**ERROR: getting similar addresses: "+a.getErrorMessage());return false}var l=new Array;for(i in f)l.push(f[i].getCapID());if(l)return l;else return false}function capIdsGetByParcel(e){if(e!=null)var t=e;else{var n=aa.parcel.getParcelandAttribute(capId,null);if(!n.getSuccess()){logDebug("**ERROR: Failed to get parcels: "+n.getErrorMessage());return false}var r=n.getOutput().toArray();if(r[0]==undefined){logDebug("Current CAP has no parcel");return false}var t=r[0].getParcelNumber()}n=aa.cap.getCapListByParcelID(t,aa.util.newQueryFormat());if(!n.getSuccess()){logDebug("**ERROR: Failed to get parcels: "+n.getErrorMessage());return false}var s=n.getOutput();var o=new Array;for(i in s)o.push(s[i].getCapID());if(o)return o;else return false}function capSet(e){this.refresh=function(){var e=aa.set.getSetByPK(this.id).getOutput();this.status=e.getSetStatus();this.setId=e.getSetID();this.name=e.getSetTitle();this.comment=e.getSetComment();this.model=e.getSetHeaderModel();this.statusComment=e.getSetStatusComment();var t=aa.set.getCAPSetMembersByPK(this.id);if(!t.getSuccess()){logDebug("**WARNING** error retrieving set members "+t.getErrorMessage())}else{this.members=t.getOutput().toArray();this.size=this.members.length;if(this.members.length>0)this.empty=false;logDebug("capSet: loaded set "+this.id+" of status "+this.status+" with "+this.size+" records")}};this.add=function(e){var t;if(arguments.length==2)t=arguments[1];var n=aa.set.add(this.id,e);if(t)this.updateMemberStatus(capId,t)};this.updateMemberStatus=function(e,t){var n=aa.set.getSetDetailsScriptModel().getOutput();n.setSetID(this.id);n.setID1(e.getID1());n.setID2(e.getID2());n.setID3(e.getID3());n.setSetMemberStatus(t);n.setSetMemberStatusDate(aa.date.getCurrentDate());n.setServiceProviderCode(aa.getServiceProviderCode());var r=aa.set.updateSetMemberStatus(n);if(!r.getSuccess()){logDebug("**WARNING** error adding record to set "+this.id+" : "+r.getErrorMessage())}else{logDebug("capSet: updated record "+e+" to status "+t)}};this.remove=function(e){var t=aa.set.removeSetHeadersListByCap(this.id,e);if(!t.getSuccess()){logDebug("**WARNING** error removing record from set "+this.id+" : "+t.getErrorMessage())}else{logDebug("capSet: removed record "+e+" from set "+this.id)}};this.update=function(){var e=aa.proxyInvoker.newInstance("com.accela.aa.aamain.cap.SetBusiness").getOutput();this.model.setSetStatus(this.status);this.model.setSetID(this.setId);this.model.setSetTitle(this.name);this.model.setSetComment(this.comment);this.model.setSetStatusComment(this.statusComment);this.model.setRecordSetType(this.type);logDebug("capSet: updating set header information");try{updateResult=e.updateSetBySetID(this.model)}catch(t){logDebug("**WARNING** error updating set header failed "+t.message)}};this.id=e;this.name=e;this.type=null;this.comment=null;if(arguments.length>1&&arguments[1])this.name=arguments[1];if(arguments.length>2&&arguments[2])this.type=arguments[2];if(arguments.length>3&&arguments[3])this.comment=arguments[3];this.size=0;this.empty=true;this.members=new Array;this.status="";this.statusComment="";this.model=null;var t=aa.set.getSetByPK(this.id);if(t.getSuccess()){this.refresh()}else{t=aa.set.createSet(this.id,this.name,this.type,this.comment);if(!t.getSuccess()){logDebug("**WARNING** error creating set "+this.id+" : "+t.getErrorMessage)}else{logDebug("capSet: Created new set "+this.id+" of type "+this.type);this.refresh()}}}function checkCapForLicensedProfessionalType(e){var t=aa.licenseScript.getLicenseProf(capId);if(t.getSuccess()){var n=t.getOutput();if(!n){logDebug("WARNING: no license professional available on the application:");return false}for(licProf in n){if(e.equals(n[licProf].getLicenseType())){aa.print("Found License Professional with Type= "+e);return true}}return false}else{aa.print("**ERROR: getting lic prof: "+t.getErrorMessage());return false}}function checkInspectionResult(e,t){var n=aa.inspection.getInspections(capId);if(n.getSuccess()){var r=n.getOutput();for(xx in r)if(String(e).equals(r[xx].getInspectionType())&&String(t).equals(r[xx].getInspectionStatus()))return true}return false}function checkRequiredASIFields(){var e=aa.appSpecificInfo.getByCapID(capId);var t=e.getOutput();var n=true;for(var r in t){if(t[r].getRequiredFlag()=="Y"){if(matches(t[r].checklistComment,null,undefined,"")){n=false}}}return n}function childGetByCapType(e,t){if(t!=null)var n=t;else var n=capId;if(arguments.length>2)var r=arguments[2];else var r=null;var i=e.split("/");if(i.length!=4)logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+e);var s=aa.cap.getChildByMasterID(n);if(s.getSuccess()){var o=s.getOutput();if(o.length){var u;var a="";var f;var l;for(xx in o){u=o[xx].getCapID();if(r!=null&&r.getCustomID().equals(u.getCustomID()))continue;a=aa.cap.getCap(u).getOutput().getCapType().toString();f=a.split("/");l=true;for(yy in f){if(!i[yy].equals(f[yy])&&!i[yy].equals("*")){l=false;break}}if(l)return u}}else logDebug("**WARNING: childGetByCapType function found no children");return false}else logDebug("**WARNING: childGetByCapType function found no children: "+s.getErrorMessage())}function closeCap(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();iNameResult=aa.person.getUser(e);if(!iNameResult.getSuccess()){logDebug("**ERROR retrieving  user model "+e+" : "+iNameResult.getErrorMessage());return false}iName=iNameResult.getOutput();cd.setClosedDept(iName.getDeptOfUser());cd.setClosedBy(e);r.setClosedDate(sysDate);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("Set CAP *Closed by Staff* to "+e)+"\nSet CAP *Closed by Dept* "+iName.getDeptOfUser()+"\nSet CAP *Closed Date* "+sysDate.toString()}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function closeSubWorkflow(e,t){var n=capId;if(arguments.length==3)n=arguments[2];var r=true;var s=aa.workflow.getTasks(n);if(s.getSuccess())var o=s.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in o){var u=o[i];if(u.getProcessID()==e&&u.getCompleteFlag()!="Y"){logDebug("closeSubWorkflow: found an incomplete task processID #"+e+" , Step# "+u.getStepNumber(),3);r=false}}if(!r)return false;var a=aa.workflow.getProcessRelationByCapID(n,null).getOutput();var f=null;for(thisRel in a)if(a[thisRel].getProcessID()==e)f=a[thisRel];if(!f){logDebug("closeSubWorkflow: did not find a process relation, exiting",3);return false}logDebug("executing handleDisposition:"+f.getStepNumber()+","+f.getParentProcessID()+","+t,3);var l=aa.workflow.handleDisposition(n,f.getStepNumber(),f.getParentProcessID(),t,sysDate,"Closed via script","Closed via script",systemUserObj,"Y");if(!l.getSuccess())logDebug("**WARNING: closing parent task: "+l.getErrorMessage());else logDebug("Closed parent task")}function closeTask(e,t,n,r){var s=false;var o="";if(arguments.length==5){o=arguments[4];s=true}var u=aa.workflow.getTaskItems(capId,e,o,null,null,null);if(u.getSuccess())var a=u.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}if(!t)t="NA";for(i in a){var f=a[i];if(f.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||f.getProcessCode().equals(o))){var l=aa.date.getCurrentDate();var c=f.getStepNumber();var h=f.getProcessID();if(s)aa.workflow.handleDisposition(capId,c,h,t,l,r,n,systemUserObj,"Y");else aa.workflow.handleDisposition(capId,c,t,l,r,n,systemUserObj,"Y");logMessage("Closing Workflow Task: "+e+" with status "+t);logDebug("Closing Workflow Task: "+e+" with status "+t)}}}function comment(e){if(showDebug)logDebug(e);if(showMessage)logMessage(e)}function comparePeopleGeneric(e){e.setAuditDate(null);e.setAuditID(null);e.setAuditStatus(null);e.setBirthDate(null);e.setBusName2(null);e.setBusinessName(null);e.setComment(null);e.setCompactAddress(null);e.setContactSeqNumber(null);e.setContactType(null);e.setContactTypeFlag(null);e.setCountry(null);e.setCountryCode(null);e.setEndBirthDate(null);e.setFax(null);e.setFaxCountryCode(null);e.setFein(null);e.setFirstName(null);e.setFlag(null);e.setFullName(null);e.setGender(null);e.setHoldCode(null);e.setHoldDescription(null);e.setId(null);e.setIvrPinNumber(null);e.setIvrUserNumber(null);e.setLastName(null);e.setMaskedSsn(null);e.setMiddleName(null);e.setNamesuffix(null);e.setPhone1(null);e.setPhone1CountryCode(null);e.setPhone2(null);e.setPhone2CountryCode(null);e.setPhone3(null);e.setPhone3CountryCode(null);e.setPostOfficeBox(null);e.setPreferredChannel(null);e.setPreferredChannelString(null);e.setRate1(null);e.setRelation(null);e.setSalutation(null);e.setServiceProviderCode(null);e.setSocialSecurityNumber(null);e.setTitle(null);e.setTradeName(null);var t=aa.people.getPeopleByPeopleModel(e);if(!t.getSuccess()){logDebug("WARNING: error searching for people : "+t.getErrorMessage());return false}var n=t.getOutput();if(n.length==0){logDebug("Searched for REF contact, no matches found, returing null");return null}if(n.length>0){logDebug("Searched for a REF Contact, "+n.length+" matches found! returning the first match : "+n[0].getContactSeqNumber());return n[0].getContactSeqNumber()}}function comparePeopleStandard(e){if(e.getSocialSecurityNumber()||e.getFein()){var t=aa.people.createPeopleModel().getOutput().getPeopleModel();logDebug("we have a SSN "+e.getSocialSecurityNumber()+" or FEIN, checking on that");t.setSocialSecurityNumber(e.getSocialSecurityNumber());t.setFein(e.getFein());var n=aa.people.getPeopleByPeopleModel(t);if(!n.getSuccess()){logDebug("WARNING: error searching for people : "+n.getErrorMessage());return false}var r=n.getOutput();if(r.length>0){logDebug("Searched for a REF Contact, "+r.length+" matches found! returning the first match : "+r[0].getContactSeqNumber());return r[0].getContactSeqNumber()}}if(e.getEmail()){var t=aa.people.createPeopleModel().getOutput().getPeopleModel();t.setServiceProviderCode(aa.getServiceProviderCode());logDebug("we have an email, checking on that");t.setEmail(e.getEmail());var n=aa.people.getPeopleByPeopleModel(t);if(!n.getSuccess()){logDebug("WARNING: error searching for people : "+n.getErrorMessage());return false}var r=n.getOutput();if(r.length>0){logDebug("Searched for a REF Contact, "+r.length+" matches found! returning the first match : "+r[0].getContactSeqNumber());return r[0].getContactSeqNumber()}}if(e.getBirthDate()&&e.getLastName()&&e.getFirstName()){var t=aa.people.createPeopleModel().getOutput().getPeopleModel();logDebug("we have a name and birthdate, checking on that");t.setBirthDate(e.getBirthDate());t.setLastName(e.getLastName());t.setFirstName(e.getFirstName());t.setMiddleName(e.getMiddleName());var n=aa.people.getPeopleByPeopleModel(t);if(!n.getSuccess()){logDebug("WARNING: error searching for people : "+n.getErrorMessage());return false}var r=n.getOutput();if(r.length>0){logDebug("Searched for a REF Contact, "+r.length+" matches found! returning the first match : "+r[0].getContactSeqNumber());return r[0].getContactSeqNumber()}}logDebug("ComparePeople did not find a match");return false}function completeCAP(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();iNameResult=aa.person.getUser(e);if(!iNameResult.getSuccess()){logDebug("**ERROR retrieving  user model "+e+" : "+iNameResult.getErrorMessage());return false}iName=iNameResult.getOutput();cd.setCompleteDept(iName.getDeptOfUser());cd.setCompleteStaff(e);r.setCompleteDate(sysDate);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("Set CAP *Completed by Staff* to "+e)+"\nSet CAP *Completed by Dept* "+iName.getDeptOfUser()+"\nSet CAP *Completed Date* "+sysDate.toString()}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function contactAddFromUser(e){if(arguments.length==1){var t=aa.person.getUser(e);if(t.getSuccess()){var n=t.getOutput();if(n==null){logDebug("**ERROR: Failed to get User");return false}}else{logDebug("**ERROR: Failed to get User: "+t.getErrorMessage());return false}}else var n=systemUserObj;var r=n.getFirstName();var i=n.getMiddleName();var s=n.getLastName();var o=aa.people.getPeopleByFMLName(r,i,s);if(o.getSuccess()){var u=o.getOutput();if(u==null){logDebug("No reference user found.");return false}logDebug("No. of reference contacts found: "+u.length)}else{logDebug("**ERROR: Failed to get reference contact record: "+o.getErrorMessage());return false}var a=aa.people.createCapContactWithRefPeopleModel(capId,u[0]);if(a.getSuccess()){logDebug("Contact successfully added to CAP.");var f=aa.people.getCapContactByCapID(capId);if(f.getSuccess()){var l=f.getOutput();var c=l.length;var h=l[c-1].getCapContactModel().getPeople().getContactSeqNumber();logDebug("Contact Nbr = "+h);return h}else{logDebug("**ERROR: Failed to get Contact Nbr: "+f.getErrorMessage());return false}}else{logDebug("**ERROR: Cannot add contact: "+a.getErrorMessage());return false}}function contactObj(e){this.people=null;this.capContact=null;this.capContactScript=null;this.capId=null;this.type=null;this.seqNumber=null;this.refSeqNumber=null;this.asiObj=null;this.asi=new Array;this.primary=null;this.relation=null;this.addresses=null;this.validAttrs=false;this.capContactScript=e;if(e){if(e.getCapContactModel==undefined){this.people=this.capContactScript.getPeople();this.refSeqNumber=this.capContactScript.getRefContactNumber()}else{this.capContact=e.getCapContactModel();this.people=this.capContact.getPeople();this.refSeqNumber=this.capContact.getRefContactNumber();if(this.people.getAttributes()!=null){this.asiObj=this.people.getAttributes().toArray();if(this.asiObj!=null){for(var t in this.asiObj)this.asi[this.asiObj[t].attributeName]=this.asiObj[t];this.validAttrs=true}}}this.relation=this.people.relation;this.seqNumber=this.people.contactSeqNumber;this.type=this.people.getContactType();this.capId=this.capContactScript.getCapID();var n=aa.address.getContactAddressListByCapContact(this.capContact);if(n.getSuccess()){this.addresses=n.getOutput();var r=convertContactAddressModelArr(n.getOutput());this.people.setContactAddressList(r)}else{pmcal=this.people.getContactAddressList();if(pmcal){this.addresses=pmcal.toArray()}}}this.toString=function(){return this.capId+" : "+this.type+" "+this.people.getLastName()+","+this.people.getFirstName()+" (id:"+this.seqNumber+"/"+this.refSeqNumber+") #ofAddr="+this.addresses.length+" primary="+this.primary};this.getEmailTemplateParams=function(e){addParameter(e,"$$LastName$$",this.people.getLastName());addParameter(e,"$$FirstName$$",this.people.getFirstName());addParameter(e,"$$MiddleName$$",this.people.getMiddleName());addParameter(e,"$$BusinesName$$",this.people.getBusinessName());addParameter(e,"$$ContactSeqNumber$$",this.seqNumber);addParameter(e,"$$ContactType$$",this.type);addParameter(e,"$$Relation$$",this.relation);addParameter(e,"$$Phone1$$",this.people.getPhone1());addParameter(e,"$$Phone2$$",this.people.getPhone2());addParameter(e,"$$Email$$",this.people.getEmail());addParameter(e,"$$AddressLine1$$",this.people.getCompactAddress().getAddressLine1());addParameter(e,"$$AddressLine2$$",this.people.getCompactAddress().getAddressLine2());addParameter(e,"$$City$$",this.people.getCompactAddress().getCity());addParameter(e,"$$State$$",this.people.getCompactAddress().getState());addParameter(e,"$$Zip$$",this.people.getCompactAddress().getZip());addParameter(e,"$$Fax$$",this.people.getFax());addParameter(e,"$$Country$$",this.people.getCompactAddress().getCountry());addParameter(e,"$$FullName$$",this.people.getFullName());return e};this.replace=function(e){var t=this.type;if(arguments.length==2)t=arguments[1];var n=getContactObjs(e,[String(t)]);for(var r in n){var i=n[r];if(this.equals(n[r])){i.people.setContactType(t);aa.people.copyCapContactModel(this.capContact,i.capContact);i.people.setContactAddressList(this.people.getContactAddressList());overwriteResult=aa.people.editCapContactWithAttribute(i.capContact);if(overwriteResult.getSuccess())logDebug("overwrite contact "+i+" with "+this);else logDebug("error overwriting contact : "+this+" : "+overwriteResult.getErrorMessage());return true}}var s=this.capContact.getCapID();var o=this.type;this.people.setContactType(t);this.capContact.setCapID(e);createResult=aa.people.createCapContactWithAttribute(this.capContact);if(createResult.getSuccess())logDebug("(contactObj) contact created : "+this);else logDebug("(contactObj) error creating contact : "+this+" : "+createResult.getErrorMessage());this.capContact.setCapID(s);this.type=o;return true};this.equals=function(e){if(e==null)return false;if(!String(this.people.type).equals(String(e.people.type))){return false}if(!String(this.people.getFirstName()).equals(String(e.people.getFirstName()))){return false}if(!String(this.people.getLastName()).equals(String(e.people.getLastName()))){return false}if(!String(this.people.getFullName()).equals(String(e.people.getFullName()))){return false}if(!String(this.people.getBusinessName()).equals(String(e.people.getBusinessName()))){return false}return true};this.saveBase=function(){this.people.setContactType(this.type);this.capContact.setPrimaryFlag(this.primary?"Y":"N");this.people.setRelation(this.relation);saveResult=aa.people.editCapContact(this.capContact);if(saveResult.getSuccess())logDebug("(contactObj) base contact saved : "+this);else logDebug("(contactObj) error saving base contact : "+this+" : "+saveResult.getErrorMessage())};this.save=function(){this.people.setContactType(this.type);this.capContact.setPrimaryFlag(this.primary?"Y":"N");this.people.setRelation(this.relation);this.capContact.setPeople(this.people);saveResult=aa.people.editCapContactWithAttribute(this.capContact);if(saveResult.getSuccess())logDebug("(contactObj) contact saved : "+this);else logDebug("(contactObj) error saving contact : "+this+" : "+saveResult.getErrorMessage())};this.getAttribute=function(e){var t=null;if(this.validAttrs){var n=this.asi[e.toString().toUpperCase()];if(n!=null)t=n.getAttributeValue()}return t};this.setAttribute=function(e,t){var n=false;if(this.validAttrs){var r=this.asi[e.toString().toUpperCase()];if(r!=null){r.setAttributeValue(t);n=true}}return n};this.remove=function(){var e=aa.people.removeCapContact(this.capId,this.seqNumber);if(e.getSuccess())logDebug("(contactObj) contact removed : "+this+" from record "+this.capId.getCustomID());else logDebug("(contactObj) error removing contact : "+this+" : from record "+this.capId.getCustomID()+" : "+e.getErrorMessage())};this.isSingleAddressPerType=function(){if(this.addresses.length>1){var e=new Array;for(y in this.addresses){thisAddr=this.addresses[y];e[thisAddr.addressType]=0}for(yy in this.addresses){thisAddr=this.addresses[yy];e[thisAddr.addressType]+=1}for(z in e){if(e[z]>1)return false}}else{return true}return true};this.getAddressTypeCounts=function(){var e=new Array;for(y in this.addresses){thisAddr=this.addresses[y];e[thisAddr.addressType]=0}for(yy in this.addresses){thisAddr=this.addresses[yy];e[thisAddr.addressType]+=1}return e};this.createPublicUser=function(){if(!this.capContact.getEmail()){logDebug("(contactObj) Couldn't create public user for : "+this+", no email address");return false}if(String(this.people.getContactTypeFlag()).equals("organization")){logDebug("(contactObj) Couldn't create public user for "+this+", the contact is an organization");return false}var e=aa.publicUser.getPublicUserByEmail(this.capContact.getEmail());if(e.getSuccess()&&e.getOutput()){i=e.getOutput();logDebug("(contactObj) createPublicUserFromContact: Found an existing public user: "+i.getUserID())}if(!i){logDebug("(contactObj) CreatePublicUserFromContact: creating new user based on email address: "+this.capContact.getEmail());var t=aa.publicUser.getPublicUserModel();t.setFirstName(this.capContact.getFirstName());t.setLastName(this.capContact.getLastName());t.setEmail(this.capContact.getEmail());t.setUserID(this.capContact.getEmail());t.setPassword("e8248cbe79a288ffec75d7300ad2e07172f487f6");t.setAuditID("PublicUser");t.setAuditStatus("A");t.setCellPhone(this.people.getPhone2());var n=aa.publicUser.createPublicUser(t);if(n.getSuccess()){logDebug("(contactObj) Created public user "+this.capContact.getEmail()+"  sucessfully.");var r=n.getOutput();var i=aa.publicUser.getPublicUser(r).getOutput();aa.publicUser.createPublicUserForAgency(i);var s=aa.proxyInvoker.newInstance("com.accela.pa.pin.UserPINBusiness").getOutput();s.updateActiveStatusAndLicenseIssueDate4PublicUser(aa.getServiceProviderCode(),r,"ADMIN");var o=aa.publicUser.resetPassword(this.capContact.getEmail());if(o.getSuccess()){var u=o.getOutput();i.setPassword(u);logDebug("(contactObj) Reset password for "+this.capContact.getEmail()+"  sucessfully.")}else{logDebug("(contactObj **WARNING: Reset password for  "+this.capContact.getEmail()+"  failure:"+o.getErrorMessage())}aa.publicUser.sendActivateEmail(i,true,true);aa.publicUser.sendPasswordEmail(i)}else{logDebug("(contactObj) **WARNIJNG creating public user "+this.capContact.getEmail()+"  failure: "+n.getErrorMessage());return null}}if(this.refSeqNumber){logDebug("(contactObj) CreatePublicUserFromContact: Linking this public user with reference contact : "+this.refSeqNumber);aa.licenseScript.associateContactWithPublicUser(i.getUserSeqNum(),this.refSeqNumber)}return i};this.getCaps=function(){if(this.refSeqNumber){aa.print("ref seq : "+this.refSeqNumber);var e=null;var t=new Array;if(arguments.length==1)e=arguments[0];var n=aa.people.createPeopleModel().getOutput().getPeopleModel();var r=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.CapContactDAOOracle").getOutput();n.setServiceProviderCode(aa.getServiceProviderCode());n.setContactSeqNumber(this.refSeqNumber);var i=r.getCapContactsByRefContactModel(n).toArray();for(var s in i){var o=aa.cap.getCapID(i[s].getCapID().getID1(),i[s].getCapID().getID2(),i[s].getCapID().getID3()).getOutput();if(e&&appMatch(e,o)){t.push(o)}}}return t};this.getRelatedContactObjs=function(){if(this.refSeqNumber){var e=null;var t=new Array;if(arguments.length==1)e=arguments[0];var n=aa.people.createPeopleModel().getOutput().getPeopleModel();var r=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.CapContactDAOOracle").getOutput();n.setServiceProviderCode(aa.getServiceProviderCode());n.setContactSeqNumber(this.refSeqNumber);var i=r.getCapContactsByRefContactModel(n).toArray();for(var s in i){var o=aa.cap.getCapID(i[s].getCapID().getID1(),i[s].getCapID().getID2(),i[s].getCapID().getID3()).getOutput();if(e&&appMatch(e,o)){var u=aa.people.getCapContactByPK(o,i[s].getPeople().contactSeqNumber).getOutput();var a=new contactObj(u);t.push(a)}}}return t};this.createRefLicProf=function(e,t,n,r){var i=false;var s=aa.getServiceProviderCode();if(arguments.length==5){s=arguments[4];aa.setDelegateAgencyCode(s)}var o=getRefLicenseProf(e);if(o){i=true;logDebug("(contactObj) Updating existing Ref Lic Prof : "+e)}else{var o=aa.licenseScript.createLicenseScriptModel()}peop=this.people;cont=this.capContact;if(cont.getFirstName()!=null)o.setContactFirstName(cont.getFirstName());if(peop.getMiddleName()!=null)o.setContactMiddleName(peop.getMiddleName());if(cont.getLastName()!=null)if(peop.getNamesuffix()!=null)o.setContactLastName(cont.getLastName()+" "+peop.getNamesuffix());else o.setContactLastName(cont.getLastName());if(peop.getBusinessName()!=null)o.setBusinessName(peop.getBusinessName());if(peop.getPhone1()!=null)o.setPhone1(peop.getPhone1());if(peop.getPhone2()!=null)o.setPhone2(peop.getPhone2());if(peop.getEmail()!=null)o.setEMailAddress(peop.getEmail());if(peop.getFax()!=null)o.setFax(peop.getFax());o.setAgencyCode(s);o.setAuditDate(sysDate);o.setAuditID(currentUserID);o.setAuditStatus("A");o.setLicenseType(t);o.setStateLicense(e);o.setLicState(r);var u=lookup("CONTACT_ACROSS_AGENCIES",servProvCode);if(!matches(u,undefined,null,""))o.setLicenseBoard(u);else o.setLicenseBoard("");var a=null;if(n){for(var f in this.addresses){cAddr=this.addresses[f];if(n.equals(cAddr.getAddressType())){a=cAddr}}}if(!a)a=peop.getCompactAddress();if(a.getAddressLine1()!=null)o.setAddress1(a.getAddressLine1());if(a.getAddressLine2()!=null)o.setAddress2(a.getAddressLine2());if(a.getAddressLine3()!=null)o.getLicenseModel().setTitle(a.getAddressLine3());if(a.getCity()!=null)o.setCity(a.getCity());if(a.getState()!=null)o.setState(a.getState());if(a.getZip()!=null)o.setZip(a.getZip());if(a.getCountryCode()!=null)o.getLicenseModel().setCountryCode(a.getCountryCode());if(i)myResult=aa.licenseScript.editRefLicenseProf(o);else myResult=aa.licenseScript.createRefLicenseProf(o);if(arguments.length==5){aa.resetDelegateAgencyCode()}if(myResult.getSuccess()){logDebug("Successfully added/updated License No. "+e+", Type: "+t+" From Contact "+this);return true}else{logDebug("**WARNING: can't create ref lic prof: "+myResult.getErrorMessage());return false}};this.getAKA=function(){var e=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput();if(this.refSeqNumber){return e.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber)).toArray()}else{logDebug("contactObj: Cannot get AKA names for a non-reference contact");return false}};this.addAKA=function(e,t,n,r,i,s){if(!this.refSeqNumber){logDebug("contactObj: Cannot add AKA name for non-reference contact");return false}var o=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput();var u=new Array;var a=aa.proxyInvoker.newInstance("com.accela.orm.model.contact.PeopleAKAModel",u).getOutput();var f=aa.proxyInvoker.newInstance("com.accela.orm.model.common.AuditModel",u).getOutput();var l=o.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber));a.setServiceProviderCode(aa.getServiceProviderCode());a.setContactNumber(parseInt(this.refSeqNumber));a.setFirstName(e);a.setMiddleName(t);a.setLastName(n);a.setFullName(r);a.setStartDate(i);a.setEndDate(s);f.setAuditDate(new Date);f.setAuditStatus("A");f.setAuditID("ADMIN");a.setAuditModel(f);l.add(a);o.saveModels(aa.getServiceProviderCode(),this.refSeqNumber,l)};this.removeAKA=function(e,t,n){if(!this.refSeqNumber){logDebug("contactObj: Cannot remove AKA name for non-reference contact");return false}var r=false;var i=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput();var s=i.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber));var o=s.iterator();while(o.hasNext()){var u=o.next();if((!u.getFirstName()||u.getFirstName().equals(e))&&(!u.getMiddleName()||u.getMiddleName().equals(t))&&(!u.getLastName()||u.getLastName().equals(n))){o.remove();logDebug("contactObj: removed AKA Name : "+e+" "+t+" "+n);r=true}}if(r)i.saveModels(aa.getServiceProviderCode(),this.refSeqNumber,s)};this.hasPublicUser=function(){if(this.refSeqNumber==null)return false;var e=aa.publicUser.getPublicUserListByContactNBR(aa.util.parseLong(this.refSeqNumber));if(e.getSuccess()){var t=e.getOutput();if(t==null||t.size()==0){logDebug("The contact("+this.refSeqNumber+") is not associated with any public user.");return false}else{logDebug("The contact("+this.refSeqNumber+") is associated with "+t.size()+" public users.");return true}}else{logMessage("**ERROR: Failed to get public user by contact number: "+e.getErrorMessage());return false}};this.linkToPublicUser=function(e){if(e!=null){var t=e.replace("PUBLICUSER","");var n=aa.publicUser.getPublicUser(aa.util.parseLong(t));if(n.getSuccess()){var r=aa.licenseScript.associateContactWithPublicUser(t,this.refSeqNumber);if(r.getSuccess()){logDebug("Successfully linked public user "+t+" to contact "+this.refSeqNumber)}else{logDebug("Failed to link contact to public user");return false}}else{logDebug("Could not find a public user with the seq number: "+t);return false}}else{logDebug("No public user id provided");return false}};this.sendCreateAndLinkNotification=function(){var e=this.people.getEmail();if(e){var t=aa.util.newHashtable();getACARecordParam4Notification(t,acaUrl);addParameter(t,"$$licenseType$$",cap.getCapType().getAlias());addParameter(t,"$$altID$$",capIDString);var n;if(this.people.getContactTypeFlag()=="individual"){n=this.people.getFirstName()+" "+this.people.getLastName()}else{n=this.people.getBusinessName()}if(n)addParameter(t,"$$notificationName$$",n);if(this.refSeqNumber){var r=new verhoeff;var i=r.compute(String(this.refSeqNumber));addParameter(t,"$$pinCode$$",i);sendNotification(sysFromEmail,e,"","PUBLICUSER CREATE AND LINK",t,null)}}};this.getRelatedRefContacts=function(){var e;if(arguments.length>0)e=arguments[0];var t=new Array;if(matches(this.refSeqNumber,null,undefined,""))return t;var n=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.XRefContactEntityBusiness").getOutput();xRefContactEntityModel=aa.people.getXRefContactEntityModel().getOutput();xRefContactEntityModel.setContactSeqNumber(parseInt(this.refSeqNumber));x=n.getXRefContactEntityList(xRefContactEntityModel);if(x.size()>0){var r=x.toArray();for(var i in r){var s=r[i];var o=true;if(e){o=exists(s.getEntityID4(),e)}if(o){var u=aa.people.getPeople(s.getEntityID1());if(u.getSuccess()){var a=u.getOutput();t.push(a)}}}}var n=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.XRefContactEntityBusiness").getOutput();xRefContactEntityModel=aa.people.getXRefContactEntityModel().getOutput();xRefContactEntityModel.setEntityID1(parseInt(this.refSeqNumber));x=n.getXRefContactEntityList(xRefContactEntityModel);if(x.size()>0){var r=x.toArray();for(var i in r){var s=r[i];var o=true;if(e){o=exists(s.getEntityID4(),e)}if(o){var u=aa.people.getPeople(s.getContactSeqNumber());if(u.getSuccess()){var a=u.getOutput();t.push(a)}}}}return t}}function contactSetPrimary(e){if(e==null){logDebug("**ERROR: ContactNbr parameter is null");return false}else{var t=aa.people.getCapContactByPK(capId,e);if(t.getSuccess()){var n=t.getOutput();var r=n.getCapContactModel().getPeople();r.setFlag("Y");n.getCapContactModel().setPeople(r);var i=aa.people.editCapContact(n.getCapContactModel());if(i.getSuccess()){logDebug("Contact successfully set to Primary");return true}else{logDebug("**ERROR: Could not set contact to Primary: "+i.getErrorMessage());return false}}else{logDebug("**ERROR: Can't get contact: "+t.getErrorMessage());return false}}}function contactSetRelation(e,t){if(e==null){logDebug("ContactNbr parameter is null");return false}else{var n=aa.people.getCapContactByPK(capId,e);if(n.getSuccess()){var r=n.getOutput();var i=r.getCapContactModel().getPeople();i.setRelation(t);r.getCapContactModel().setPeople(i);var s=aa.people.editCapContact(r.getCapContactModel());if(s.getSuccess()){logDebug("Contact relationship successfully changed to "+t);return true}else{logDebug("**ERROR: Could not change contact relationship: "+s.getErrorMessage());return false}}else{logDebug("**ERROR: Can't get contact: "+n.getErrorMessage());return false}}}function convertContactAddressModelArr(e){var t=null;if(e!=null&&e.length>0){t=aa.util.newArrayList();for(loopk in e){t.add(e[loopk].getContactAddressModel())}}return t}function convertDate(e){if(typeof e=="string"){var t=new Date(String(e));if(!t.toString().equals("Invalid Date"))return t}if(typeof e=="object"){if(!e.getClass){return e}if(e.getClass().toString().equals("class com.accela.aa.emse.dom.ScriptDateTime")){return new Date(e.getMonth()+"/"+e.getDayOfMonth()+"/"+e.getYear())}if(e.getClass().toString().equals("class com.accela.aa.emse.util.ScriptDateTime")){return new Date(e.getMonth()+"/"+e.getDayOfMonth()+"/"+e.getYear())}if(e.getClass().toString().equals("class java.util.Date")){return new Date(e.getTime())}if(e.getClass().toString().equals("class java.lang.String")){return new Date(String(e))}}if(typeof e=="number"){return new Date(e)}logDebug("**WARNING** convertDate cannot parse date : "+e);return null}function convertStringToPhone(e){var t="22233344455566677778889999";var n=String(e.toUpperCase());var r="";for(var i=0;i<n.length;i++){if(n[i]>="A"&&n[i]<="Z"){r+=t[n.charCodeAt(i)-65]}else{r+=n[i]}}return r}function copyAddresses(e,t){if(t==null)var n=capId;else var n=t;var r=false;var i=aa.address.getAddressByCapId(n);if(i.getSuccess()){Address=i.getOutput();for(yy in Address){if("Y"==Address[yy].getPrimaryFlag()){r=true;logDebug("Target CAP has primary address");break}}}else{logMessage("**ERROR: Failed to get addresses: "+i.getErrorMessage());return false}var i=aa.address.getAddressWithAttributeByCapId(e);var s=0;if(i.getSuccess()){Address=i.getOutput();for(yy in Address){newAddress=Address[yy];newAddress.setCapID(n);if(r)newAddress.setPrimaryFlag("N");aa.address.createAddressWithAPOAttribute(n,newAddress);logDebug("Copied address from "+e.getCustomID()+" to "+n.getCustomID());s++}}else{logMessage("**ERROR: Failed to get addresses: "+i.getErrorMessage());return false}return s}function copyAppSpecific(e){var t=new Array;var n=false;if(arguments.length>1){t=arguments[1];n=true}for(asi in AInfo){if(n){var r=false;for(var i=0;i<t.length;i++)if(t[i]==asi){r=true;break}if(r)continue}editAppSpecific(asi,AInfo[asi],e)}}function copyAppSpecific4ACA(e){var t=e.getAppSpecificInfoGroups().iterator();while(t.hasNext()){var n=t.next();var r=n.getFields();if(r!=null){var i=r.iterator();while(i.hasNext()){var s=i.next();if(useAppSpecificGroupName)editAppSpecific4ACA(s.getCheckboxType()+"."+s.getCheckboxDesc(),s.getChecklistComment());else editAppSpecific4ACA(s.getCheckboxDesc(),s.getChecklistComment())}}}}function copyASIFields(e,t){var n=new Array;for(var r=2;r<arguments.length;r++)n.push(arguments[r]);var i=aa.cap.getCap(t).getOutput();var s=i.getCapType();var o=s.toString();var u=o.split("/");var a=aa.appSpecificInfo.getByCapID(e);if(a.getSuccess()){var f=a.getOutput()}else{aa.print("**ERROR: getting source ASI: "+a.getErrorMessage());return false}for(ASICount in f){thisASI=f[ASICount];if(!exists(thisASI.getCheckboxType(),n)){thisASI.setPermitID1(t.getID1());thisASI.setPermitID2(t.getID2());thisASI.setPermitID3(t.getID3());thisASI.setPerType(u[1]);thisASI.setPerSubType(u[2]);aa.cap.createCheckbox(thisASI)}}}function copyASITables(e,t){var n=e;var r=aa.appSpecificTableScript.getAppSpecificTableGroupModel(n).getOutput();var i=r.getTablesArray();var s=i.iterator();var o=new Array;var u=new Array;var a=false;if(arguments.length>2){u=arguments[2];a=true}while(s.hasNext()){var f=s.next();var l=new Array;var c=new Array;var h=f.getTableName()+"";var p=0;if(a){var d=false;for(var v=0;v<u.length;v++)if(u[v]==h){d=true;break}if(d)continue}if(!f.rowIndex.isEmpty()){var m=f.getTableField().iterator();var g=f.getColumns().iterator();var y=f.getAppSpecificTableModel().getReadonlyField().iterator();var p=1;while(m.hasNext()){if(!g.hasNext()){var g=f.getColumns().iterator();c.push(l);var l=new Array;p++}var b=g.next();var w=m.next();var E="N";if(y.hasNext()){E=y.next()}var S=new asiTableValObj(b.getColumnName(),w,E);l[b.getColumnName()]=S}c.push(l)}addASITable(h,c,t);logDebug("ASI Table Array : "+h+" ("+p+" Rows)")}}function copyCalcVal(e,t){if(!t){logMessage("**WARNING: copyCalcVal was passed a null new cap ID");return false}var n=aa.finance.getCalculatedValuation(e,null);if(n.getSuccess())var r=n.getOutput();else{logMessage("**ERROR: Failed to get calc val array: "+n.getErrorMessage());return false}for(thisCV in r){var i=r[thisCV];i.setCapID(t);createResult=aa.finance.createBCalcValuatn(i);if(!createResult.getSuccess()){logMessage("**ERROR: Creating new calc valuatn on target cap ID: "+createResult.getErrorMessage());return false}}}function copyConditions(e){var t=capId;if(arguments.length==2)t=arguments[1];var n=aa.capCondition.getCapConditions(e);if(n.getSuccess())var r=n.getOutput();else{logDebug("**ERROR: getting cap conditions: "+n.getErrorMessage());return false}for(cc in r){var i=r[cc];var s=aa.capCondition.addCapCondition(t,i.getConditionType(),i.getConditionDescription(),i.getConditionComment(),i.getEffectDate(),i.getExpireDate(),sysDate,i.getRefNumber1(),i.getRefNumber2(),i.getImpactCode(),i.getIssuedByUser(),i.getStatusByUser(),i.getConditionStatus(),currentUserID,String("A"),null,i.getDisplayConditionNotice(),i.getIncludeInConditionName(),i.getIncludeInShortDescription(),i.getInheritable(),i.getLongDescripton(),i.getPublicDisplayMessage(),i.getResolutionAction(),null,null,i.getReferenceConditionNumber(),i.getConditionGroup(),i.getDisplayNoticeOnACA(),i.getDisplayNoticeOnACAFee(),i.getPriority(),i.getConditionOfApproval());if(s.getSuccess())logDebug("Successfully added condition ("+i.getImpactCode()+") "+i.getConditionDescription());else logDebug("**ERROR: adding condition ("+cImpact+"): "+s.getErrorMessage())}}function copyConditionsFromParcel(e){var t=aa.parcelCondition.getParcelConditions(e);if(t.getSuccess())var n=t.getOutput();else{logDebug("**WARNING: getting parcel conditions: "+t.getErrorMessage());return false}for(cc in n){var r=n[cc];if(!appHasCondition(r.getConditionType(),null,r.getConditionDescription(),r.getImpactCode())){var i=aa.capCondition.addCapCondition(capId,r.getConditionType(),r.getConditionDescription(),r.getConditionComment(),r.getEffectDate(),r.getExpireDate(),sysDate,r.getRefNumber1(),r.getRefNumber2(),r.getImpactCode(),r.getIssuedByUser(),r.getStatusByUser(),r.getConditionStatus(),currentUserID,"A");if(i.getSuccess())logDebug("Successfully added condition ("+r.getImpactCode()+") "+r.getConditionDescription());else logDebug("**ERROR: adding condition ("+r.getImpactCode()+"): "+i.getErrorMessage())}else logDebug("**WARNING: adding condition ("+r.getImpactCode()+"): condition already exists")}}function copyContacts(e,t){if(t==null)var n=capId;else var n=t;var r=aa.people.getCapContactByCapID(e);var i=0;if(r.getSuccess()){var s=r.getOutput();for(yy in s){var o=s[yy].getCapContactModel();var u=aa.address.getContactAddressListByCapContact(o);if(u.getSuccess()){var a=convertContactAddressModelArr(u.getOutput());o.getPeople().setContactAddressList(a)}o.setCapID(n);aa.people.createCapContactWithAttribute(o);i++;logDebug("Copied contact from "+e.getCustomID()+" to "+n.getCustomID())}}else{logMessage("**ERROR: Failed to get contacts: "+r.getErrorMessage());return false}return i}function convertContactAddressModelArr(e){var t=null;if(e!=null&&e.length>0){t=aa.util.newArrayList();for(loopk in e){t.add(e[loopk].getContactAddressModel())}}return t}function copyContactsByType(e,t,n){if(t==null)var r=capId;else var r=t;var i=aa.people.getCapContactByCapID(e);var s=0;if(i.getSuccess()){var o=i.getOutput();for(yy in o){if(o[yy].getCapContactModel().getContactType()==n){var u=o[yy].getCapContactModel();u.setCapID(r);aa.people.createCapContact(u);s++;logDebug("Copied contact from "+e.getCustomID()+" to "+r.getCustomID())}}}else{logMessage("**ERROR: Failed to get contacts: "+i.getErrorMessage());return false}return s}function copyEducation(e,t){if(e!=null&&t!=null){aa.education.copyEducationList(e,t)}}function copyFees(e,t){var n=new Array;var r=new Array;var i=new Array;var s=loadFees(e);for(x in s){thisFee=s[x];logMessage("We have a fee "+thisFee.code+" status : "+thisFee.status);if(thisFee.status=="INVOICED"){addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"Y",t);var n=new Array;var o=new Array;n.push(thisFee.sequence);o.push(thisFee.period);var u=aa.finance.createInvoice(e,n,o);if(!u.getSuccess())aa.print("**ERROR: Invoicing the fee items voided "+thisFee.code+" was not successful.  Reason: "+u.getErrorMessage())}if(thisFee.status=="NEW"){addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"N",t)}}}function copyLicensedProf(e,t){var n=aa.licenseProfessional.getLicensedProfessionalsByCapID(e).getOutput();if(n!=null)for(x in n){n[x].setCapID(t);aa.licenseProfessional.createLicensedProfessional(n[x]);logDebug("Copied "+n[x].getLicenseNbr())}else logDebug("No licensed professional on source")}function copyOwner(e,t){var n=aa.owner.getOwnerByCapId(e);if(n.getSuccess()){var r=n.getOutput();for(xx in r){r[xx].setCapID(t);aa.owner.createCapOwnerWithAPOAttribute(r[xx]);logDebug("Copied Owner: "+r[xx].getOwnerFullName())}}else logDebug("Error Copying Owner : "+r.getErrorType()+" : "+r.getErrorMessage())}function GetOwnersByParcel(){var e=aa.parcel.getParcelDailyByCapID(capId,null);if(e.getSuccess()){e=e.getOutput();if(e==null||e.length==0){aa.print("There is no any parcel for the cap.")}else{for(var t=0;t<e.length;t++){var n=aa.owner.getOwnersByParcel(e[t]);var r=e[t].getParcelNumber();var i=e[t].getParcelModel().getUID();if(n.getSuccess()){var s=r!=null?r:i;var o=n.getOutput();for(j=0;j<o.length;j++){o[j].setCapID(capId);aa.owner.createCapOwnerWithAPOAttribute(o[j])}}else{aa.print("ERROR: Failed to get owner(s) by Parcel(s): "+n.getErrorMessage())}}}}}function copyParcelGisObjects(){var e=aa.parcel.getParcelandAttribute(capId,null);if(e.getSuccess()){var t=e.getOutput().toArray();for(zz in t){var n=t[zz].getParcelNumber();logDebug("Looking at parcel "+n);var r=aa.gis.getParcelGISObjects(n);if(r.getSuccess())var i=r.getOutput();else{logDebug("**WARNING: Getting GIS objects for Parcel.  Reason is: "+r.getErrorType()+":"+r.getErrorMessage());return false}for(a1 in i){var s=i[a1];var o=s.getGISObjects();for(b1 in o){var u=o[b1];var a=u.getGisObjectModel();var f=aa.gis.addCapGISObject(capId,a.getServiceID(),a.getLayerId(),a.getGisId());if(f.getSuccess()){logDebug("Successfully added Cap GIS object: "+a.getGisId())}else{logDebug("**WARNING: Could not add Cap GIS Object.  Reason is: "+f.getErrorType()+":"+f.getErrorMessage());return false}}}}}else{logDebug("**ERROR: Getting Parcels from Cap.  Reason is: "+e.getErrorType()+":"+e.getErrorMessage());return false}}function copyParcels(e,t){if(t==null)var n=capId;else var n=t;var r=aa.parcel.getParcelandAttribute(e,null);var i=0;if(r.getSuccess()){var s=r.getOutput().toArray();for(zz in s){var o=aa.parcel.getCapParcelModel().getOutput();o.setParcelModel(s[zz]);o.setCapIDModel(n);o.setL1ParcelNo(s[zz].getParcelNumber());o.setParcelNo(s[zz].getParcelNumber());aa.parcel.createCapParcel(o);logDebug("Copied parcel "+s[zz].getParcelNumber()+" from "+e.getCustomID()+" to "+n.getCustomID());i++}}else{logMessage("**ERROR: Failed to get parcels: "+r.getErrorMessage());return false}return i}function copySchedInspections(e,t){if(t==null)var n=capId;else var n=t;var r=aa.inspection.getInspections(e);if(!r.getSuccess()){logMessage("**ERROR: Failed to get inspections: "+r.getErrorMessage());return false}var i=0;var s;var o;var u;var a;var f;var l;var c=r.getOutput();for(xx in c){if("Insp Scheduled"==c[xx].getDocumentDescription()){o=c[xx].getInspector();u=c[xx].getScheduledDate();a=c[xx].getScheduledTime();f=c[xx].getInspectionType();l=c[xx].getInspectionComments();s=aa.inspection.scheduleInspection(n,o,u,a,f,l);if(s.getSuccess()){logDebug("Copied scheduled inspection from "+e.getCustomID()+" to "+n.getCustomID());i++}else logDebug("**ERROR: copying scheduling inspection ("+f+"): "+s.getErrorMessage())}}return i}function countActiveTasks(e){var t=0;var n=aa.workflow.getTaskCount(capId,e,"Y");if(n.getSuccess())t=n.getOutput().intValue();else{logMessage("**ERROR: Failed to get task count: "+s_capResult.getErrorMessage());return false}return t}function countIdenticalInspections(){var e=0;var t="01/01/1900";if(arguments.length>0)t=arguments[0];oldDate=new Date("oldDateStr");var n=false;var r=aa.inspection.getInspections(capId);if(r.getSuccess()){inspList=r.getOutput();for(xx in inspList){if(String(inspType).equals(inspList[xx].getInspectionType())&&String(inspResult).equals(inspList[xx].getInspectionStatus())){if(convertDate(inspList[xx].getInspectionStatusDate())<oldDate){if(!n){e++;n=true}}else{e++}}}}logDebug("countIdenticalInspections("+inspType+","+inspResult+", "+t+") Returns "+e);return e}function createCap(e,t){var n=e.split("/");if(n.length!=4){logDebug("**ERROR in createCap.  The following Application Type String is incorrectly formatted: "+e);return"INVALID PARAMETER"}var r=aa.cap.createApp(n[0],n[1],n[2],n[3],t);logDebug("Creating cap "+e);if(!r.getSuccess()){logDebug("**ERROR: creating CAP "+r.getErrorMessage());return false}var i=r.getOutput();logDebug("CAP of type "+e+" created successfully ");var s=aa.cap.getCap(i).getOutput();return i}function createCapComment(e){var t=capId;var n="N";if(arguments.length>=2&&typeof arguments[1]!="undefined"&&arguments[1]!=null&&arguments[1]!=""){t=arguments[1]}if(arguments.length>=3&&typeof arguments[2]!="undefined"&&arguments[2]!=null&&arguments[2]!=""){n=arguments[2]}var r=aa.date.getCurrentDate();var i=aa.cap.createCapCommentScriptModel();i.setCapIDModel(t);i.setCommentType("APP LEVEL COMMENT");i.setSynopsis("");i.setText(e);i.setAuditUser(currentUserID);i.setAuditStatus("A");i.setAuditDate(r);var s=i.getCapCommentModel();s.setDisplayOnInsp(n);aa.cap.createCapComment(s);logDebug("Comment Added")}function createChild(e,t,n,r,i){var s=capId;if(arguments.length>5)s=arguments[5];var o=aa.cap.createApp(e,t,n,r,i);logDebug("creating cap "+e+"/"+t+"/"+n+"/"+r);if(o.getSuccess()){var u=o.getOutput();logDebug("cap "+e+"/"+t+"/"+n+"/"+r+" created successfully ");capModel=aa.cap.newCapScriptModel().getOutput();capDetailModel=capModel.getCapModel().getCapDetailModel();capDetailModel.setCapID(u);aa.cap.createCapDetail(capDetailModel);var a=aa.cap.getCap(u).getOutput();var f=aa.cap.createAppHierarchy(s,u);if(f.getSuccess())logDebug("Child application successfully linked");else logDebug("Could not link applications");var l=aa.parcel.getParcelandAttribute(s,null);if(l.getSuccess()){var c=l.getOutput().toArray();for(zz in c){logDebug("adding parcel #"+zz+" = "+c[zz].getParcelNumber());var h=aa.parcel.getCapParcelModel().getOutput();h.setParcelModel(c[zz]);h.setCapIDModel(u);h.setL1ParcelNo(c[zz].getParcelNumber());h.setParcelNo(c[zz].getParcelNumber());aa.parcel.createCapParcel(h)}}capContactResult=aa.people.getCapContactByCapID(s);if(capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var p=Contacts[yy].getCapContactModel();p.setCapID(u);aa.people.createCapContact(p);logDebug("added contact")}}capAddressResult=aa.address.getAddressByCapId(s);if(capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address){newAddress=Address[yy];newAddress.setCapID(u);aa.address.createAddress(newAddress);logDebug("added address")}}return u}else{logDebug("**ERROR: adding child App: "+o.getErrorMessage())}}function createLicense(e,t){var n=null;var r=null;var i=null;var s=appTypeArray[2];r=createParent(appTypeArray[0],appTypeArray[1],appTypeArray[2],"License",null);editScheduledDate(sysDateMMDDYYYY,r);editFirstIssuedDate(sysDateMMDDYYYY,r);i=r.getCustomID();updateAppStatus(e,"",r);if(t){copyAppSpecific(r)}return r}function createParent(e,t,n,r,i){var s=aa.cap.createApp(e,t,n,r,i);logDebug("creating cap "+e+"/"+t+"/"+n+"/"+r);if(s.getSuccess()){var o=s.getOutput();logDebug("cap "+e+"/"+t+"/"+n+"/"+r+" created successfully ");capModel=aa.cap.newCapScriptModel().getOutput();capDetailModel=capModel.getCapModel().getCapDetailModel();capDetailModel.setCapID(o);aa.cap.createCapDetail(capDetailModel);var u=aa.cap.getCap(o).getOutput();var a=aa.cap.createAppHierarchy(o,capId);if(a.getSuccess())logDebug("Parent application successfully linked");else logDebug("Could not link applications");var f=aa.parcel.getParcelandAttribute(capId,null);if(f.getSuccess()){var l=f.getOutput().toArray();for(zz in l){logDebug("adding parcel #"+zz+" = "+l[zz].getParcelNumber());var c=aa.parcel.getCapParcelModel().getOutput();c.setParcelModel(l[zz]);c.setCapIDModel(o);c.setL1ParcelNo(l[zz].getParcelNumber());c.setParcelNo(l[zz].getParcelNumber());aa.parcel.createCapParcel(c)}}copyContacts(capId,o);capAddressResult=aa.address.getAddressByCapId(capId);if(capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address){newAddress=Address[yy];newAddress.setCapID(o);aa.address.createAddress(newAddress);logDebug("added address")}}return o}else{logDebug("**ERROR: adding parent App: "+s.getErrorMessage())}}function createPendingInspection(e,t){var n=capId;if(arguments.length==3)n=arguments[2];var r=aa.inspection.getInspectionType(e,t);if(!r.getSuccess()){logDebug("**WARNING error retrieving inspection types: "+r.getErrorMessage);return false}var i=r.getOutput();if(!i){logDebug("**WARNING could not find any matches for inspection group "+e+" and type "+t);return false}var s=null;for(thisItm in i){var o=i[thisItm];if(o.getGroupCode().toUpperCase().equals(e.toUpperCase())&&o.getType().toUpperCase().equals(t.toUpperCase()))s=o.getSequenceNumber()}if(!s){logDebug("**WARNING could not find an exact match for inspection group "+e+" and type "+t);return false}var u=aa.inspection.getInspectionScriptModel().getOutput().getInspection();var a=u.getActivity();a.setInspSequenceNumber(s);a.setCapIDModel(n);pendingResult=aa.inspection.pendingInspection(u);if(pendingResult.getSuccess()){logDebug("Successfully created pending inspection group "+e+" and type "+t);return true}else{logDebug("**WARNING could not create pending inspection group "+e+" and type "+t+" Message: "+pendingResult.getErrorMessage());return false}}function createPendingInspFromReqd(){var e=capId;if(arguments.length==1)e=arguments[0];var t=aa.inspection.getInspectionListForSchedule(e.getID1(),e.getID2(),e.getID3());if(!t.getSuccess()){logDebug("**WARNING error retrieving inspections: "+t.getErrorMessage());return false}var n=t.getOutput();for(var r in n){var i=n[r];if(i.getRequiredInspection().equals("Y")){createPendingInspection(i.getGroupCode(),i.getType(),e)}}}function createPublicUserFromContact(){var e="Applicant";var t;var n;var r;if(arguments.length>0)e=arguments[0];var i=aa.people.getCapContactByCapID(capId);if(i.getSuccess()){var s=i.getOutput();for(yy in s){if(e.equals(s[yy].getCapContactModel().getPeople().getContactType()))t=s[yy]}}if(!t){logDebug("Couldn't create public user for "+e+", no such contact");return false}if(!t.getEmail()){logDebug("Couldn't create public user for "+e+", no email address");return false}if(t.getPeople().getContactTypeFlag().equals("organization")){logDebug("Couldn't create public user for "+e+", the contact is an organization");return false}n=t.getCapContactModel().getRefContactNumber();var o=aa.publicUser.getPublicUserByEmail(t.getEmail());if(o.getSuccess()&&o.getOutput()){r=o.getOutput();logDebug("CreatePublicUserFromContact: Found an existing public user: "+r.getUserID())}if(!r){logDebug("CreatePublicUserFromContact: creating new user based on email address: "+t.getEmail());var u=aa.publicUser.getPublicUserModel();u.setFirstName(t.getFirstName());u.setLastName(t.getLastName());u.setEmail(t.getEmail());u.setUserID(t.getEmail());u.setPassword("e8248cbe79a288ffec75d7300ad2e07172f487f6");u.setAuditID("PublicUser");u.setAuditStatus("A");u.setCellPhone(t.getCapContactModel().getPeople().getPhone2());var a=aa.publicUser.createPublicUser(u);if(a.getSuccess()){logDebug("Created public user "+t.getEmail()+"  sucessfully.");var f=a.getOutput();var r=aa.publicUser.getPublicUser(f).getOutput();aa.publicUser.createPublicUserForAgency(r);var l=aa.proxyInvoker.newInstance("com.accela.pa.pin.UserPINBusiness").getOutput();l.updateActiveStatusAndLicenseIssueDate4PublicUser(servProvCode,f,"ADMIN");var c=aa.publicUser.resetPassword(t.getEmail());if(c.getSuccess()){var h=c.getOutput();r.setPassword(h);logDebug("Reset password for "+t.getEmail()+"  sucessfully.")}else{logDebug("**ERROR: Reset password for  "+t.getEmail()+"  failure:"+c.getErrorMessage())}aa.publicUser.sendActivateEmail(r,true,true);aa.publicUser.sendPasswordEmail(r)}else{logDebug("**Warning creating public user "+t.getEmail()+"  failure: "+a.getErrorMessage());return null}}if(n){logDebug("CreatePublicUserFromContact: Linking this public user with reference contact : "+n);aa.licenseScript.associateContactWithPublicUser(r.getUserSeqNum(),n)}return r}function createRecord(e,t,n,r,i){var s=aa.cap.createApp(e,t,n,r,i);logDebug("creating cap "+e+"/"+t+"/"+n+"/"+r);if(s.getSuccess()){var o=s.getOutput();logDebug("cap "+e+"/"+t+"/"+n+"/"+r+" created successfully ");capModel=aa.cap.newCapScriptModel().getOutput();capDetailModel=capModel.getCapModel().getCapDetailModel();capDetailModel.setCapID(o);aa.cap.createCapDetail(capDetailModel);var u=aa.cap.getCap(o).getOutput();var a=aa.parcel.getParcelandAttribute(capId,null);if(a.getSuccess()){var f=a.getOutput().toArray();for(zz in f){logDebug("adding parcel #"+zz+" = "+f[zz].getParcelNumber());var l=aa.parcel.getCapParcelModel().getOutput();l.setParcelModel(f[zz]);l.setCapIDModel(o);l.setL1ParcelNo(f[zz].getParcelNumber());l.setParcelNo(f[zz].getParcelNumber());aa.parcel.createCapParcel(l)}}capContactResult=aa.people.getCapContactByCapID(capId);if(capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var c=Contacts[yy].getCapContactModel();c.setCapID(o);aa.people.createCapContact(c);logDebug("added contact")}}capAddressResult=aa.address.getAddressByCapId(capId);if(capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address){newAddress=Address[yy];newAddress.setCapID(o);aa.address.createAddress(newAddress);logDebug("added address")}}return o}else{logDebug("**ERROR: adding parent App: "+s.getErrorMessage())}}function createRefContactAddressFromAddress(e,t,n){if(t&&e){var r=aa.address.createContactAddressModel().getOutput();r.setServiceProviderCode(servProvCode);r.setAuditStatus("A");r.setAuditID(currentUserID);var i=r.getContactAddressModel();i.setEntityID(parseInt(e));i.setEntityType("CONTACT");i.setAddressType(n);i.setAddressLine1(t.getAddressLine1());i.setAddressLine2(t.getAddressLine2());i.setAddressLine3(t.getCounty());i.setHouseNumberStart(t.getHouseNumberStart());i.setHouseNumberEnd(t.getHouseNumberEnd());i.setStreetName(t.getStreetName());i.setCity(t.getCity());i.setState(t.getState());i.setZip(t.getZip());var i=r.getContactAddressModel();var s=aa.address.createContactAddress(i);if(s.getSuccess()){logDebug("Create Contact Address Successfully: "+s.getOutput().getAddressID());return s.getOutput()}else{logDebug("Create Contact Address Failed:"+s.getErrorMessage());return false}}else{logDebug("Could not create reference contact address no address model or reference contact sequence number");return false}}function createRefContactsFromCapContactsAndLink(e,t,n,r,i,s){var o="REF_CONTACT_CREATION_RULES";var u=new Array;if(arguments.length>1)ignoreArray=arguments[1];var a=lookup(o,"Default");var f=aa.people.getCapContactByCapID(e).getOutput();var l=aa.people.getCapContactByCapID(e).getOutput();for(var c in f){var h="U";var p=f[c];var d=p.getPeople();var v=lookup(o,d.getContactType());if(!a&&!v){if(t&&!exists(d.getContactType(),t))continue}if(!v&&a){h=a}if(v){h=v}if(h.equals("D"))continue;var m="";switch(h){case"U":m=d.getContactType();break;case"I":m="Individual";break;case"O":m="Organization";break;case"F":if(d.getContactTypeFlag()&&d.getContactTypeFlag().equals("organization"))m="Organization";else m="Individual";break}var g=p.getCapContactModel().getRefContactNumber();if(g){if(i){d.setContactSeqNumber(g);d.setContactType(m);var y=d.getAttributes();if(y){var b=y.iterator();while(b.hasNext()){var w=b.next();w.setContactNo(g)}}var E=aa.people.editPeopleWithAttribute(d,d.getAttributes());if(!E.getSuccess())logDebug("WARNING: couldn't refresh reference people : "+E.getErrorMessage());else logDebug("Successfully refreshed ref contact #"+g+" with CAP contact data")}if(r){}}else{var S=d.getContactSeqNumber();var x=s(d);var d=l[c].getPeople();if(x){T=x}else{var y=d.getAttributes();if(y){var b=y.iterator();while(b.hasNext()){var w=b.next();if(n&&exists(w.getAttributeName().toUpperCase(),n))b.remove()}}d.setContactType(m);var E=aa.people.createPeopleWithAttribute(d,y);if(!E.getSuccess()){logDebug("WARNING: couldn't create reference people : "+E.getErrorMessage());continue}var d=l[c].getPeople();var T=d.getContactSeqNumber();logDebug("Successfully created reference contact #"+T);var N=aa.publicUser.getPublicUserByEmail(p.getEmail());if(N.getSuccess()&&N.getOutput()){var C=N.getOutput();logDebug("createRefContactsFromCapContactsAndLink: Found an existing public user: "+C.getUserID());if(T){logDebug("createRefContactsFromCapContactsAndLink: Linking this public user with new reference contact : "+T);aa.licenseScript.associateContactWithPublicUser(C.getUserSeqNum(),T)}}}var k=aa.people.getCapContactByPK(e,S).getOutput().getCapContactModel();k.setRefContactNumber(T);E=aa.people.editCapContact(k);if(!E.getSuccess()){logDebug("WARNING: error updating cap contact model : "+E.getErrorMessage())}else{logDebug("Successfully linked ref contact "+T+" to cap contact "+S)}}}}function createRefLicProf(e,t,n){var r=null;if(arguments.length==4)r=arguments[3];var i=false;conArr=getPeople(capId);if(!conArr.length){logDebug("**WARNING: No contact available");return false}var s=getRefLicenseProf(e);if(s){i=true;logDebug("Updating existing Ref Lic Prof : "+e)}else var s=aa.licenseScript.createLicenseScriptModel();if(n==null)var o=conArr[0];else{var u=false;for(yy in conArr){if(n.equals(conArr[yy].getCapContactModel().getPeople().getContactType())){o=conArr[yy];u=true;break}}if(!u){logDebug("**WARNING: No Contact found of type: "+n);return false}}peop=o.getPeople();var a=null;if(r){var f=peop.getContactAddressList();if(f){f=f.toArray();for(var l in f){if(r.equals(f[l].getAddressType())){a=f[l]}}}}if(!a)a=peop.getCompactAddress();s.setContactFirstName(o.getFirstName());s.setContactLastName(o.getLastName());s.setBusinessName(peop.getBusinessName());s.setAddress1(a.getAddressLine1());s.setAddress2(a.getAddressLine2());s.setAddress3(a.getAddressLine3());s.setCity(a.getCity());s.setState(a.getState());s.setZip(a.getZip());s.setPhone1(peop.getPhone1());s.setPhone2(peop.getPhone2());s.setEMailAddress(peop.getEmail());s.setFax(peop.getFax());s.setAgencyCode(aa.getServiceProviderCode());s.setAuditDate(sysDate);s.setAuditID(currentUserID);s.setAuditStatus("A");if(AInfo["Insurance Co"])s.setInsuranceCo(AInfo["Insurance Co"]);if(AInfo["Insurance Amount"])s.setInsuranceAmount(parseFloat(AInfo["Insurance Amount"]));if(AInfo["Insurance Exp Date"])s.setInsuranceExpDate(aa.date.parseDate(AInfo["Insurance Exp Date"]));if(AInfo["Policy #"])s.setPolicy(AInfo["Policy #"]);if(AInfo["Business License #"])s.setBusinessLicense(AInfo["Business License #"]);if(AInfo["Business License Exp Date"])s.setBusinessLicExpDate(aa.date.parseDate(AInfo["Business License Exp Date"]));s.setLicenseType(t);s.setLicState("NY");s.setStateLicense(e);if(i)myResult=aa.licenseScript.editRefLicenseProf(s);else myResult=aa.licenseScript.createRefLicenseProf(s);if(myResult.getSuccess()){logDebug("Successfully added/updated License No. "+e+", Type: "+t);logMessage("Successfully added/updated License No. "+e+", Type: "+t);return true}else{logDebug("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage());logMessage("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage());return false}}function createRefLicProfFromLicProf(){capLicenseResult=aa.licenseScript.getLicenseProf(capId);if(capLicenseResult.getSuccess()){capLicenseArr=capLicenseResult.getOutput()}else{logDebug("**ERROR: getting lic prof: "+capLicenseResult.getErrorMessage());return false}if(!capLicenseArr.length){logDebug("WARNING: no license professional available on the application:");return false}licProfScriptModel=capLicenseArr[0];rlpId=licProfScriptModel.getLicenseNbr();var e=false;var t=getRefLicenseProf(rlpId);if(t){e=true;logDebug("Updating existing Ref Lic Prof : "+rlpId)}else var t=aa.licenseScript.createLicenseScriptModel();t.setStateLicense(rlpId);t.setAddress1(licProfScriptModel.getAddress1());t.setAddress2(licProfScriptModel.getAddress2());t.setAddress3(licProfScriptModel.getAddress3());t.setAgencyCode(licProfScriptModel.getAgencyCode());t.setAuditDate(licProfScriptModel.getAuditDate());t.setAuditID(licProfScriptModel.getAuditID());t.setAuditStatus(licProfScriptModel.getAuditStatus());t.setBusinessLicense(licProfScriptModel.getBusinessLicense());t.setBusinessName(licProfScriptModel.getBusinessName());t.setCity(licProfScriptModel.getCity());t.setCityCode(licProfScriptModel.getCityCode());t.setContactFirstName(licProfScriptModel.getContactFirstName());t.setContactLastName(licProfScriptModel.getContactLastName());t.setContactMiddleName(licProfScriptModel.getContactMiddleName());t.setContryCode(licProfScriptModel.getCountryCode());t.setCountry(licProfScriptModel.getCountry());t.setEinSs(licProfScriptModel.getEinSs());t.setEMailAddress(licProfScriptModel.getEmail());t.setFax(licProfScriptModel.getFax());t.setLicenseType(licProfScriptModel.getLicenseType());t.setLicOrigIssDate(licProfScriptModel.getLicesnseOrigIssueDate());t.setPhone1(licProfScriptModel.getPhone1());t.setPhone2(licProfScriptModel.getPhone2());t.setSelfIns(licProfScriptModel.getSelfIns());t.setState(licProfScriptModel.getState());t.setLicState(licProfScriptModel.getState());t.setSuffixName(licProfScriptModel.getSuffixName());t.setWcExempt(licProfScriptModel.getWorkCompExempt());t.setZip(licProfScriptModel.getZip());if(e)myResult=aa.licenseScript.editRefLicenseProf(t);else myResult=aa.licenseScript.createRefLicenseProf(t);if(myResult.getSuccess()){logDebug("Successfully added/updated License ID : "+rlpId);return rlpId}else{logDebug("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage())}}function createRefLP4Lookup(e,t,n,r){createRefLicProf(e,t,n,r);newLic=getRefLicenseProf(e);if(newLic){newLic.setAuditStatus("A");aa.licenseScript.editRefLicenseProf(newLic);logDebug("Reference LP successfully created")}else{logDebug("Reference LP not created")}}function dateAdd(e,t){var n=false;if(arguments.length==3)n=true;if(!e)dDate=new Date;else dDate=convertDate(e);var r=0;if(n)if(!aa.calendar.getNextWorkDay){logDebug("getNextWorkDay function is only available in Accela Automation 6.3.2 or higher.");while(r<Math.abs(t)){dDate.setDate(dDate.getDate()+parseInt(t>0?1:-1,10));if(dDate.getDay()>0&&dDate.getDay()<6)r++}}else{while(r<Math.abs(t)){if(t>0){dDate=new Date(aa.calendar.getNextWorkDay(aa.date.parseDate(dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear())).getOutput().getTime());r++}else{dDate=new Date(aa.calendar.getPreviousWorkDay(aa.date.parseDate(dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear())).getOutput().getTime());r++}}}else dDate.setDate(dDate.getDate()+parseInt(t,10));return dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear()}function dateAddMonths(e,t){if(!e)baseDate=new Date;else baseDate=convertDate(e);var n=baseDate.getDate();baseDate.setMonth(baseDate.getMonth()+t);if(baseDate.getDate()<n){baseDate.setDate(1);baseDate.setDate(baseDate.getDate()-1)}return baseDate.getMonth()+1+"/"+baseDate.getDate()+"/"+baseDate.getFullYear()}function dateDiff(e,t){return(convertDate(t).getTime()-convertDate(e).getTime())/(1e3*60*60*24)}function dateFormatted(e,t,n,r){var i="";var s="";var o="";if(e>9)i=e.toString();else i="0"+e.toString();if(t>9)s=t.toString();else s="0"+t.toString();if(r=="YYYY-MM-DD")o=n.toString()+"-"+i+"-"+s;else o=""+i+"/"+s+"/"+n.toString();return o}function dateNextOccur(e,t,n){var r=new String(n);if(r.length==10&&r.indexOf("-")==4&&r.indexOf("-",7)==7)var i=new Date(r.substr(5,2)+"/"+r.substr(8,2)+"/"+r.substr(0,4));else var i=new Date(r);var s=i.getFullYear().toString();var o=new Date(e+"/"+t+"/"+s);var u=false;var a;var f=o;if(arguments.length>3){var a=arguments[3].toUpperCase();u=true}if(o>i)f=o;else{o.setFullYear(o.getFullYear()+1);f=o}if(u){if(a=="ODD"&&f.getFullYear()%2==0)f.setFullYear(f.getFullYear()+1);if(a=="EVEN"&&f.getFullYear()%2)f.setFullYear(f.getFullYear()+1)}return f.getMonth()+1+"/"+f.getDate()+"/"+f.getFullYear()}function deactivateActiveTasks(e){var t=aa.workflow.getTasks(capId);if(t.getSuccess())wfObj=t.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){fTask=wfObj[i];if(fTask.getProcessCode().equals(e))if(fTask.getActiveFlag().equals("Y"))deactivateTask(fTask.getTaskDescription())}}function deactivateTask(e){var t=false;var n="";if(arguments.length==2){n=arguments[1];t=true}var r=aa.workflow.getTaskItems(capId,e,n,null,null,null);if(r.getSuccess())var s=r.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in s){var o=s[i];if(o.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||o.getProcessCode().equals(n))){var u=o.getStepNumber();var a=o.getProcessID();var f=o.getCompleteFlag();if(t){aa.workflow.adjustTask(capId,u,a,"N",f,null,null)}else{aa.workflow.adjustTask(capId,u,"N",f,null,null)}logDebug("deactivating Workflow Task: "+e)}}}function decode64(e){var t="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";var n="";var r,i,s="";var o,u,a,f="";var l=0;var c=/[^A-Za-z0-9\+\/\=]/g;if(c.exec(e)){alert("There were invalid base64 characters in the input text.\n"+"Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\n"+"Expect errors in decoding.")}e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{o=t.indexOf(e.charAt(l++));u=t.indexOf(e.charAt(l++));a=t.indexOf(e.charAt(l++));f=t.indexOf(e.charAt(l++));r=o<<2|u>>4;i=(u&15)<<4|a>>2;s=(a&3)<<6|f;n=n+String.fromCharCode(r);if(a!=64){n=n+String.fromCharCode(i)}if(f!=64){n=n+String.fromCharCode(s)}r=i=s="";o=u=a=f=""}while(l<e.length);return unescape(n)}function deleteLicensedProfessional(e){var t=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.LicenseBusiness").getOutput();var n=aa.proxyInvoker.newInstance("com.accela.pa.people.license.ContractorLicenseBusiness").getOutput();if(e){lm=e.getLicenseModel();pubusers=aa.publicUser.getPublicUserListByLicenseSeqNBR(licenseNumber).getOutput().toArray();for(p1 in pubusers){pu=pubusers[p1].getUserSeqNum();n.deleteContractorLicense(pu,e.getLicenseType(),e.getAgencyCode(),licenseNumber);logDebug("deleted association to public user: "+pubusers[p1].getUserID())}t.removeLicenseByPK(lm);logDebug(licenseNumber+"has been deleted")}}function deleteTask(e,t){var n=aa.workflow.getTaskItems(e,t,null,null,null,null);if(n.getSuccess())var r=n.getOutput();else{logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}var s=null;for(i in r){var o=r[i];if(o.getTaskDescription().toUpperCase().equals(t.toUpperCase())){var s=r[i]}}if(!s){logDebug("**WARNING: Task not found: "+t);return false}logDebug("Removing task "+s.getTaskDescription());var u=aa.workflow.removeTask(s);if(!u.getSuccess()){logDebug("error "+u.getErrorMessage());return false}}function describe(e){var t="";for(var n in e)if(typeof e[n]=="function")t+="method:"+n+"\n";else t+="property:"+n+" = "+e[n]+"\n";return t}function docWrite(e,t,n){var r="";for(i=0;i<n;i++)r+="|  ";if(t&&e)aa.print(r+"------------------------------------------------");if(e)aa.print(r+e);if(t)aa.print(r+"------------------------------------------------")}function doScriptActions(){if(typeof appTypeArray=="object"){include(prefix+":"+appTypeArray[0]+"/*/*/*");include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/*/*");include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/"+appTypeArray[2]+"/*");include(prefix+":"+appTypeArray[0]+"/*/"+appTypeArray[2]+"/*");include(prefix+":"+appTypeArray[0]+"/*/"+appTypeArray[2]+"/"+appTypeArray[3]);include(prefix+":"+appTypeArray[0]+"/*/*/"+appTypeArray[3]);include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/*/"+appTypeArray[3]);include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/"+appTypeArray[2]+"/"+appTypeArray[3])}}function doStandardChoiceActions(stdChoiceEntry,doExecution,docIndent){var thisDate=new Date;var thisTime=thisDate.getTime();var lastEvalTrue=false;stopBranch=false;logDebug("Executing : "+stdChoiceEntry+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds");var pairObjArray=getScriptAction(stdChoiceEntry);if(!doExecution)docWrite(stdChoiceEntry,true,docIndent);for(xx in pairObjArray){doObj=pairObjArray[xx];if(doExecution){if(doObj.enabled){if(stopBranch){stopBranch=false;break}logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Criteria : "+doObj.cri,2);try{if(eval(token(doObj.cri))||lastEvalTrue&&doObj.continuation){logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Action : "+doObj.act,2);eval(token(doObj.act));lastEvalTrue=true}else{if(doObj.elseact){logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Else : "+doObj.elseact,2);eval(token(doObj.elseact))}lastEvalTrue=false}}catch(err){showDebug=3;logDebug("**ERROR An error occured in the following standard choice "+stdChoiceEntry+"#"+doObj.ID+"  Error:  "+err.message)}}}else{docWrite("|  ",false,docIndent);var disableString="";if(!doObj.enabled)disableString="<DISABLED>";if(doObj.elseact)docWrite("|  "+doObj.ID+" "+disableString+" "+doObj.cri+" ^ "+doObj.act+" ^ "+doObj.elseact,false,docIndent);else docWrite("|  "+doObj.ID+" "+disableString+" "+doObj.cri+" ^ "+doObj.act,false,docIndent);for(yy in doObj.branch){doStandardChoiceActions(doObj.branch[yy],false,docIndent+1)}}}if(!doExecution)docWrite(null,true,docIndent);var thisDate=new Date;var thisTime=thisDate.getTime();logDebug("Finished: "+stdChoiceEntry+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds")}function editAppName(e){var t=capId;if(arguments.length==2)t=arguments[1];capResult=aa.cap.getCap(t);if(!capResult.getSuccess()){logDebug("**WARNING: error getting cap : "+capResult.getErrorMessage());return false}capModel=capResult.getOutput().getCapModel();capModel.setSpecialText(e);setNameResult=aa.cap.editCapByPK(capModel);if(!setNameResult.getSuccess()){logDebug("**WARNING: error setting cap name : "+setNameResult.getErrorMessage());return false}return true}function editAppSpecific(e,t){var n=capId;var r=null;if(arguments.length==3)n=arguments[2];if(useAppSpecificGroupName){if(e.indexOf(".")<0){logDebug("**WARNING: editAppSpecific requires group name prefix when useAppSpecificGroupName is true");return false}r=e.substr(0,e.indexOf("."));e=e.substr(e.indexOf(".")+1)}var i=aa.appSpecificInfo.editSingleAppSpecific(n,e,t,r);if(i.getSuccess()){if(arguments.length<3)AInfo[e]=t}else{logDebug("WARNING: "+e+" was not updated.")}}function editAppSpecific4ACA(e,t){var n=cap.getAppSpecificInfoGroups().iterator();while(n.hasNext()){var r=n.next();var i=r.getFields();if(i!=null){var s=i.iterator();while(s.hasNext()){var o=s.next();if(useAppSpecificGroupName&&e.equals(o.getCheckboxType()+"."+o.getCheckboxDesc())||e.equals(o.getCheckboxDesc())){o.setChecklistComment(t)}}}}}function editBuildingCount(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();cd.setBuildingCount(parseFloat(e));cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("Updated building count to "+e);return true}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function editCapConditionStatus(e,t,n,r){if(e==null)var i=aa.capCondition.getCapConditions(capId);else var i=aa.capCondition.getCapConditions(capId,e);if(i.getSuccess())var s=i.getOutput();else{logMessage("**ERROR: getting cap conditions: "+i.getErrorMessage());logDebug("**ERROR: getting cap conditions: "+i.getErrorMessage());return false}for(cc in s){var o=s[cc];var u=o.getConditionStatus();var a=o.getConditionStatusType();var f=o.getConditionDescription();var l=o.getImpactCode();logDebug(u+": "+a);if(f.toUpperCase()==t.toUpperCase()){if(!n.toUpperCase().equals(u.toUpperCase())){o.setConditionStatus(n);o.setConditionStatusType(r);o.setImpactCode("");aa.capCondition.editCapCondition(o);return true}else{logDebug("ERROR: condition found but already in the status of pStatus and pStatusType");return false}}}logDebug("ERROR: no matching condition found");return false}function days_between(e,t){var n=1e3*60*60*24;var r=e.getTime();var i=t.getTime();var s=Math.abs(r-i);return Math.round(s/n)}function editCapContactAttribute(e,t,n){var r=capId;if(arguments.length>3)r=arguments[3];var i=null;var s=aa.people.getCapContactByCapID(r).getOutput();for(var o in s){var u=false;var a=s[o].getCapContactModel().getPeople();if(a.getContactSeqNumber()!=e)continue;var f=a.getAttributes().toArray();for(var l in f){if(t.equals(f[l].getAttributeName())){i=f[l].getAttributeValue();f[l].setAttributeValue(n);u=true;break}}if(u){logDebug("Updated Cap Contact: "+e+", attribute: "+t+" from: "+i+" to: "+n);s[o].getCapContactModel().setPeople(a);var c=aa.people.editCapContactWithAttribute(s[o].getCapContactModel())}}}function editChannelReported(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();cd.setReportedChannel(e);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("Updated channel reported to "+e)}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function editContactType(e,t){var n=capId;if(arguments.length==3)n=arguments[2];capContactResult=aa.people.getCapContactByCapID(n);if(capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var r=Contacts[yy].getCapContactModel();if(r.getContactType()==e){r.setContactType(t);var i=r.getPeople();var s=aa.address.getContactAddressListByCapContact(r);if(s.getSuccess()){var o=convertContactAddressModelArr(s.getOutput());i.setContactAddressList(o)}aa.people.editCapContactWithAttribute(r)}}}}function editCreatedBy(e){var t=capId;if(arguments.length==2)t=arguments[1];var n=aa.cap.getCap(t);if(!n.getSuccess()){logDebug("**WARNING: error getting cap : "+n.getErrorMessage());return false}var r=n.getOutput();var i=r.getCapModel();i.setCreatedBy(e);setCreatedByResult=aa.cap.editCapByPK(i);if(!setCreatedByResult.getSuccess()){logDebug("**WARNING: error setting cap created by : "+setCreatedByResult.getErrorMessage());return false}return true}function editFirstIssuedDate(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();var i=new Date(e);var s=aa.date.transToJavaUtilDate(i.getTime());cd.setFirstIssuedDate(s);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("updated first issued date to "+s);return true}else{logDebug("**ERROR updating first issued date: "+cdWrite.getErrorMessage());return false}}function editHouseCount(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();cd.setHouseCount(parseFloat(e));cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("Updated house count to "+e);return true}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function editInspectionRequiredFlag(e,t){var n=capId;if(arguments.length>2)n=arguments[2];var r=aa.inspection.getInspMilestoneByCapID(n);if(!r.getSuccess()){logDebug("**ERROR retrieving inspection milestones: "+r.getErrorMessage());return false}inspMilestones=r.getOutput();if(!inspMilestones){logDebug("No Inspection Milestones found");return false}for(thisM in inspMilestones){var i=inspMilestones[thisM];if(e.equals(i.getInspType())){if(t)i.setInspRequired("Y");else i.setInspRequired("N");r=aa.inspection.updateInspectionMilestone(inspMilestones);if(r.getSuccess())logDebug("inspection milestone updated sucessfully.");else logDebug("**ERROR: could not update inpsection milestone "+r.getErrorMessage())}}}function editLookup(e,t,n){var r=aa.bizDomain.getBizDomainByValue(e,t);if(r.getSuccess()){bds=r.getOutput()}else{logDebug("Std Choice("+e+","+t+") does not exist to edit, adding...");addLookup(e,t,n);return false}var i=bds.getBizDomain();i.setDescription(n);var s=aa.bizDomain.editBizDomain(i);if(s.getSuccess())logDebug("Successfully edited Std Choice("+e+","+t+") = "+n);else logDebug("**ERROR editing Std Choice "+s.getErrorMessage())}function editPriority(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();cd.setPriority(e);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("updated priority to "+e);return true}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function editRefLicProfAttribute(e,t,n){var r=false;var s=null;licObj=getRefLicenseProf(e);if(!licObj){logDebug("**WARNING Licensed Professional : "+e+" not found");return false}licSeqNum=licObj.getLicSeqNbr();attributeType=licObj.getLicenseType();if(licSeqNum==null||attributeType==""||attributeType==null){logDebug("**WARNING Licensed Professional Sequence Number or Attribute Type missing");return false}var o=aa.people.getPeopleAttributeByPeople(licSeqNum,attributeType);if(!o.getSuccess()){logDebug("**WARNING retrieving reference license professional attribute: "+o.getErrorMessage());return false}var u=o.getOutput();for(i in u){if(t.equals(u[i].getAttributeName())){s=u[i].getAttributeValue();r=true;break}}if(r){logDebug("Updated Ref Lic Prof: "+e+", attribute: "+t+" from: "+s+" to: "+n);u[i].setAttributeValue(n);aa.people.editPeopleAttribute(u[i].getPeopleAttributeModel())}else{logDebug("**WARNING attribute: "+t+" not found for Ref Lic Prof: "+e)}}function editReportedChannel(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();cd.setReportedChannel(e);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("updated reported channel to "+e);return true}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function editFirstIssuedDate(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();var i=new Date(e);var s=aa.date.transToJavaUtilDate(i.getTime());cd.setFirstIssuedDate(s);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("updated first issued date to "+s);return true}else{logDebug("**ERROR updating first issued date: "+cdWrite.getErrorMessage());return false}}function editTaskACAVisibility(e,t,n,r){var s=false;var o="";if(arguments.length==4){o=arguments[3];s=true}var u=aa.workflow.getTasks(capId);if(u.getSuccess())var a=u.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in a){fTask=a[i];if(fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||fTask.getProcessCode().equals(o))){var f=a[i].getTaskItem();f.setIsRestrictView4ACA(n?"Y":"N");f.setDisplayInACA(t?"Y":"N");f.setRestrictRole(r+"00000");var l=aa.workflow.editTask(f,currentUserID);if(l.getSuccess())logDebug("Set Workflow visible flags: "+t+" , "+n);else{logMessage("**ERROR: Failed to update task, comment visible flags on workflow task: "+l.getErrorMessage());return false}}}}function editTaskComment(e,t){var n=false;var r="";if(arguments.length==3){r=arguments[2];n=true}var s=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(s.getSuccess())var o=s.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in o){fTask=o[i];if(fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!n||fTask.getProcessCode().equals(r))){o[i].setDispositionComment(t);var u=o[i].getTaskItem();var a=aa.workflow.adjustTaskWithNoAudit(u);if(a.getSuccess())logDebug("Set Workflow: "+e+" comment "+t);else{logMessage("**ERROR: Failed to update comment on workflow task: "+a.getErrorMessage());return false}}}}function editTaskDueDate(e,t){var n=false;var r="";if(arguments.length==3){r=arguments[2];n=true}var s=e;if(e=="*"){s=""}var o=aa.workflow.getTaskItems(capId,s,r,null,null,null);if(o.getSuccess())wfObj=o.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){var u=wfObj[i];if((u.getTaskDescription().toUpperCase().equals(e.toUpperCase())||e=="*")&&(!n||u.getProcessCode().equals(r))){wfObj[i].setDueDate(aa.date.parseDate(t));var a=wfObj[i].getTaskItem();var f=aa.workflow.adjustTaskWithNoAudit(a);if(f.getSuccess())logDebug("Set Workflow Task: "+u.getTaskDescription()+" due Date "+t);else{logMessage("**ERROR: Failed to update due date on workflow: "+f.getErrorMessage());return false}}}}function editTaskSpecific(e,t,n){var r=false;var i=0;itemCap=capId;if(arguments.length==4)itemCap=arguments[3];var s=aa.workflow.getTaskItems(itemCap,e,null,null,null,null);if(s.getSuccess())wfObj=s.getOutput();else{logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){fTask=wfObj[i];stepnumber=fTask.getStepNumber();processID=fTask.getProcessID();if(e.equals(fTask.getTaskDescription())){TSIResult=aa.taskSpecificInfo.getTaskSpecifiInfoByDesc(itemCap,processID,stepnumber,t);if(TSIResult.getSuccess()){var o=TSIResult.getOutput();if(o!=null){var u=new Array;TSInfoModel=o.getTaskSpecificInfoModel();TSInfoModel.setChecklistComment(n);u.push(TSInfoModel);TSIUResult=aa.taskSpecificInfo.editTaskSpecInfos(u);if(TSIUResult.getSuccess()){logDebug("Successfully updated TSI Task="+e+" Item="+t+" Value="+n);AInfo[t]=n}else{logDebug("**ERROR: Failed to Update Task Specific Info : "+TSIUResult.getErrorMessage());return false}}else logDebug("No task specific info field called "+t+" found for task "+e)}else{logDebug("**ERROR: Failed to get Task Specific Info objects: "+TSIResult.getErrorMessage());return false}}}}function email(e,t,n,r){aa.sendMail(t,e,"",n,r);logDebug("Email sent to "+e);return true}function emailContact(e,t){var n="noreply@accela.com";var r="Applicant";var i="";if(arguments.length==3)r=arguments[2];var s=aa.people.getCapContactByCapID(capId);if(s.getSuccess()){var o=s.getOutput();for(yy in o)if(r.equals(o[yy].getCapContactModel().getPeople().getContactType()))if(o[yy].getEmail()!=null)i=""+o[yy].getEmail()}if(i.indexOf("@")>0){aa.sendMail(n,i,"",e,t);logDebug("Successfully sent email to "+r)}else logDebug("Couldn't send email to "+r+", no valid email address")}function encode64(e){var t="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";e=escape(e);var n="";var r,i,s="";var o,u,a,f="";var l=0;do{r=e.charCodeAt(l++);i=e.charCodeAt(l++);s=e.charCodeAt(l++);o=r>>2;u=(r&3)<<4|i>>4;a=(i&15)<<2|s>>6;f=s&63;if(isNaN(i)){a=f=64}else if(isNaN(s)){f=64}n=n+t.charAt(o)+t.charAt(u)+t.charAt(a)+t.charAt(f);r=i=s="";o=u=a=f=""}while(l<e.length);return n}function endBranch(){stopBranch=true}function executeASITable(tableArray){for(xx in tableArray){var doTableObj=tableArray[xx];var myCriteria=doTableObj["Criteria"];aa.print("cri: "+myCriteria);var myAction=doTableObj["Action"];aa.print("act: "+myAction);aa.print("enabled: "+doTableObj["Enabled"]);if(doTableObj["Enabled"]=="Yes")if(eval(token(myCriteria)))eval(token(myAction))}}function exists(e,t){for(ii in t)if(t[ii]==e)return true;return false}function externalLP_CA(e,t,n,r,i){var s="";var o=new Array;if(e)o.push(String(e));if(i){var u=aa.licenseScript.getLicenseProf(i);if(u.getSuccess()){var a=u.getOutput()}else{logDebug("**ERROR: getting lic prof: "+u.getErrorMessage());return false}if(a==null||!a.length){logDebug("**WARNING: no licensed professionals on this CAP")}else{for(var f in a)if(a[f].getLicenseType()==t)o.push(a[f])}}else r=false;for(var f=0;f<o.length;f++){var e=o[f];var l=null;var c=false;if(typeof e=="object"){l=e;e=l.getLicenseNbr();c=true}var h;var p;var d="https://www2.cslb.ca.gov/IVR/License+Detail.aspx?LicNum="+e;var v=aa.httpClient.get(d);var m=false;if(v.getSuccess()){var g=v.getOutput();var y=aa.proxyInvoker.newInstance("java.io.StringBufferInputStream",new Array(g)).getOutput();var b=aa.proxyInvoker.newInstance("org.jdom.input.SAXBuilder").getOutput();h=b.build(y);p=h.getRootElement();errorNode=p.getChild("Error")}else{m=true}if(m){logDebug("The CSLB web service is currently unavailable");continue}else if(errorNode){logDebug("Error for license "+e+" : "+errorNode.getText().replace(/\+/g," "));s+="License "+e+" : "+errorNode.getText().replace(/\+/g," ")+" ";continue}var w=p.getChild("BusinessInfo");var E=p.getChild("PrimaryStatus");var S=p.getChild("Classifications");var x=p.getChild("ContractorBond");var T=p.getChild("WorkersComp");var N=E.getChildren();for(var C=0;C<N.size();C++){var k=N.get(C);if(k.getAttribute("Code").getValue()!="10")s+="License:"+e+", "+k.getAttribute("Desc").getValue()+" "}if(n){var L=false;var A=getRefLicenseProf(e);if(A){L=true;logDebug("Updating existing Ref Lic Prof : "+e)}else{var A=aa.licenseScript.createLicenseScriptModel()}if(c){if(l.getAddress1())A.setAddress1(l.getAddress1());if(l.getAddress2())A.setAddress2(l.getAddress2());if(l.getAddress3())A.setAddress3(l.getAddress3());if(l.getAgencyCode())A.setAgencyCode(l.getAgencyCode());if(l.getBusinessLicense())A.setBusinessLicense(l.getBusinessLicense());if(l.getBusinessName())A.setBusinessName(l.getBusinessName());if(l.getBusName2())A.setBusinessName2(l.getBusName2());if(l.getCity())A.setCity(l.getCity());if(l.getCityCode())A.setCityCode(l.getCityCode());if(l.getContactFirstName())A.setContactFirstName(l.getContactFirstName());if(l.getContactLastName())A.setContactLastName(l.getContactLastName());if(l.getContactMiddleName())A.setContactMiddleName(l.getContactMiddleName());if(l.getCountryCode())A.setContryCode(l.getCountryCode());if(l.getEmail())A.setEMailAddress(l.getEmail());if(l.getCountry())A.setCountry(l.getCountry());if(l.getEinSs())A.setEinSs(l.getEinSs());if(l.getFax())A.setFax(l.getFax());if(l.getFaxCountryCode())A.setFaxCountryCode(l.getFaxCountryCode());if(l.getHoldCode())A.setHoldCode(l.getHoldCode());if(l.getHoldDesc())A.setHoldDesc(l.getHoldDesc());if(l.getLicenseExpirDate())A.setLicenseExpirationDate(l.getLicenseExpirDate());if(l.getLastRenewalDate())A.setLicenseLastRenewalDate(l.getLastRenewalDate());if(l.getLicesnseOrigIssueDate())A.setLicOrigIssDate(l.getLicesnseOrigIssueDate());if(l.getPhone1())A.setPhone1(l.getPhone1());if(l.getPhone1CountryCode())A.setPhone1CountryCode(l.getPhone1CountryCode());if(l.getPhone2())A.setPhone2(l.getPhone2());if(l.getPhone2CountryCode())A.setPhone2CountryCode(l.getPhone2CountryCode());if(l.getSelfIns())A.setSelfIns(l.getSelfIns());if(l.getState())A.setState(l.getState());if(l.getSuffixName())A.setSuffixName(l.getSuffixName());if(l.getZip())A.setZip(l.getZip())}if(w.getChild("Name").getText()!="")A.setBusinessName(unescape(w.getChild("Name").getText()).replace(/\+/g," "));if(w.getChild("Addr1").getText()!="")A.setAddress1(unescape(w.getChild("Addr1").getText()).replace(/\+/g," "));if(w.getChild("Addr2").getText()!="")A.setAddress2(unescape(w.getChild("Addr2").getText()).replace(/\+/g," "));if(w.getChild("City").getText()!="")A.setCity(unescape(w.getChild("City").getText()).replace(/\+/g," "));if(w.getChild("State").getText()!="")A.setState(unescape(w.getChild("State").getText()).replace(/\+/g," "));if(w.getChild("Zip").getText()!="")A.setZip(unescape(w.getChild("Zip").getText()).replace(/\+/g," "));if(w.getChild("BusinessPhoneNum").getText()!="")A.setPhone1(unescape(stripNN(w.getChild("BusinessPhoneNum").getText()).replace(/\+/g," ")));A.setAgencyCode(aa.getServiceProviderCode());A.setAuditDate(sysDate);A.setAuditID(currentUserID);A.setAuditStatus("A");A.setLicenseType(t);A.setLicState("CA");A.setStateLicense(e);if(w.getChild("IssueDt").getText())A.setLicenseIssueDate(aa.date.parseDate(w.getChild("IssueDt").getText()));if(w.getChild("ExpireDt").getText())A.setLicenseExpirationDate(aa.date.parseDate(w.getChild("ExpireDt").getText()));if(w.getChild("ReissueDt").getText())A.setLicenseLastRenewalDate(aa.date.parseDate(w.getChild("ReissueDt").getText()));var O=p.getChild("WorkersComp").getChildren();for(var M=0;M<O.size();M++){wc=O.get(M);if(wc.getAttribute("PolicyNo").getValue())A.setWcPolicyNo(wc.getAttribute("PolicyNo").getValue());if(wc.getAttribute("InsCoCde").getValue())A.setWcInsCoCode(unescape(wc.getAttribute("InsCoCde").getValue()));if(wc.getAttribute("WCEffDt").getValue())A.setWcEffDate(aa.date.parseDate(wc.getAttribute("WCEffDt").getValue()));if(wc.getAttribute("WCExpDt").getValue())A.setWcExpDate(aa.date.parseDate(wc.getAttribute("WCExpDt").getValue()));if(wc.getAttribute("WCCancDt").getValue())A.setWcCancDate(aa.date.parseDate(wc.getAttribute("WCCancDt").getValue()));if(wc.getAttribute("Exempt").getValue()=="E")A.setWcExempt("Y");else A.setWcExempt("N");break}if(L){var _=aa.licenseScript.editRefLicenseProf(A);var D=A.getLicSeqNbr()}else{var _=aa.licenseScript.createRefLicenseProf(A);if(!_.getSuccess()){logDebug("**WARNING: can't create ref lic prof: "+_.getErrorMessage());continue}var D=_.getOutput()}logDebug("Successfully added/updated License No. "+e+", Type: "+t+" Sequence Number "+D);if(c){var P=l.getAttributes();if(P){for(var H in P){var B=P[H];editRefLicProfAttribute(e,B.getAttributeName(),B.getAttributeValue())}}}var j=p.getChild("Classifications").getChildren();for(var F=0;F<j.size();F++){cb=j.get(F);if(F==0){editRefLicProfAttribute(e,"CLASS CODE 1",cb.getAttribute("Code").getValue());editRefLicProfAttribute(e,"CLASS DESC 1",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))}if(F==1){editRefLicProfAttribute(e,"CLASS CODE 2",cb.getAttribute("Code").getValue());editRefLicProfAttribute(e,"CLASS DESC 2",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))}if(F==2){editRefLicProfAttribute(e,"CLASS CODE 3",cb.getAttribute("Code").getValue());editRefLicProfAttribute(e,"CLASS DESC 3",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))}if(F==3){editRefLicProfAttribute(e,"CLASS CODE 4",cb.getAttribute("Code").getValue());editRefLicProfAttribute(e,"CLASS DESC 4",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))}}var I=p.getChild("ContractorBond").getChildren();for(var q=0;q<I.size();q++){var R=I.get(q);if(R.getAttribute("BondAmt").getValue())editRefLicProfAttribute(e,"BOND AMOUNT",unescape(R.getAttribute("BondAmt").getValue()));if(R.getAttribute("BondCancDt").getValue())editRefLicProfAttribute(e,"BOND EXPIRATION",unescape(R.getAttribute("BondCancDt").getValue()));break}if(r){var U=aa.licenseScript.getRefLicenseProfBySeqNbr(servProvCode,D);if(!U.getSuccess()){logDebug("**WARNING error retrieving the LP just created "+U.getErrorMessage())}var z=U.getOutput();var W=false;if(a!=null){for(var X in a){var V=a[X];if(V.getLicenseType()==t&&V.getLicenseNbr()==e){logDebug("Removing license: "+V.getLicenseNbr()+" from CAP.  We will link the new reference LP");if(V.getPrintFlag()=="Y"){logDebug("...remove primary status...");W=true;V.setPrintFlag("N");aa.licenseProfessional.editLicensedProfessional(V)}var $=aa.licenseProfessional.removeLicensedProfessional(V);if(u.getSuccess()){logDebug("...Success.")}else{logDebug("**WARNING removing lic prof: "+$.getErrorMessage())}}}}var J=aa.licenseScript.associateLpWithCap(i,z);if(!J.getSuccess()){logDebug("**WARNING error associating CAP to LP: "+J.getErrorMessage())}else{logDebug("Associated the CAP to the new LP")}if(W){var K=getLicenseProfessional(i);for(var Q in K){if(K[Q].getLicenseNbr().equals(e)){var G=K[Q];G.setPrintFlag("Y");aa.licenseProfessional.editLicensedProfessional(G);logDebug("Updated primary flag on Cap LP : "+e)}}}}}}if(s.length>0)return s;else return null}function feeAmount(e){var t=false;var n=new Array;if(arguments.length>1){t=true;for(var r=1;r<arguments.length;r++)n.push(arguments[r])}var i=0;var s=aa.fee.getFeeItems(capId,e,null);if(s.getSuccess()){var o=s.getOutput()}else{logDebug("**ERROR: getting fee items: "+s.getErrorMessage());return false}for(ff in o)if(e.equals(o[ff].getFeeCod())&&(!t||exists(o[ff].getFeeitemStatus(),n)))i+=o[ff].getFee();return i}function feeAmountExcept(e){var t=false;var n=new Array;if(arguments.length>1){t=true;for(var r=1;r<arguments.length;r++)n.push(arguments[r])}var i=0;var s=aa.fee.getFeeItems(e);if(s.getSuccess()){var o=s.getOutput()}else{logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage());return false}for(ff in o)if(!t||!exists(o[ff].getFeeCod(),n))i+=o[ff].getFee();return i}function feeBalance(e){var t=0;var n=0;var r;if(arguments.length==2)r=arguments[1];var i=aa.fee.getFeeItems(capId,e,null);if(i.getSuccess()){var s=i.getOutput()}else{logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage());return false}for(ff in s)if((!e||e.equals(s[ff].getFeeCod()))&&(!r||r.equals(s[ff].getF4FeeItemModel().getFeeSchudle()))){t+=s[ff].getFee();var o=aa.finance.getPaymentFeeItems(capId,null);if(o.getSuccess()){var u=o.getOutput();for(ij in u)if(s[ff].getFeeSeqNbr()==u[ij].getFeeSeqNbr())n+=u[ij].getFeeAllocation()}}return t-n}function feeBalanceFromDate(e,t){var n=0;var r=0;var i;var s=new Date;var o=new Date;o.setDate(o.getDate()+e);if(arguments.length==3)i=arguments[2];var u=aa.fee.getFeeItems(capId);if(u.getSuccess()){var a=u.getOutput()}else{logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage());return false}for(ff in a){s.setTime(a[ff].getApplyDate().getEpochMilliseconds());if((!t||t.equals(a[ff].getFeeCod()))&&(!i||i.equals(a[ff].getF4FeeItemModel().getFeeSchudle()))&&s>=o){n+=a[ff].getFee();var f=aa.finance.getPaymentFeeItems(capId,null);if(f.getSuccess()){var l=f.getOutput();for(ij in l)if(a[ff].getFeeSeqNbr()==l[ij].getFeeSeqNbr())r+=l[ij].getFeeAllocation()}}}return n-r}function feeCopyByDateRange(e,t){var n=new Date(e);n.setHours(0,0,0,0);var r=new Date(t);r.setHours(23,59,59,999);var i=false;var s=new Array;if(arguments.length>2){i=true;for(var o=2;o<arguments.length;o++)s.push(arguments[o])}var u=aa.fee.getFeeItems(capId);if(u.getSuccess()){var a=u.getOutput()}else{logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage());return false}var f=0;var l=new Date;for(ff in a){l.setTime(a[ff].getApplyDate().getEpochMilliseconds());if(l>=n&&l<=r&&(!i||exists(a[ff].getFeeitemStatus(),s))){addFee(ffeObjArr[ff].getFeeCod(),ffeObjArr[ff].getFeeSchudle(),ffeObjArr[ff].getPaymentPeriod(),ffeObjArr[ff].getFeeUnit(),"Y")}}return f}function feeExists(e){var t=false;var n=new Array;if(arguments.length>1){t=true;for(var r=1;r<arguments.length;r++)n.push(arguments[r])}var i=aa.fee.getFeeItems(capId,e,null);if(i.getSuccess()){var s=i.getOutput()}else{logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage());return false}for(ff in s)if(e.equals(s[ff].getFeeCod())&&(!t||exists(s[ff].getFeeitemStatus(),n)))return true;return false}function feeGetTotByDateRange(e,t){var n=new Date(e);n.setHours(0,0,0,0);var r=new Date(t);r.setHours(23,59,59,999);var i=false;var s=new Array;if(arguments.length>2){i=true;for(var o=2;o<arguments.length;o++)s.push(arguments[o])}var u=aa.fee.getFeeItems(capId);if(u.getSuccess()){var a=u.getOutput()}else{logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage());return false}var f=0;var l=new Date;for(ff in a){l.setTime(a[ff].getApplyDate().getEpochMilliseconds());if(l>=n&&l<=r&&(!i||exists(a[ff].getFeeitemStatus(),s))){f+=a[ff].getFee()}}return f}function feeQty(e){var t=0;var n=aa.fee.getFeeItems(capId,e,null);if(n.getSuccess()){var r=n.getOutput()}else{logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage());return false}for(ff in r)if(e.equals(r[ff].getFeeCod()))t+=r[ff].getFeeUnit();return t}function generateReport(e,t,n,r){var i=currentUserID;var s=aa.reportManager.getReportInfoModelByName(t);s=s.getOutput();s.setModule(n);s.setCapId(e.getCustomID());s.setReportParameters(r);var o=aa.reportManager.hasPermission(t,i);if(o.getOutput().booleanValue()){var u=aa.reportManager.getReportResult(s);if(u){reportOutput=u.getOutput();var a=aa.reportManager.storeReportToDisk(reportOutput);a=a.getOutput();return a}else{logDebug("System failed get report: "+u.getErrorType()+":"+u.getErrorMessage());return false}}else{logDebug("You have no permission.");return false}}function generateReport4Workflow(e,t,n,r){var i=currentUserID;var s=aa.reportManager.getReportModelByName(t);s=s.getOutput();var o=aa.reportManager.hasPermission(t,i);if(o.getOutput().booleanValue()){var u=aa.reportManager.runReport(r,s);if(u){return reportOutput=u.getOutput()}else{logDebug("System failed get report: "+u.getErrorType()+":"+u.getErrorMessage());return false}}else{logDebug("You have no permission.");return false}}function genericTemplateObject(e){this.ASI=new Array;this.ASIT=new Array;this.hasASI=false;this.hasTables=false;this.template=e;var t=template.getTemplateForms();var n=new Array;if(t!=null){aa.print(t);n=t.toArray();for(grp in n){var r=n[grp].getSubgroups();if(r!=null){var s=r.toArray();this.hasASI=true;for(sgrp in s){var o=s[sgrp].getSubgroupName();var u=s[sgrp].getFields().toArray();for(fld in u){this.ASI[o+"."+u[fld].getFieldName()]=u[fld].getDefaultValue()}}}}}var a=template.getTemplateTables();var f=new Array;if(a!=null){var f=a.toArray();for(grp in f){var r=f[grp].getSubgroups();if(r!=null){var s=r.toArray();for(sgrp in s){var o=s[sgrp].getSubgroupName();this.ASIT[o]=new Array;this.hasTables=true;var l=s[sgrp].getRows();if(l!=null){var c=l.toArray();for(i=0;i<c.length;i++){this.ASIT[o][i]=new Array;var u=c[i].getValues().toArray();for(fld in u){this.ASIT[o][i][u[fld].getFieldName()]=u[fld].getValue()}}}}}}}return this}function getACADocDownloadParam4Notification(e,t,n){addParameter(e,"$$acaDocDownloadUrl$$",getACADocumentDownloadUrl(t,n));return e}function getACADocumentDownloadUrl(e,t){var n=aa.document.getACADocumentUrl(e,t);if(n.getSuccess()){acaDocUrl=n.getOutput();return acaDocUrl}else{logDebug("Error retrieving ACA Document URL: "+n.getErrorType());return false}}function getACARecordParam4Notification(e,t){addParameter(e,"$$acaRecordUrl$$",getACARecordURL(t));return e}function getACARecordURL(e){var t="";var n=capId.ID1;var r=capId.ID2;var i=capId.ID3;t=e+"/urlrouting.ashx?type=1000";t+="&Module="+cap.getCapModel().getModuleName();t+="&capID1="+n+"&capID2="+r+"&capID3="+i;t+="&agencyCode="+aa.getServiceProviderCode();return t}function getACAUrl(){itemCap=capId;if(arguments.length==1)itemCap=arguments[0];var e="";var t=capId.getID1();var n=capId.getID2();var r=capId.getID3();var i=aa.cap.getCap(capId).getOutput().getCapModel();e+="/urlrouting.ashx?type=1000";e+="&Module="+i.getModuleName();e+="&capID1="+t+"&capID2="+n+"&capID3="+r;e+="&agencyCode="+aa.getServiceProviderCode();return e}function getAddressCountyByAddressType(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.address.getAddressByCapId(t);if(n.getSuccess()){var r=n.getOutput();for(var i in r){var s=r[i];if(s.getAddressType()!=null){if(String(s.getAddressType()).toUpperCase().equals(e.toUpperCase())){return s.getCounty()}}}}else{logDebug("Could not return address: "+n.getErrorMessage());return false}logDebug("Could not find an address of type: "+e);return false}function getAddressLineByAddressType(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.address.getAddressByCapId(t);if(n.getSuccess()){var r=n.getOutput();for(var i in r){var s=r[i];if(s.getAddressType()!=null){if(String(s.getAddressType()).toUpperCase().equals(e.toUpperCase())){return s.getDisplayAddress()}}}}else{logDebug("Could not return address: "+n.getErrorMessage());return false}logDebug("Could not find an address of type: "+e);return false}function getAppConditions(e,t,n,r,i){if(t==null)var s=aa.capCondition.getCapConditions(capId);else var s=aa.capCondition.getCapConditions(capId,t);if(s.getSuccess())var o=s.getOutput();else{logMessage("**ERROR: getting cap conditions: "+s.getErrorMessage());logDebug("**ERROR: getting cap conditions: "+s.getErrorMessage())}var u;var a;var f;var l="";for(cc in o){var c=o[cc];var u=c.getConditionStatus();var a=c.getConditionDescription();var h=c.getDispPublicDisplayMessage();var f=c.getImpactCode();var p=c.getConditionType();if(u==null)u=" ";if(a==null)a=" ";if(f==null)f=" ";if((n==null||n.toUpperCase().equals(u.toUpperCase()))&&(r==null||r.toUpperCase().equals(a.toUpperCase()))&&(i==null||i.toUpperCase().equals(f.toUpperCase())))l+=a+": "+h}addParameter(e,"$$conditions$$",l);return e}function getAppIdByASI(e,t,n){var r=n.split("/");if(r.length!=4)logDebug("**ERROR: getAppIdByASI in appMatch.  The following Application Type String is incorrectly formatted: "+n);var i=aa.cap.getCapIDsByAppSpecificInfoField(e,t);if(i.getSuccess())var s=i.getOutput();else{logDebug("**ERROR: getting caps by app type: "+i.getErrorMessage());return null}for(aps in s){myCap=aa.cap.getCap(s[aps].getCapID()).getOutput();myAppTypeString=myCap.getCapType().toString();myAppTypeArray=myAppTypeString.split("/");isMatch=true;for(xx in r)if(!r[xx].equals(myAppTypeArray[xx])&&!r[xx].equals("*"))isMatch=false;if(isMatch){logDebug("getAppIdByName("+e+","+t+","+n+") Returns "+s[aps].getCapID().toString());return s[aps].getCapID().toString()}}}function getAppIdByName(e,t,n){getCapResult=aa.cap.getByAppType(e,t);if(getCapResult.getSuccess())var r=getCapResult.getOutput();else{logDebug("**ERROR: getting caps by app type: "+getCapResult.getErrorMessage());return null}for(aps in r){var i=aa.cap.getCap(r[aps].getCapID()).getOutput();if(i.getSpecialText().equals(n)){logDebug("getAppIdByName("+e+","+t+","+n+") Returns "+r[aps].getCapID().toString());return r[aps].getCapID().toString()}}}function getApplication(e){var t=aa.cap.getCapID(e);if(t.getSuccess())return t.getOutput();else{logDebug("**ERROR: getting cap id ("+e+"): "+t.getErrorMessage())}}function getAppSpecific(e){var t=false;var n=0;var r=capId;if(arguments.length==2)r=arguments[1];if(useAppSpecificGroupName){if(e.indexOf(".")<0){logDebug("**WARNING: editAppSpecific requires group name prefix when useAppSpecificGroupName is true");return false}var i=e.substr(0,e.indexOf("."));var e=e.substr(e.indexOf(".")+1)}var s=aa.appSpecificInfo.getByCapID(r);if(s.getSuccess()){var o=s.getOutput();if(e!=""){for(n in o)if(o[n].getCheckboxDesc()==e&&(!useAppSpecificGroupName||o[n].getCheckboxType()==i)){return o[n].getChecklistComment();break}}}else{logDebug("**ERROR: getting app specific info for Cap : "+s.getErrorMessage())}}function getCapByAddress(e){var t=new Array;var n=aa.address.getAddressByCapId(capId);if(n.getSuccess()){var r=n.getOutput()}else{logDebug("**ERROR: getting address by cap ID: "+n.getErrorMessage());return false}if(r.length){var i=r[0]}else{logDebug("**WARNING: no address for comparison:");return false}var s=aa.cap.getCapListByDetailAddress(i.getStreetName(),i.getHouseNumberStart(),i.getStreetSuffix(),i.getZip(),i.getStreetDirection(),null);if(s.getSuccess()){var o=s.getOutput()}else{logDebug("**ERROR: getting similar addresses: "+s.getErrorMessage());return false}for(cappy in o){var u=aa.cap.getCap(o[cappy].getCapID()).getOutput();reltype=u.getCapType().toString();var a=true;var f=e.split("/");if(f.length!=4)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in f)if(!f[xx].equals(appTypeArray[xx])&&!f[xx].equals("*"))a=false;if(a)t.push(o[cappy])}if(t.length>1){logDebug("**WARNING: Multiple caps returned for this address/apptype");return t[0]}if(t.length==0)return t[0]}function getCapId(){var e=aa.env.getValue("PermitId1");var t=aa.env.getValue("PermitId2");var n=aa.env.getValue("PermitId3");if(e==null||e==""||t==null||t==""||n==null||n==""){return null}var r=aa.cap.getCapID(e,t,n);if(r.getSuccess())return r.getOutput();else{logMessage("**ERROR: Failed to get capId: "+r.getErrorMessage());return null}}function getCapsWithConditionsRelatedByRefContact(e,t,n,r,i,s){var o=new Array;var u=aa.people.getCapContactByCapID(e).getOutput();for(var a in u){var f=u[a];if(f.getCapContactModel().getRefContactNumber()){var l=f.getPeople();var c=aa.people.createPeopleModel().getOutput();c.setContactSeqNumber(f.getCapContactModel().getRefContactNumber());var h=aa.people.getCapIDsByRefContact(c);if(h.getSuccess()){var p=h.getOutput();for(var d in p){var v=p[d];if(appMatch(t,v)){if(n==null)var m=aa.capCondition.getCapConditions(v);else var m=aa.capCondition.getCapConditions(v,n);if(m.getSuccess())var g=m.getOutput();else{logMessage("**ERROR: getting cap conditions: "+m.getErrorMessage());logDebug("**ERROR: getting cap conditions: "+m.getErrorMessage());return false}var y;var b;var w;for(cc in g){var E=g[cc];var y=E.getConditionStatus();var b=E.getConditionDescription();var w=E.getImpactCode();var S=E.getConditionType();if(y==null)y=" ";if(b==null)b=" ";if(w==null)w=" ";if((r==null||r.toUpperCase().equals(y.toUpperCase()))&&(i==null||i.toUpperCase().equals(b.toUpperCase()))&&(s==null||s.toUpperCase().equals(w.toUpperCase())))o.push(v)}}}}}}}function getChildren(e,t){var n=new Array;if(t!=null)var r=t;else var r=capId;if(arguments.length>2)var i=arguments[2];else var i=null;var s=e.split("/");if(s.length!=4)logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+e);var o=aa.cap.getChildByMasterID(r);if(!o.getSuccess()){logDebug("**WARNING: getChildren returned an error: "+o.getErrorMessage());return null}var u=o.getOutput();if(!u.length){logDebug("**WARNING: getChildren function found no children");return null}var a;var f="";var l;var c;for(xx in u){a=u[xx].getCapID();if(i!=null&&i.getCustomID().equals(a.getCustomID()))continue;f=aa.cap.getCap(a).getOutput().getCapType().toString();l=f.split("/");c=true;for(yy in l){if(!s[yy].equals(l[yy])&&!s[yy].equals("*")){c=false;continue}}if(c)n.push(a)}logDebug("getChildren returned "+n.length+" capIds");return n}function getChildTasks(e){var t=new Array;var n=null;var r=capId;if(arguments.length>1)r=arguments[1];var s=aa.workflow.getTaskItems(r,e,null,null,null,null);var o=s.getOutput();for(i in o){var u=o[i];if(u.getTaskDescription().equals(e)){var a=aa.workflow.getProcessRelationByCapID(r,null).getOutput();for(thisRel in a){y=a[thisRel];if(y.getParentTaskName()&&y.getParentTaskName().equals(u.getTaskDescription()))n=y.getProcessID()}}}for(i in o){var u=o[i];if(u.getProcessID()==n)t.push(u)}return t}function getCAPConditions(e,t,n,r){var i=new Array;var s="en_US";var o=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(o.getSuccess())s=o.getOutput().getDescription();if(arguments.length>4)var u=arguments[4];else var u=capId;if(e==null)var a=aa.capCondition.getCapConditions(u);else var a=aa.capCondition.getCapConditions(u,e);if(a.getSuccess())var f=a.getOutput();else{var f=new Array;logDebug("**WARNING: getting cap conditions: "+a.getErrorMessage())}var l;var c;var h;for(cc in f){var p=f[cc];var l=p.getConditionStatus();var c=p.getConditionDescription();var h=p.getImpactCode();var d=p.getConditionType();var v=p.getConditionComment();var m=p.getExpireDate();if(l==null)l=" ";if(c==null)c=" ";if(h==null)h=" ";if((t==null||t.toUpperCase().equals(l.toUpperCase()))&&(n==null||n.toUpperCase().equals(c.toUpperCase()))&&(r==null||r.toUpperCase().equals(h.toUpperCase()))){var g=new condMatchObj;g.objType="Record";g.object=p;g.status=l;g.type=d;g.impact=h;g.description=c;g.comment=v;g.expireDate=m;var y=aa.condition.getCondition(p,s).getOutput();g.arObject=y;g.arDescription=y.getResConditionDescription();g.arComment=y.getResConditionComment();i.push(g)}}return i}function getAddressConditions(e,t,n,r){var i=new Array;var s="en_US";var o=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(o.getSuccess())s=o.getOutput().getDescription();if(arguments.length>4)var u=arguments[4];else var u=capId;var a=aa.address.getAddressByCapId(u);if(!a.getSuccess()){logDebug("**WARNING: getting CAP addresses: "+a.getErrorMessage());var f=new Array}else{var f=a.getOutput();if(!f)f=new Array}for(var l in f)if(f[l].getRefAddressId()){addCondResult=aa.addressCondition.getAddressConditions(f[l].getRefAddressId());if(!addCondResult.getSuccess()){logDebug("**WARNING: getting Address Conditions : "+addCondResult.getErrorMessage());var c=new Array}else{var c=addCondResult.getOutput()}for(var h in c){var p=c[h];var d=p.getConditionType();var v=p.getConditionStatus();var m=p.getConditionDescription();var g=p.getImpactCode();var d=p.getConditionType();var y=p.getConditionComment();var b=p.getExpireDate();if(d==null)d=" ";if(v==null)v=" ";if(m==null)m=" ";if(g==null)g=" ";if((e==null||e.toUpperCase().equals(d.toUpperCase()))&&(t==null||t.toUpperCase().equals(v.toUpperCase()))&&(n==null||n.toUpperCase().equals(m.toUpperCase()))&&(r==null||r.toUpperCase().equals(g.toUpperCase()))){var w=new condMatchObj;w.objType="Address";w.addressObj=f[l];w.status=v;w.type=d;w.impact=g;w.description=m;w.comment=y;w.expireDate=b;var E=aa.condition.getCondition(p,s).getOutput();w.arObject=E;w.arDescription=E.getResConditionDescription();w.arComment=E.getResConditionComment();i.push(w)}}}return i}function getParcelConditions(e,t,n,r){var i=new Array;var s="en_US";var o=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(o.getSuccess())s=o.getOutput().getDescription();if(arguments.length>4)var u=arguments[4];else var u=capId;var a=aa.parcel.getParcelDailyByCapID(u,null);if(!a.getSuccess()){logDebug("**WARNING: getting CAP addresses: "+a.getErrorMessage());var f=new Array}else{var f=a.getOutput();if(!f)f=new Array}for(var l in f)if(f[l].getParcelNumber()){parcCondResult=aa.parcelCondition.getParcelConditions(f[l].getParcelNumber());if(!parcCondResult.getSuccess()){logDebug("**WARNING: getting Parcel Conditions : "+parcCondResult.getErrorMessage());var c=new Array}else{var c=parcCondResult.getOutput()}for(var h in c){var p=c[h];var d=p.getConditionType();var v=p.getConditionStatus();var m=p.getConditionDescription();var g=p.getImpactCode();var d=p.getConditionType();var y=p.getConditionComment();var b=p.getExpireDate();if(d==null)d=" ";if(v==null)v=" ";if(m==null)m=" ";if(g==null)g=" ";if((e==null||e.toUpperCase().equals(d.toUpperCase()))&&(t==null||t.toUpperCase().equals(v.toUpperCase()))&&(n==null||n.toUpperCase().equals(m.toUpperCase()))&&(r==null||r.toUpperCase().equals(g.toUpperCase()))){var w=new condMatchObj;w.objType="Parcel";w.parcelObj=f[l];w.status=v;w.type=d;w.impact=g;w.description=m;w.comment=y;w.expireDate=b;var E=aa.condition.getCondition(p,s).getOutput();w.arObject=E;w.arDescription=E.getResConditionDescription();w.arComment=E.getResConditionComment();i.push(w)}}}return i}function getLicenseConditions(e,t,n,r){var i=new Array;var s="en_US";var o=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(o.getSuccess())s=o.getOutput().getDescription();if(arguments.length>4)var u=arguments[4];else var u=capId;var a=aa.licenseScript.getLicenseProf(u);if(!a.getSuccess()){logDebug("**WARNING: getting CAP licenses: "+a.getErrorMessage());var f=new Array}else{var f=a.getOutput();if(!f)f=new Array}for(var l in f)if(f[l].getLicenseProfessionalModel().getLicSeqNbr()){var c=aa.caeCondition.getCAEConditions(f[l].getLicenseProfessionalModel().getLicSeqNbr());if(!c.getSuccess()){logDebug("**WARNING: getting license Conditions : "+c.getErrorMessage());var h=new Array}else{var h=c.getOutput()}for(var p in h){var d=h[p];var v=d.getConditionType();var m=d.getConditionStatus();var g=d.getConditionDescription();var y=d.getImpactCode();var v=d.getConditionType();var b=d.getConditionComment();var w=d.getExpireDate();if(v==null)v=" ";if(m==null)m=" ";if(g==null)g=" ";if(y==null)y=" ";if((e==null||e.toUpperCase().equals(v.toUpperCase()))&&(t==null||t.toUpperCase().equals(m.toUpperCase()))&&(n==null||n.toUpperCase().equals(g.toUpperCase()))&&(r==null||r.toUpperCase().equals(y.toUpperCase()))){var E=new condMatchObj;E.objType="License";E.licenseObj=f[l];E.status=m;E.type=v;E.impact=y;E.description=g;E.comment=b;E.expireDate=w;var S=aa.condition.getCondition(d,s).getOutput();E.arObject=S;E.arDescription=S.getResConditionDescription();E.arComment=S.getResConditionComment();i.push(E)}}}return i}function getContactConditions(e,t,n,r){var i=new Array;var s="en_US";var o=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(o.getSuccess())s=o.getOutput().getDescription();if(arguments.length>4)var u=arguments[4];else var u=capId;var a=aa.people.getCapContactByCapID(u);if(!a.getSuccess()){logDebug("**WARNING: getting CAP contact: "+a.getErrorMessage());var f=new Array}else{var f=a.getOutput();if(!f)f=new Array}for(var l in f)if(f[l].getCapContactModel().getRefContactNumber()){var c=aa.commonCondition.getCommonConditions("CONTACT",f[l].getCapContactModel().getRefContactNumber());if(!c.getSuccess()){logDebug("**WARNING: getting contact Conditions : "+licCondResult.getErrorMessage());var h=new Array}else{var h=c.getOutput()}for(var p in h){var d=h[p];var v=d.getConditionType();var m=d.getConditionStatus();var g=d.getConditionDescription();var y=d.getImpactCode();var v=d.getConditionType();var b=d.getConditionComment();var w=d.getExpireDate();if(v==null)v=" ";if(m==null)m=" ";if(g==null)g=" ";if(y==null)y=" ";if((e==null||e.toUpperCase().equals(v.toUpperCase()))&&(t==null||t.toUpperCase().equals(m.toUpperCase()))&&(n==null||n.toUpperCase().equals(g.toUpperCase()))&&(r==null||r.toUpperCase().equals(y.toUpperCase()))){var E=new condMatchObj;E.objType="Contact";E.contactObj=f[l];E.status=m;E.type=v;E.impact=y;E.description=g;E.comment=b;E.expireDate=w;var S=aa.condition.getCondition(d,s).getOutput();E.arObject=S;E.arDescription=S.getResConditionDescription();E.arComment=S.getResConditionComment();i.push(E)}}}return i}function getConditions(e,t,n,r){var i=getCAPConditions(e,t,n,r);var s=getAddressConditions(e,t,n,r);if(s){for(var o=0;o<s.length;o++){i.push(s[o])}}var u=getParcelConditions(e,t,n,r);if(u){for(var o=0;o<u.length;o++){i.push(u[o])}}var a=getLicenseConditions(e,t,n,r);if(a){for(var o=0;o<a.length;o++){i.push(a[o])}}var f=getContactConditions(e,t,n,r);if(f){for(var o=0;o<f.length;o++){i.push(f[o])}}return i}function condMatchObj(){this.objType=null;this.object=null;this.contactObj=null;this.addressObj=null;this.licenseObj=null;this.parcelObj=null;this.status=null;this.type=null;this.impact=null;this.description=null;this.comment=null;this.arObject=null;this.arDescription=null;this.arComment=null;this.expireDate=null}function getContactArray(){var e=capId;if(arguments.length==1)e=arguments[0];var t=new Array;if(arguments.length==0&&!cap.isCompleteCap()&&controlString!="ApplicationSubmitAfter"){r=cap.getContactsGroup().toArray()}else{var n=aa.people.getCapContactByCapID(e);if(n.getSuccess()){var r=n.getOutput()}}if(r){for(yy in r){var i=new Array;i["lastName"]=r[yy].getPeople().lastName;i["refSeqNumber"]=r[yy].getCapContactModel().getRefContactNumber();i["firstName"]=r[yy].getPeople().firstName;i["middleName"]=r[yy].getPeople().middleName;i["businessName"]=r[yy].getPeople().businessName;i["contactSeqNumber"]=r[yy].getPeople().contactSeqNumber;i["contactType"]=r[yy].getPeople().contactType;i["relation"]=r[yy].getPeople().relation;i["phone1"]=r[yy].getPeople().phone1;i["phone2"]=r[yy].getPeople().phone2;i["email"]=r[yy].getPeople().email;i["addressLine1"]=r[yy].getPeople().getCompactAddress().getAddressLine1();i["addressLine2"]=r[yy].getPeople().getCompactAddress().getAddressLine2();i["city"]=r[yy].getPeople().getCompactAddress().getCity();i["state"]=r[yy].getPeople().getCompactAddress().getState();i["zip"]=r[yy].getPeople().getCompactAddress().getZip();i["fax"]=r[yy].getPeople().fax;i["notes"]=r[yy].getPeople().notes;i["country"]=r[yy].getPeople().getCompactAddress().getCountry();i["fullName"]=r[yy].getPeople().fullName;i["peopleModel"]=r[yy].getPeople();var s=new Array;if(arguments.length==0&&!cap.isCompleteCap()){var o=r[yy].getPeople().getAttributes();if(o)s=o.toArray()}else var s=r[yy].getCapContactModel().getPeople().getAttributes().toArray();for(xx1 in s)i[s[xx1].attributeName]=s[xx1].attributeValue;t.push(i)}}return t}function getContactArrayBefore(){var e=aa.env.getValue("ContactList");var t=e.toArray();var n=new Array;if(t){for(yy in t){var r=new Array;r["lastName"]=t[yy].getPeople().lastName;r["refSeqNumber"]=t[yy].getRefContactNumber();r["firstName"]=t[yy].getPeople().firstName;r["middleName"]=t[yy].getPeople().middleName;r["businessName"]=t[yy].getPeople().businessName;r["contactSeqNumber"]=t[yy].getPeople().contactSeqNumber;r["contactType"]=t[yy].getPeople().contactType;r["relation"]=t[yy].getPeople().relation;r["phone1"]=t[yy].getPeople().phone1;r["phone2"]=t[yy].getPeople().phone2;r["email"]=t[yy].getPeople().email;r["addressLine1"]=t[yy].getPeople().getCompactAddress().getAddressLine1();r["addressLine2"]=t[yy].getPeople().getCompactAddress().getAddressLine2();r["city"]=t[yy].getPeople().getCompactAddress().getCity();r["state"]=t[yy].getPeople().getCompactAddress().getState();r["zip"]=t[yy].getPeople().getCompactAddress().getZip();r["fax"]=t[yy].getPeople().fax;r["notes"]=t[yy].getPeople().notes;r["country"]=t[yy].getPeople().getCompactAddress().getCountry();r["fullName"]=t[yy].getPeople().fullName;var i=t[yy].getPeople().getAttributes().toArray();for(xx1 in i)r[i[xx1].attributeName]=i[xx1].attributeValue;n.push(r)}}return n}function getContactByType(e,t){var n=getPeople(t);for(thisContact in n){if(n[thisContact].getPeople().contactType.toUpperCase()==e.toUpperCase())return n[thisContact].getPeople()}return false}function getContactObj(e,t){var n=null;var r=new Array;if(e.getClass()=="com.accela.aa.aamain.cap.CapModel"){var n=cap.getContactsGroup().toArray()}else{var i=aa.people.getCapContactByCapID(e);if(i.getSuccess()){var n=i.getOutput()}}if(n){for(var s in n){if(n[s].getPeople().contactType.toUpperCase().equals(t.toUpperCase())){logDebug("getContactObj returned the first contact of type "+t+" on record "+e.getCustomID());return new contactObj(n[s])}}}logDebug("getContactObj could not find a contact of type "+t+" on record "+e.getCustomID());return false}function getContactObjsBySeqNbr(e,t){var n=null;var r=aa.people.getCapContactByCapID(e);if(r.getSuccess()){var n=r.getOutput()}if(n){for(var i in n){if(String(n[i].getPeople().contactSeqNumber).equals(String(t))){logDebug("getContactObjsBySeqNbr returned the contact on record "+e.getCustomID());return new contactObj(n[i])}}}}function getContactObjs(e){var t=false;if(arguments.length==2)t=arguments[1];var n=new Array;var r=new Array;if(!cap.isCompleteCap()&&controlString!="ApplicationSubmitAfter"){if(cap.getApplicantModel()){n[0]=cap.getApplicantModel()}if(cap.getContactsGroup().size()>0){var i=cap.getContactsGroup().toArray();for(ccaa in i)n.push(i[ccaa])}}else{var s=aa.people.getCapContactByCapID(e);if(s.getSuccess()){var n=s.getOutput()}}if(n){for(var o in n){if(!t||exists(n[o].getPeople().contactType,t)){r.push(new contactObj(n[o]))}}}logDebug("getContactObj returned "+r.length+" contactObj(s)");return r}function getContactObjsByCap(e){var t=false;if(arguments.length==2)t=arguments[1];var n=null;var r=new Array;var n=cap.getContactsGroup().toArray();if(n){for(var i in n){if(!t||exists(n[i].getPeople().contactType,t)){r.push(new contactObj(n[i]))}}}logDebug("getContactObj returned "+r.length+" contactObj(s)");return r}function getContactParams4Notification(e,t){contactArray=getContactArray();for(ca in contactArray){thisContact=contactArray[ca];if(thisContact["contactType"]==t){t=t.toLowerCase();addParameter(e,"$$"+t+"LastName$$",thisContact["lastName"]);addParameter(e,"$$"+t+"FirstName$$",thisContact["firstName"]);addParameter(e,"$$"+t+"MiddleName$$",thisContact["middleName"]);addParameter(e,"$$"+t+"BusinesName$$",thisContact["businessName"]);addParameter(e,"$$"+t+"ContactSeqNumber$$",thisContact["contactSeqNumber"]);addParameter(e,"$$"+t+"$$",thisContact["contactType"]);addParameter(e,"$$"+t+"Relation$$",thisContact["relation"]);addParameter(e,"$$"+t+"Phone1$$",thisContact["phone1"]);addParameter(e,"$$"+t+"Phone2$$",thisContact["phone2"]);addParameter(e,"$$"+t+"Email$$",thisContact["email"]);addParameter(e,"$$"+t+"AddressLine1$$",thisContact["addressLine1"]);addParameter(e,"$$"+t+"AddressLine2$$",thisContact["addressLine2"]);addParameter(e,"$$"+t+"City$$",thisContact["city"]);addParameter(e,"$$"+t+"State$$",thisContact["state"]);addParameter(e,"$$"+t+"Zip$$",thisContact["zip"]);addParameter(e,"$$"+t+"Fax$$",thisContact["fax"]);addParameter(e,"$$"+t+"Notes$$",thisContact["notes"]);addParameter(e,"$$"+t+"Country$$",thisContact["country"]);addParameter(e,"$$"+t+"FullName$$",thisContact["fullName"])}}return e}function getCSLBInfo(e,t){var n=aa.licenseScript.getLicenseProf(capId);if(n.getSuccess()){var r=n.getOutput()}else{logDebug("**ERROR: getting lic prof: "+n.getErrorMessage());return false}if(r==null||!r.length){logDebug("**WARNING: no licensed professionals on this CAP");return false}var i=r[0];var s=i.getLicenseNbr();var o=aa.httpClient.get("https://www2.cslb.ca.gov/IVR/License+Detail.aspx?LicNum="+s);if(o.getSuccess())var u=o.getOutput();else{logDebug("**ERROR: communicating with CSLB: "+o.getErrorMessage());return false}if(u.indexOf("<Error>")>0){logDebug("**ERROR: CSLB information returned an error: "+getNode(getNode(u,"License"),"**ERROR"));return false}var a=getNode(u,"BusinessInfo");var f=getNode(u,"PrimaryStatus");var l=getNode(u,"Classifications");var c=getNode(u,"ContractorBond");var h=getNode(u,"WorkersComp");if(t){var p=new Date(getNode(a,"ExpireDt"));if(p<startDate){showMessage=true;comment("**WARNING: Professional License expired on "+p.toString())}}if(e){i.setAddress1(getNode(a,"Addr1").replace(/\+/g," "));i.setAddress2(getNode(a,"Addr2").replace(/\+/g," "));i.setBusinessName(getNode(a,"Name").replace(/\+/g," "));i.setCity(getNode(a,"City").replace(/\+/g," "));i.setLicenseExpirDate(aa.date.parseDate(getNode(a,"ExpireDt")));i.setLicesnseOrigIssueDate(aa.date.parseDate(getNode(a,"IssueDt")));i.setState(getNode(a,"State").replace(/\+/g," "));i.setPhone1(getNode(a,"BusinessPhoneNum"));i.setState(getNode(a,"State").replace(/\+/g," "));i.setZip(getNode(a,"Zip"));aa.m_licenseProfessional.editLicensedProfessional(i)}}function getDateDiff(e){var t=new Date(e);var n=aa.date.getCurrentDate();var r=dateFormatted(n.getMonth(),n.getDayOfMonth(),n.getYear(),"MM/DD/YYYY");var i=new Date(r);var s=parseInt((i-t)/(1e3*60*60*24));return s}function getDepartmentName(e){var t=aa.person.getUser(e).getOutput();var n=aa.people.getDepartmentList(null).getOutput();for(var r in n){var i=n[r];var s=i.getServiceProviderCode()+"/"+i.getAgencyCode()+"/"+i.getBureauCode()+"/"+i.getDivisionCode()+"/"+i.getSectionCode()+"/"+i.getGroupCode()+"/"+i.getOfficeCode();if(s.equals(t.deptOfUser))return i.getDeptName()}}function getDocumentList(){var e=new Array;docListResult=aa.document.getCapDocumentList(capId,currentUserID);if(docListResult.getSuccess()){e=docListResult.getOutput()}return e}function getGISBufferInfo(e,t,n){var r="feet";var i=new Array;var s=aa.gis.getGISType(e,t);if(s.getSuccess()){var o=s.getOutput();for(argnum=3;argnum<arguments.length;argnum++)o.addAttributeName(arguments[argnum])}else{aa.print("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+s.getErrorType()+":"+s.getErrorMessage());return false}var u=aa.gis.getCapGISObjects(capId);if(u.getSuccess())var a=u.getOutput();else{aa.print("**WARNING: Getting GIS objects for Cap.  Reason is: "+u.getErrorType()+":"+u.getErrorMessage());return false}for(a1 in a){var f=aa.gis.getBufferByRadius(a[a1],n,r,o);if(f.getSuccess())var l=f.getOutput();else{aa.print("**WARNING: Retrieving Buffer Check Results.  Reason is: "+f.getErrorType()+":"+f.getErrorMessage());return false}for(a2 in l){var c=l[a2].getGISObjects();for(z1 in c){var h=c[z1].getAttributeNames();var p=c[z1].getAttributeValues();var d=new Array;d["GIS_ID"]=c[z1].getGisId();for(n1 in h){d[h[n1]]=p[n1]}i.push(d)}}}return i}function getGISInfo(e,t,n){var r="feet";var i;var s=aa.gis.getGISType(e,t);if(s.getSuccess()){var o=s.getOutput();o.addAttributeName(n)}else{logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+s.getErrorType()+":"+s.getErrorMessage());return false}var u=aa.gis.getCapGISObjects(capId);if(u.getSuccess())var a=u.getOutput();else{logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+u.getErrorType()+":"+u.getErrorMessage());return false}for(a1 in a){var f=aa.gis.getBufferByRadius(a[a1],"0",r,o);if(f.getSuccess())var l=f.getOutput();else{logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+f.getErrorType()+":"+f.getErrorMessage());return false}for(a2 in l){var c=l[a2].getGISObjects();for(z1 in c){var h=c[z1].getAttributeValues();i=h[0]}}}return i}function getGISInfoArray(e,t,n){var r="feet";var i=new Array;var s=aa.gis.getGISType(e,t);if(s.getSuccess()){var o=s.getOutput();o.addAttributeName(n)}else{logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+s.getErrorType()+":"+s.getErrorMessage());return false}var u=aa.gis.getCapGISObjects(capId);if(u.getSuccess())var a=u.getOutput();else{logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+u.getErrorType()+":"+u.getErrorMessage());return false}for(a1 in a){var f=aa.gis.getBufferByRadius(a[a1],"0",r,o);if(f.getSuccess())var l=f.getOutput();else{logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+f.getErrorType()+":"+f.getErrorMessage());return false}for(a2 in l){var c=l[a2].getGISObjects();for(z1 in c){var h=c[z1].getAttributeValues();i.push(h[0])}}}return i}function getGuideSheetObjects(e){var t=new Array;var n=capId;if(arguments.length==2)n=arguments[1];var r=aa.inspection.getInspections(n);if(r.getSuccess()){var s=r.getOutput();for(i in s){if(s[i].getIdNumber()==e){var o=s[i].getInspection();var u=o.getGuideSheets();if(u){gsArray=u.toArray();for(var f in gsArray){a=gsArray[f];var l=gsArray[f].getItems().toArray();for(var c in l){var h=new guideSheetObject(gsArray[f],l[c]);t.push(h)}}}else logDebug("No guidesheets for this inspection")}}}logDebug("loaded "+t.length+" guidesheet items");return t}function getInspector(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){inspList=t.getOutput();for(xx in inspList)if(String(e).equals(inspList[xx].getInspectionType())){inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput();return inspUserObj.getUserID()}}return false}function getLastInspector(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){inspList=t.getOutput();inspList.sort(compareInspDateDesc);for(xx in inspList)if(String(e).equals(inspList[xx].getInspectionType())&&!inspList[xx].getInspectionStatus().equals("Scheduled")){inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput();return inspUserObj.getUserID()}}return null}function compareInspDateDesc(e,t){if(e.getScheduledDate()==null&&t.getScheduledDate()==null){return false}if(e.getScheduledDate()==null&&t.getScheduledDate()!=null){return true}if(e.getScheduledDate()!=null&&t.getScheduledDate()==null){return false}return e.getScheduledDate().getEpochMilliseconds()<t.getScheduledDate().getEpochMilliseconds()}function getLastScheduledInspector(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){inspList=t.getOutput();inspList.sort(compareInspDateDesc);for(xx in inspList)if(String(e).equals(inspList[xx].getInspectionType())&&inspList[xx].getInspectionStatus().equals("Scheduled")){inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput();return inspUserObj.getUserID()}}return null}function getLicenseProfessional(e){capLicenseArr=null;var t=aa.licenseProfessional.getLicenseProf(e);if(t.getSuccess()){capLicenseArr=t.getOutput();if(capLicenseArr==null||capLicenseArr.length==0){aa.print("WARNING: no licensed professionals on this CAP:"+e);capLicenseArr=null}}else{aa.print("ERROR: Failed to license professional: "+t.getErrorMessage());capLicenseArr=null}return capLicenseArr}function getNode(e,t){var n="";var r="<"+t+">";var i="</"+t+">";startPos=e.indexOf(r)+r.length;endPos=e.indexOf(i);if(startPos>0&&startPos<endPos)n=e.substring(startPos,endPos);return unescape(n)}function getParent(){getCapResult=aa.cap.getProjectParents(capId,1);if(getCapResult.getSuccess()){parentArray=getCapResult.getOutput();if(parentArray.length)return parentArray[0].getCapID();else{logDebug("**WARNING: GetParent found no project parent for this application");return false}}else{logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage());return false}}function getParentByCapId(e){getCapResult=aa.cap.getProjectParents(e,1);if(getCapResult.getSuccess()){parentArray=getCapResult.getOutput();if(parentArray.length)return parentArray[0].getCapID();else{logDebug("**WARNING: GetParent found no project parent for this application");return false}}else{logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage());return false}}function getParentCapID4Renewal(){parentLic=getParentLicenseCapID(capId);pLicArray=String(parentLic).split("-");var e=aa.cap.getCapID(pLicArray[0],pLicArray[1],pLicArray[2]).getOutput();return e}function getParentLicenseCapID(e){if(e==null||aa.util.instanceOfString(e)){return null}var t=null;var n=aa.cap.getProjectByChildCapID(e,"Renewal",null);if(n.getSuccess()){licenseProjects=n.getOutput();if(licenseProjects!=null&&licenseProjects.length>0){licenseProject=licenseProjects[0];return licenseProject.getProjectID()}}var r=aa.cap.getProjectByChildCapID(e,"EST",null);if(r.getSuccess()){projectScriptModels=r.getOutput();if(projectScriptModels!=null&&projectScriptModels.length>0){projectScriptModel=projectScriptModels[0];t=projectScriptModel.getProjectID();return t}}logDebug("**WARNING: Could not find parent license Cap for child CAP("+e+"): ");return false}function getParents(e){var t=1;while(true){if(!aa.cap.getProjectParents(capId,t).getSuccess())break;t+=1}t-=1;getCapResult=aa.cap.getProjectParents(capId,t);myArray=new Array;if(getCapResult.getSuccess()){parentArray=getCapResult.getOutput();if(parentArray.length){for(x in parentArray){if(e!=null){if(appMatch(e,parentArray[x].getCapID()))myArray.push(parentArray[x].getCapID())}else myArray.push(parentArray[x].getCapID())}return myArray}else{logDebug("**WARNING: GetParent found no project parent for this application");return null}}else{logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage());return null}}function getPartialCapID(e){if(e==null||aa.util.instanceOfString(e)){return null}var t=aa.cap.getProjectByChildCapID(e,"EST",null);if(t.getSuccess()){projectScriptModels=t.getOutput();if(projectScriptModels==null||projectScriptModels.length==0){aa.print("ERROR: Failed to get partial CAP with CAPID("+e+")");return null}projectScriptModel=projectScriptModels[0];return projectScriptModel.getProjectID()}else{aa.print("ERROR: Failed to get partial CAP by child CAP("+e+"): "+t.getErrorMessage());return null}}function getPeople(e){capPeopleArr=null;var t=aa.people.getCapContactByCapID(e);if(t.getSuccess()){capPeopleArr=t.getOutput();if(capPeopleArr!=null||capPeopleArr.length>0){for(loopk in capPeopleArr){var n=capPeopleArr[loopk];var r=n.getCapContactModel();var i=n.getPeople();var s=aa.address.getContactAddressListByCapContact(r);if(s.getSuccess()){var o=convertContactAddressModelArr(s.getOutput());i.setContactAddressList(o)}}}else{aa.print("WARNING: no People on this CAP:"+e);capPeopleArr=null}}else{aa.print("ERROR: Failed to People: "+t.getErrorMessage());capPeopleArr=null}return capPeopleArr}function getPrimaryAddressLineParam4Notification(e){var t="";adResult=aa.address.getPrimaryAddressByCapID(capId,"Y");if(adResult.getSuccess()){ad=adResult.getOutput().getAddressModel();addParameter(e,"$$addressLine$$",ad.getDisplayAddress())}return e}function getPrimaryOwnerParams4Notification(e){capOwnerResult=aa.owner.getOwnerByCapId(capId);if(capOwnerResult.getSuccess()){owner=capOwnerResult.getOutput();for(o in owner){thisOwner=owner[o];if(thisOwner.getPrimaryOwner()=="Y"){addParameter(e,"$$ownerFullName$$",thisOwner.getOwnerFullName());addParameter(e,"$$ownerPhone$$",thisOwner.getPhone);break}}}return e}function getProp(e,t){var n="";var r=t+"='";var i="'";startPos=e.indexOf(r)+r.length;if(startPos>0)n=e.substring(startPos);endPos=n.indexOf(i);if(endPos>0)n=n.substring(0,endPos);return unescape(n)}function getRecordParams4Notification(e){addParameter(e,"$$altID$$",capIDString);addParameter(e,"$$capName$$",capName);addParameter(e,"$$capStatus$$",capStatus);addParameter(e,"$$fileDate$$",fileDate);addParameter(e,"$$balanceDue$$","$"+parseFloat(balanceDue).toFixed(2));return e}function getRefLicenseProf(e){var t=null;var n=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),e);if(!n.getSuccess()){logDebug("**ERROR retrieving Ref Lic Profs : "+n.getErrorMessage());return false}else{var r=n.getOutput();if(!r)return null;for(var i in r)if(e&&r[i]&&e.toUpperCase().equals(r[i].getStateLicense().toUpperCase()))t=r[i]}return t}function getRelatedCapsByAddress(e){var t=new Array;var n=aa.address.getAddressByCapId(capId);if(n.getSuccess()){var r=n.getOutput()}else{logDebug("**ERROR: getting address by cap ID: "+n.getErrorMessage());return false}for(zzz in r){var i=r[zzz];capAddResult=aa.cap.getCapListByDetailAddress(i.getStreetName(),i.getHouseNumberStart(),i.getStreetSuffix(),null,i.getStreetDirection(),null);if(capAddResult.getSuccess()){var s=capAddResult.getOutput()}else{logDebug("**ERROR: getting similar addresses: "+capAddResult.getErrorMessage());return false}for(cappy in s){if(capId.getCustomID().equals(s[cappy].getCustomID()))continue;var o=aa.cap.getCap(s[cappy].getCapID()).getOutput();var u=o.getCapType().toString().split("/");var a=true;var f=e.split("/");if(f.length!=4)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in f)if(!f[xx].equals(u[xx])&&!f[xx].equals("*"))a=false;if(a)t.push(s[cappy])}}if(t.length>0)return t}function getRelatedCapsByParcel(e){var t=new Array;var n=aa.parcel.getParcelandAttribute(capId,null);if(n.getSuccess()){var r=n.getOutput().toArray()}else{logDebug("**ERROR: getting parcels by cap ID: "+n.getErrorMessage());return false}for(zz in r){var i=r[zz].getParcelNumber();var s=aa.cap.getCapListByParcelID(i,null);if(s.getSuccess()){var o=s.getOutput()}else{logDebug("**ERROR: getting similar parcels: "+s.getErrorMessage());return false}for(cappy in o){if(capId.getCustomID().equals(o[cappy].getCustomID()))continue;var u=aa.cap.getCap(o[cappy].getCapID()).getOutput();var a=u.getCapType().toString().split("/");var f=true;var l=e.split("/");if(l.length!=4)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in l)if(!l[xx].equals(a[xx])&&!l[xx].equals("*"))f=false;if(f)t.push(o[cappy])}}if(t.length>0)return t}function getRenewalCapByParentCapIDForReview(e){if(e==null||aa.util.instanceOfString(e)){return null}var t=aa.cap.getProjectByMasterID(e,"Renewal","Review");if(t.getSuccess()){projectScriptModels=t.getOutput();if(projectScriptModels==null||projectScriptModels.length==0){aa.print("ERROR: Failed to get renewal CAP by parent CAPID("+e+") for review");return null}projectScriptModel=projectScriptModels[0];return projectScriptModel}else{aa.print("ERROR: Failed to get renewal CAP by parent CAP("+e+") for review: "+t.getErrorMessage());return null}}function getReportedChannel(){var e=capId;if(arguments.length>0)e=arguments[0];var t=aa.cap.getCapDetail(e);if(!t.getSuccess()){logDebug("**ERROR: No cap detail script object : "+t.getErrorMessage());return false}var n=t.getOutput();if(!n){logDebug("**ERROR: No cap detail script object");return false}cd=n.getCapDetailModel();var r=cd.getReportedChannel();if(r!=null)return r;else return""}function getRootNode(e,t){if(t>9){return e}var n=t+1;var r=e;var i=aa.cap.getProjectByChildCapID(r,"R",null);if(i.getSuccess()){directParents=i.getOutput();for(var s in directParents){if(directParents[s]){var o=directParents[s].getProjectID().getID1();var u=directParents[s].getProjectID().getID2();var a=directParents[s].getProjectID().getID3();while(!isSameNode(r,directParents[s].getProjectID())){r=getRootNode(directParents[s].getProjectID(),n)}}}}return r}function getRoots(e){var t=new Array;var n=aa.cap.getProjectByChildCapID(e,"R",null);if(n.getSuccess()){tmpdirectParents=n.getOutput();for(ff in tmpdirectParents){if(tmpdirectParents[ff]){var r=getRootNode(tmpdirectParents[ff].getProjectID(),1);var i=r.getID1();var s=r.getID2();var o=r.getID3();var u=aa.cap.getCapID(i,s,o).getOutput();t.push(u)}}}return t}function getScheduledInspId(e){var t=aa.inspection.getInspections(capId);if(t.getSuccess()){var n=t.getOutput();for(xx in n)if(String(e).equals(n[xx].getInspectionType())&&n[xx].getInspectionStatus().toUpperCase().equals("SCHEDULED"))return n[xx].getIdNumber()}return false}function getScriptAction(e){var t=new Array;var n=String(""+maxEntries).length;var r=aa.bizDomain.getBizDomain(e);if(r.getSuccess()){bizDomScriptArray=r.getOutput().toArray();for(var i in bizDomScriptArray){var s=new pairObj(bizDomScriptArray[i].getBizdomainValue());s.load(bizDomScriptArray[i].getDescription());if(bizDomScriptArray[i].getAuditStatus()=="I")s.enabled=false;t.push(s)}}return t}function getScriptAction_v1_6(e){var t=new Array;var n=String(""+maxEntries).length;for(var r=1;r<=maxEntries;r++){var i="000000"+r;i=String(i).substring(i.length,i.length-n);var s=aa.bizDomain.getBizDomainByValue(e,i);if(s.getSuccess()){bizDomScriptObj=s.getOutput();var o=new pairObj(bizDomScriptObj.getBizdomainValue());o.load(bizDomScriptObj.getDescription());if(bizDomScriptObj.getAuditStatus()=="I")o.enabled=false;t.push(o)}else{break}}return t}function getScriptText(e){var t=aa.getServiceProviderCode();if(arguments.length>1)t=arguments[1];e=e.toUpperCase();var n=aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput();try{var r=n.getScriptByPK(t,e,"ADMIN");return r.getScriptText()+""}catch(i){return""}}function getShortNotes(){var e=capId;if(arguments.length>0)e=arguments[0];var t=aa.cap.getCapDetail(e);if(!t.getSuccess()){logDebug("**ERROR: No cap detail script object : "+t.getErrorMessage());return false}var n=t.getOutput();if(!n){logDebug("**ERROR: No cap detail script object");return false}cd=n.getCapDetailModel();var r=cd.getShortNotes();if(r!=null)return r;else return""}function getTaskDueDate(e){var t=false;var n="";if(arguments.length==2){n=arguments[1];t=true}var r=e;if(e=="*"){r=""}var s=aa.workflow.getTaskItems(capId,r,n,null,null,null);if(s.getSuccess())wfObj=s.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){var o=wfObj[i];if((o.getTaskDescription().toUpperCase().equals(e.toUpperCase())||e=="*")&&(!t||o.getProcessCode().equals(n))){var u=wfObj[i].getDueDate();if(u)return new Date(u.getMonth()+"/"+u.getDayOfMonth()+"/"+u.getYear())}}}function getTaskStatusForEmail(e){var t="";var n=aa.workflow.getTaskItems(capId,null,e,"Y",null,null);if(n.getSuccess()){var r=n.getOutput()}else{logDebug("**ERROR: getting tasks : "+n.getErrorMessage());return false}for(xx in r)if(r[xx].getProcessCode().equals(e)&&r[xx].getCompleteFlag().equals("Y")){t+="Task Name: "+r[xx].getTaskDescription()+"\n";t+="Task Status: "+r[xx].getDisposition()+"\n";if(r[xx].getDispositionComment()!=null)t+="Task Comments: "+r[xx].getDispositionComment()+"\n";t+="\n"}logDebug(t);return t}function getURLToNewRecord(e,t,n,r,i,s){var o=aa.proxyInvoker.newInstance("com.accela.aa.aamain.servicemanagement.ServiceManagementBusiness").getOutput();var u=aa.proxyInvoker.newInstance("com.accela.aa.aamain.servicemanagement.ServiceModel").getOutput();var a=aa.cap.getCapTypeModel().getOutput();a.setGroup(n);a.setType(r);a.setSubType(i);a.setCategory(s);u.setCapType(a);u.setServPorvCode(t);var f=o.getServices(u).toArray();for(var l in f){return e+"/AgencyRedirect.aspx?agency="+t+"&name="+escape(f[l].getServiceName())}return false}function getUserEmail(){var e=currentUserID;if(arguments.length>0)e=arguments[0];var t=aa.person.getUser(e.toUpperCase());if(t.getSuccess()){var n=t.getOutput();var r=n.getEmail();if(r)return r;else return false}else{aa.print(t.getErrorMessage());return false}}function getUserFullName(){var e=currentUserID;if(arguments.length>0)e=arguments[0];var t=aa.person.getUser(e.toUpperCase());if(t.getSuccess()){var n=t.getOutput();var r=n.getEmail();var i="";if(!matches(n.getFirstName(),null,undefined,""))i=n.getFirstName();if(!matches(n.getLastName(),null,undefined,""))i+=" "+n.getLastName();if(i!="")return i;else return false}else{logDebug(t.getErrorMessage());return false}}function guideSheetObject(e,t){this.gsType=e.getGuideType();this.gsSequence=e.getGuidesheetSeqNbr();this.gsDescription=e.getGuideDesc();this.gsIdentifier=e.getIdentifier();this.item=t;this.text=t.getGuideItemText();this.status=t.getGuideItemStatus();this.comment=t.getGuideItemComment();this.score=t.getGuideItemScore();this.info=new Array;this.infoTables=new Array;this.validTables=false;this.validInfo=false;this.loadInfo=function(){var e=this.item.getItemASISubgroupList();if(e!=null){this.validInfo=true;var t=e.iterator();while(t.hasNext()){var n=t.next();var r=n.getAsiList();if(r!=null){var i=r.iterator();while(i.hasNext()){var s=i.next();this.info[s.getAsiName()]=s.getAttributeValue()}}}}};this.loadInfoTables=function(){var e=this.item.getItemASITableSubgroupList();if(e!=null)for(var t=0;t<e.size();t++){var n=e.get(t);var r=new Array;var i=n.getColumnList();for(var s=0;s<i.size();s++){var o=i.get(s);var u=o.getValueMap().values();var a=u.iterator();while(a.hasNext()){var f=a.next();var l=f.getRowIndex()-1;if(r[l]==null)r[l]=new Array;r[l][o.getColumnName()]=f.getAttributeValue()}}this.infoTables[""+n.getTableName()]=r;this.validTables=true}}}function handleError(e,t){var n=true;var r=true;if(r)showDebug=true;logDebug((n?"**ERROR** ":"ERROR: ")+e.message+" In "+t+" Line "+e.lineNumber);logDebug("Stack: "+e.stack)}function hasPrimaryAddressInCap(e){var t=false;var n=aa.address.getAddressByCapId(e);if(n.getSuccess()){var r=n.getOutput();for(k in r){if("Y"==r[k].getPrimaryFlag()){t=true;logDebug("Target CAP has primary address");break}}}else{logMessage("**ERROR: Failed to get addresses: "+n.getErrorMessage())}return t}function xmlEscapeXMLToHTML(e){var t;var n=e;t=-1;while(n.indexOf("&",t+1)>-1){var t=n.indexOf("&",t+1);var r=n.substr(0,t);r+="&";r=r+n.substr(t+1,n.length);n=r}t=-1;while(n.indexOf("<",t+1)>-1){var t=n.indexOf("<",t+1);var r=n.substr(0,t);r+="&lt;";r=r+n.substr(t+1,n.length);n=r}t=-1;while(n.indexOf(">",t+1)>-1){var t=n.indexOf(">",t+1);var r=n.substr(0,t);r+="&gt;";r=r+n.substr(t+1,n.length);n=r}t=-1;while(n.indexOf("\n",t+1)>-1){var t=n.indexOf("\n",t+1);var r=n.substr(0,t);r+="<br>";r=r+n.substr(t+1,n.length);n=r}return n}function include(s){try{var thisDate=new Date;var thisTime=thisDate.getTime();var st=getScriptText(s);if(st.length){logDebug("Executing script : "+s+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds");eval(st)}}catch(err){handleError(err,s)}}function insertSubProcess(e,t,n){var r=capId;var i=null;if(arguments.length>3)r=arguments[3];var s=aa.workflow.getTaskItems(r,e,null,null,null,null);if(s.getSuccess())wfObj=s.getOutput();else{logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(var o in wfObj)if(e.toUpperCase().equals(wfObj[o].getTaskDescription().toUpperCase()))i=wfObj[o];if(i){var u=aa.workflow.insertSubProcess(i,t,n);if(!u.getSuccess()){logDebug("error "+u.getErrorMessage());return false}logDebug("attached subprocess "+t+" to "+e);return true}else{logDebug("couldn't find task "+e);return false}}function insertTask(e,t,n){itemCap=capId;if(arguments.length>3)itemCap=arguments[3];var r;var i;var s="N";insertPType="P";var o=aa.workflow.getTask(capId,e);if(o.getSuccess()){i=o.getOutput();aa.print("get task successful : task name = "+i.getTaskDescription()+"; Process name = "+i.getProcessCode())}else{aa.print("ERROR: Failed to get task! Path = "+e+";"+o.getErrorMessage())}i.setTaskDescription(t);var u=aa.workflow.insertTask(i,n);if(u.getSuccess()){var a=i.getProcessID();var f=i.getStepNumber();var o=aa.workflow.getTask(capId,f,a);if(o.getSuccess()){i=o.getOutput();aa.print("insert task successful : inserted task name = "+i.getTaskDescription()+"; Process name = "+i.getProcessCode())}else{aa.print("ERROR: Failed to get task! Path = "+taskPath+";"+o.getErrorMessage());return false}}else{aa.print("ERROR: Failed to insert task! Path = "+taskPath+";"+u.getErrorMessage());return false}return i}function inspCancelAll(){var e=false;var t=aa.inspection.getInspections(capId);if(t.getSuccess()){var n=t.getOutput();var r;var i;for(ii in n){if(n[ii].getDocumentDescription().equals("Insp Scheduled")&&n[ii].getAuditStatus().equals("A")){r=n[ii].getIdNumber();i=aa.inspection.cancelInspection(capId,r);if(i.getSuccess()){logMessage("Cancelling inspection: "+n[ii].getInspectionType());e=true}else logMessage("**ERROR","**ERROR: Cannot cancel inspection: "+n[ii].getInspectionType()+", "+i.getErrorMessage())}}}else logMessage("**ERROR: getting inspections: "+t.getErrorMessage());return e}function invoiceFee(e,t){var n=false;getFeeResult=aa.finance.getFeeItemsByFeeCodeAndPeriod(capId,e,t,"NEW");if(getFeeResult.getSuccess()){var r=getFeeResult.getOutput();for(feeNum in r)if(r[feeNum].getFeeitemStatus().equals("NEW")){var i=r[feeNum].getFeeSeqNbr();feeSeqList.push(i);paymentPeriodList.push(t);n=true;logDebug("Assessed fee "+e+" found and tagged for invoicing")}}else{logDebug("**ERROR: getting fee items ("+e+"): "+getFeeResult.getErrorMessage())}return n}function isBlank(e){return!e||/^\s*$/.test(e)}function isEmpty(e){return!e||0===e.length}function isBlank(e){return!e||/^\s*$/.test(e)}function getRoots(e){var t=new Array;var n=aa.cap.getProjectByChildCapID(e,"R",null);if(n.getSuccess()){tmpdirectParents=n.getOutput();for(ff in tmpdirectParents){if(tmpdirectParents[ff]){var r=getRootNode(tmpdirectParents[ff].getProjectID(),1);var i=r.getID1();var s=r.getID2();var o=r.getID3();var u=aa.cap.getCapID(i,s,o).getOutput();t.push(u)}}}return t}function isSameNode(e,t){if(e==null||e==undefined||t==null||t==undefined){return false}return e.getID1()==t.getID1()&&e.getID2()==t.getID2()&&e.getID3()==t.getID3()}function getRootNode(e,t){if(t>9){return e}var n=t+1;var r=e;var i=aa.cap.getProjectByChildCapID(r,"R",null);if(i.getSuccess()){directParents=i.getOutput();for(var s in directParents){if(directParents[s]){var o=directParents[s].getProjectID().getID1();var u=directParents[s].getProjectID().getID2();var a=directParents[s].getProjectID().getID3();while(!isSameNode(r,directParents[s].getProjectID())){r=getRootNode(directParents[s].getProjectID(),n)}}}}return r}function isMatchPeople(e,t){if(e==null||t==null){return false}var n=e.getCapContactModel().getPeople().getContactType();var r=t.getCapContactModel().getPeople().getContactType();var i=e.getCapContactModel().getPeople().getFirstName();var s=t.getCapContactModel().getPeople().getFirstName();var o=e.getCapContactModel().getPeople().getLastName();var u=t.getCapContactModel().getPeople().getLastName();var a=e.getCapContactModel().getPeople().getFullName();var f=t.getCapContactModel().getPeople().getFullName();if(n==null&&r!=null||n!=null&&r==null){return false}if(n!=null&&!n.equals(r)){return false}if(i==null&&s!=null||i!=null&&s==null){return false}if(i!=null&&!i.equals(s)){return false}if(o==null&&u!=null||o!=null&&u==null){return false}if(o!=null&&!o.equals(u)){return false}if(a==null&&f!=null||a!=null&&f==null){return false}if(a!=null&&!a.equals(f)){return false}return true}function isReadyRenew(e){if(e==null||aa.util.instanceOfString(e)){return false}var t=aa.expiration.isExpiredLicenses(e);if(t.getSuccess()){return true}else{logDebug("ERROR: Failed to get expiration with CAP("+e+"): "+t.getErrorMessage())}return false}function isRenewProcess(e,t){if(e==null||t==null){logDebug("ERROR: the parentCapID or the partialCap ID is null");return false}var n=aa.cap.getCap(t);if(n.getSuccess()){capScriptModel=n.getOutput();if(capScriptModel.isCompleteCap()){logDebug("ERROR: It is not partial CAP("+capScriptModel.getCapID()+")");return false}}else{logDebug("ERROR: Fail to get CAPModel ("+t+"): "+n.getErrorMessage());return false}n=aa.cap.getProjectByMasterID(e,"Renewal","Incomplete");if(n.getSuccess()){partialProjects=n.getOutput();if(partialProjects!=null&&partialProjects.length>0){logDebug("Warning: Renewal process was initiated before. ( "+e+")");return false}}return isReadyRenew(e)}function isSameNode(e,t){if(e==null||e==undefined||t==null||t==undefined){return false}return e.getID1()==t.getID1()&&e.getID2()==t.getID2()&&e.getID3()==t.getID3()}function isScheduled(e){var t=false;var n=aa.inspection.getInspections(capId);if(n.getSuccess()){var r=n.getOutput();for(xx in r)if(String(e).equals(r[xx].getInspectionType()))t=true}return t}function isTaskActive(e){var t=false;var n="";if(arguments.length==2){n=arguments[1];t=true}var r=aa.workflow.getTaskItems(capId,e,n,null,null,"Y");if(r.getSuccess())wfObj=r.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){fTask=wfObj[i];if(fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||fTask.getProcessCode().equals(n)))if(fTask.getActiveFlag().equals("Y"))return true;else return false}}function isTaskComplete(e){var t=false;var n="";if(arguments.length==2){n=arguments[1];t=true}var r=aa.workflow.getTaskItems(capId,e,n,"Y",null,null);if(r.getSuccess())wfObj=r.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){fTask=wfObj[i];if(fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||fTask.getProcessCode().equals(n)))if(fTask.getCompleteFlag().equals("Y"))return true;else return false}}function isTaskStatus(e,t){var n=false;var r="";if(arguments.length>2){r=arguments[2];n=true}var s=aa.workflow.getTaskItems(capId,e,r,null,t,null);if(s.getSuccess())var o=s.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in o){fTask=o[i];if(fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!n||fTask.getProcessCode().equals(r)))if(fTask.getDisposition()!=null){if(fTask.getDisposition().toUpperCase().equals(t.toUpperCase()))return true;else return false}}return false}function jsDateToASIDate(e){if(e!=null){if(Date.prototype.isPrototypeOf(e)){var t=""+(e.getMonth()+1);var n="0"+t;n=n.substring(n.length-2,n.length);var r=""+e.getDate();var i="0"+r;i=i.substring(i.length-2,i.length);var s=""+e.getFullYear();return n+"/"+i+"/"+s}else{logDebug("Parameter is not a javascript date");return"INVALID JAVASCRIPT DATE"}}else{logDebug("Parameter is null");return"NULL PARAMETER VALUE"}}function jsDateToMMDDYYYY(e){if(e!=null){if(Date.prototype.isPrototypeOf(e))return(e.getMonth()+1).toString()+"/"+e.getDate()+"/"+e.getFullYear();else{logDebug("Parameter is not a javascript date");return"INVALID JAVASCRIPT DATE"}}else{logDebug("Parameter is null");return"NULL PARAMETER VALUE"}}function licEditExpInfo(e,t){var n=new licenseObject(null);if(e!=null){n.setStatus(e)}if(t!=null){n.setExpiration(t)}}function licenseObject(e){itemCap=capId;if(arguments.length==2)itemCap=arguments[1];this.refProf=null;this.b1Exp=null;this.b1ExpDate=null;this.b1ExpCode=null;this.b1Status=null;this.refExpDate=null;this.licNum=e;if(e){var t=getRefLicenseProf(e);if(t){this.refProf=t;tmpDate=t.getLicenseExpirationDate();if(tmpDate)this.refExpDate=tmpDate.getMonth()+"/"+tmpDate.getDayOfMonth()+"/"+tmpDate.getYear();logDebug("Loaded reference license professional with Expiration of "+this.refExpDate)}}b1ExpResult=aa.expiration.getLicensesByCapID(itemCap);if(b1ExpResult.getSuccess()){this.b1Exp=b1ExpResult.getOutput();tmpDate=this.b1Exp.getExpDate();if(tmpDate)this.b1ExpDate=tmpDate.getMonth()+"/"+tmpDate.getDayOfMonth()+"/"+tmpDate.getYear();this.b1Status=this.b1Exp.getExpStatus();logDebug("Found renewal record of status : "+this.b1Status+", Expires on "+this.b1ExpDate)}else{logDebug("**ERROR: Getting B1Expiration Object for Cap.  Reason is: "+b1ExpResult.getErrorType()+":"+b1ExpResult.getErrorMessage());return false}this.setExpiration=function(e){var t=aa.date.parseDate(e);if(this.refProf){this.refProf.setLicenseExpirationDate(t);aa.licenseScript.editRefLicenseProf(this.refProf);logDebug("Updated reference license expiration to "+e)}if(this.b1Exp){this.b1Exp.setExpDate(t);aa.expiration.editB1Expiration(this.b1Exp.getB1Expiration());logDebug("Updated renewal to "+e)}};this.setIssued=function(e){var t=aa.date.parseDate(e);if(this.refProf){this.refProf.setLicenseIssueDate(t);aa.licenseScript.editRefLicenseProf(this.refProf);logDebug("Updated reference license issued to "+e)}};this.setLastRenewal=function(e){var t=aa.date.parseDate(e);if(this.refProf){this.refProf.setLicenseLastRenewalDate(t);aa.licenseScript.editRefLicenseProf(this.refProf);logDebug("Updated reference license issued to "+e)}};this.setStatus=function(e){if(this.b1Exp){this.b1Exp.setExpStatus(e);aa.expiration.editB1Expiration(this.b1Exp.getB1Expiration());logDebug("Updated renewal to status "+e)}};this.getStatus=function(){if(this.b1Exp){return this.b1Exp.getExpStatus()}};this.getCode=function(){if(this.b1Exp){return this.b1Exp.getExpCode()}}}function licenseProfObject(e,t){this.refLicModel=null;this.infoTableGroupCodeObj=null;this.infoTableSubGroupCodesObj=null;this.infoTables=new Array;this.attribs=new Array;this.valid=false;this.validTables=false;this.validAttrs=false;var n=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),e);if(n.getSuccess()){var r=n.getOutput();if(t==null)t="";if(r!=null)for(lic in r)if(r[lic].getLicenseType().toUpperCase()==t.toUpperCase()||t==""){this.refLicModel=r[lic];if(t==""){t=this.refLicModel.getLicenseType()}break}}if(this.refLicModel!=null){this.infoTableGroupCodeObj=this.refLicModel.getInfoTableGroupCodeModel();if(this.infoTableGroupCodeObj==null){var i=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput();if(i.getInfoTableGroupCodeModel()!=null){i.getInfoTableGroupCodeModel().setServProvCode(aa.getServiceProviderCode());i.getInfoTableGroupCodeModel().setCategory(1);i.getInfoTableGroupCodeModel().setReferenceId("");i.getInfoTableGroupCodeModel().setName(t.toUpperCase());var s=aa.licenseProfessional.getRefInfoTableGroupCode(i).getOutput();if(s!=null){s.setReferenceId(this.refLicModel.getLicSeqNbr());i.setInfoTableGroupCodeModel(s);aa.licenseProfessional.createRefInfoTable(i);var r=null;r=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),e).getOutput();for(lic in r)if(r[lic].getLicenseType().toUpperCase()==t.toUpperCase()){this.refLicModel=r[lic];break}this.infoTableGroupCodeObj=this.refLicModel.getInfoTableGroupCodeModel()}}}}if(this.infoTableGroupCodeObj!=null){var r=this.infoTableGroupCodeObj.getSubgroups();if(r!=null)this.infoTableSubGroupCodesObj=r.toArray()}this.validTables=this.infoTableSubGroupCodesObj!=null;this.valid=this.refLicModel!=null;this.refreshTables=function(){if(this.validTables){for(tbl in this.infoTableSubGroupCodesObj){var e=new Array;var t=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(t!=null){t=t.toArray();for(column in t){var n=t[column].getTableValues();if(n!=null){n=n.toArray();n.sort(function(e,t){return e.getRowNumber()-t.getRowNumber()});for(var r=0;r<n.length;r++){n[r].setRowNumber(r);if(e[r]==null)e[r]=new Array;e[r][t[column].getName()]=n[r]}}}}this.infoTables[this.infoTableSubGroupCodesObj[tbl].getName()]=e}}};this.refreshTables();this.getMaxRowByTable=function(e){var t=-1;if(this.validTables){var n=this.infoTables[e];if(n!=null){for(row in n)for(col in n[row])if(t<parseInt(n[row][col].getRowNumber()))t=parseInt(n[row][col].getRowNumber())}}return t};this.addTableRow=function(e,t){var n=false;var r=new Array;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var i=this.getMaxRowByTable(e)+1;var s=this.infoTableSubGroupCodesObj[tbl].getColumnDefines().toArray();var o=0;s.sort(function(e,t){return parseInt(e.getDisplayOrder())-parseInt(t.getDisplayOrder())});for(col in s){var u=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput().getInfoTableValueModel();u.setAuditStatus("A");u.setServProvCode(aa.getServiceProviderCode());u.setColumnNumber(o++);u.setAuditDate(s[col].getAuditDate());if(typeof currentUserID!="undefined")u.setAuditId(currentUserID);else u.setAuditId("ADMIN");u.setInfoId(s[col].getId());u.setRowNumber(i);for(val in t)if(val.toString().toUpperCase()==s[col].getName().toString().toUpperCase()){u.setValue(t[val].toString())}s[col].addTableValue(u);n=true}this.refreshTables()}return n};this.addTableFromASIT=function(e,t){var n=true;if(this.validTables)for(row in t){if(!this.addTableRow(e,t[row]))n=false}else n=false;return n};this.removeTableRow=function(e,t){var n=false;if(this.validTables){for(tbl in this.infoTableSubGroupCodesObj){if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var r=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(r!=null){r=r.toArray();for(column in r){var i=r[column].getTableValues();if(i!=null){i=i.toArray();if(t<=i.length){var s=aa.util.newArrayList();for(row in i){if(i[row].getRowNumber()!=t){s.add(i[row])}else{n=true}}r[column].setTableValues(s)}}}}break}}}return n};this.removeTable=function(e){var t=false;if(this.validTables){for(tbl in this.infoTableSubGroupCodesObj){if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var n=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(n!=null){n=n.toArray();for(column in n){var r=n[column].getTableValues();if(r!=null){var i=aa.util.newArrayList();n[column].setTableValues(i);t=true}}}break}}}return t};this.setTableEnabledFlag=function(e,t,n){var r=false;var i=null;i=this.infoTables[e];if(i!=null)if(i[t]!=null){for(col in i[t]){i[t][col].setAuditStatus(n?"A":"I");r=true}}return r};this.setDisplayInACA4Table=function(e,t){var n=false;if(this.validTables){for(tbl in this.infoTableSubGroupCodesObj){if(this.infoTableSubGroupCodesObj[tbl].getName()==e){var r=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(r!=null){r=r.toArray();for(column in r){r[column].setDisplayLicVeriForACA(t);n=true}}if(n){var i=aa.util.newArrayList();for(col in r){i.add(r[col])}this.infoTableSubGroupCodesObj[tbl].setColumnDefines(i)}break}}}return n};if(this.valid){var o=this.refLicModel.getAttributes();if(o!=null){var u=o.values();var a=u.iterator();if(a.hasNext()){var f=a.next().toArray();for(x in f){this.attribs[f[x].getAttributeLabel().toUpperCase()]=f[x]}this.validAttrs=true}}}this.getAttribute=function(e){var t=null;if(this.validAttrs){var n=this.attribs[e.toString().toUpperCase()];if(n!=null)t=n.getAttributeValue()}return t};this.setAttribute=function(e,t){var n=false;if(this.validAttrs){var r=this.attribs[e.toString().toUpperCase()];if(r!=null){r.setAttributeValue(t);n=true}}return n};this.updateFromRecordContactByType=function(e,t,n,r){this.retVal=false;if(this.valid){var i=new Array;var s=aa.people.getCapContactByCapID(e);if(s.getSuccess()){i=s.getOutput()}else{retVal=false}for(contact in i){if(t.toString().toUpperCase()==i[contact].getPeople().getContactType().toString().toUpperCase()||t.toString()==""&&i[contact].getPeople().getFlag()=="Y"){cont=i[contact];peop=cont.getPeople();addr=peop.getCompactAddress();this.refLicModel.setContactFirstName(cont.getFirstName());this.refLicModel.setContactMiddleName(peop.getMiddleName());this.refLicModel.setContactLastName(cont.getLastName());this.refLicModel.setBusinessName(peop.getBusinessName());if(n){this.refLicModel.setAddress1(addr.getAddressLine1());this.refLicModel.setAddress2(addr.getAddressLine2());this.refLicModel.setAddress3(addr.getAddressLine3());this.refLicModel.setCity(addr.getCity());this.refLicModel.setState(addr.getState());this.refLicModel.setZip(addr.getZip())}if(r){this.refLicModel.setPhone1(peop.getPhone1());this.refLicModel.setPhone2(peop.getPhone2());this.refLicModel.setPhone3(peop.getPhone3());this.refLicModel.setEMailAddress(peop.getEmail());this.refLicModel.setFax(peop.getFax())}this.refLicModel.setAgencyCode(aa.getServiceProviderCode());this.refLicModel.setAuditDate(sysDate);this.refLicModel.setAuditID(currentUserID);this.refLicModel.setAuditStatus("A");retVal=true;break}}}return retVal};this.updateFromAddress=function(e){this.retVal=false;if(this.valid){var t=aa.address.getAddressByCapId(e);var n=null;if(t.getSuccess()){Address=t.getOutput();for(yy in Address){if("Y"==Address[yy].getPrimaryFlag()){n=Address[yy];logDebug("Target CAP has primary address");break}}if(n==null){n=Address[0]}}else{logMessage("**ERROR: Failed to get addresses: "+t.getErrorMessage())}if(n!=null){var r=n.getAddressLine1();if(r==null){r=n.getHouseNumberStart();r+=n.getStreetDirection()!=null?" "+n.getStreetDirection():"";r+=n.getStreetName()!=null?" "+n.getStreetName():"";r+=n.getStreetSuffix()!=null?" "+n.getStreetSuffix():"";r+=n.getUnitType()!=null?" "+n.getUnitType():"";r+=n.getUnitStart()!=null?" "+n.getUnitStart():""}this.refLicModel.setAddress1(r);this.refLicModel.setAddress2(n.getAddressLine2());this.refLicModel.setCity(n.getCity());this.refLicModel.setState(n.getState());this.refLicModel.setZip(n.getZip());retVal=true}else{retVal=false}}return retVal};this.updateFromRecordLicensedProf=function(e){var t=false;if(this.valid){var n=aa.licenseProfessional.getLicenseProf(capId);var r=new Array;if(n.getSuccess()){r=n.getOutput()}else{t=false}for(capLic in r){if(r[capLic].getLicenseNbr()+""==this.refLicModel.getStateLicense()+""&&r[capLic].getLicenseType()+""==this.refLicModel.getLicenseType()+""){licProfScriptModel=r[capLic];this.refLicModel.setAddress1(licProfScriptModel.getAddress1());this.refLicModel.setAddress2(licProfScriptModel.getAddress2());this.refLicModel.setAddress3(licProfScriptModel.getAddress3());this.refLicModel.setAgencyCode(licProfScriptModel.getAgencyCode());this.refLicModel.setAuditDate(licProfScriptModel.getAuditDate());this.refLicModel.setAuditID(licProfScriptModel.getAuditID());this.refLicModel.setAuditStatus(licProfScriptModel.getAuditStatus());this.refLicModel.setBusinessLicense(licProfScriptModel.getBusinessLicense());this.refLicModel.setBusinessName(licProfScriptModel.getBusinessName());this.refLicModel.setCity(licProfScriptModel.getCity());this.refLicModel.setCityCode(licProfScriptModel.getCityCode());this.refLicModel.setContactFirstName(licProfScriptModel.getContactFirstName());this.refLicModel.setContactLastName(licProfScriptModel.getContactLastName());this.refLicModel.setContactMiddleName(licProfScriptModel.getContactMiddleName());this.refLicModel.setContryCode(licProfScriptModel.getCountryCode());this.refLicModel.setCountry(licProfScriptModel.getCountry());this.refLicModel.setEinSs(licProfScriptModel.getEinSs());this.refLicModel.setEMailAddress(licProfScriptModel.getEmail());this.refLicModel.setFax(licProfScriptModel.getFax());this.refLicModel.setLicOrigIssDate(licProfScriptModel.getLicesnseOrigIssueDate());this.refLicModel.setPhone1(licProfScriptModel.getPhone1());this.refLicModel.setPhone2(licProfScriptModel.getPhone2());this.refLicModel.setSelfIns(licProfScriptModel.getSelfIns());this.refLicModel.setState(licProfScriptModel.getState());this.refLicModel.setLicState(licProfScriptModel.getState());this.refLicModel.setSuffixName(licProfScriptModel.getSuffixName());this.refLicModel.setWcExempt(licProfScriptModel.getWorkCompExempt());this.refLicModel.setZip(licProfScriptModel.getZip());this.refLicModel.setFein(licProfScriptModel.getFein());this.refLicModel.setPhone3(licProfScriptModel.getPhone3());this.refLicModel.setBusinessName2(licProfScriptModel.getBusName2());t=true}}}return t};this.copyToRecord=function(e,t){var n=false;if(this.valid){var r=aa.licenseProfessional.getLicenseProf(e);var i=new Array;var s=false;if(r.getSuccess()){i=r.getOutput()}if(i!=null){for(capLic in i){if(i[capLic].getLicenseNbr()+""==this.refLicModel.getStateLicense()+""&&i[capLic].getLicenseType()+""==this.refLicModel.getLicenseType()+""){if(t){aa.licenseProfessional.removeLicensedProfessional(i[capLic]);break}else{s=true}}}}if(!s){capListResult=aa.licenseScript.associateLpWithCap(e,this.refLicModel);n=capListResult.getSuccess();if(this.validTables&&n){var o=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput();this.infoTableGroupCodeObj.setCapId1(e.getID1());this.infoTableGroupCodeObj.setCapId2(e.getID2());this.infoTableGroupCodeObj.setCapId3(e.getID3());var u=this.infoTableGroupCodeObj.getReferenceId();var a=this.infoTableGroupCodeObj.getReferenceType();var f=this.infoTableGroupCodeObj.getReferenceDesc();this.infoTableGroupCodeObj.setReferenceId(this.refLicModel.getStateLicense());this.infoTableGroupCodeObj.setReferenceType(this.refLicModel.getLicenseType());this.infoTableGroupCodeObj.setReferenceDesc("Description");this.infoTableGroupCodeObj.setCategory(1);o.setInfoTableGroupCodeModel(this.infoTableGroupCodeObj);aa.licenseProfessional.createInfoTable(o);this.infoTableGroupCodeObj.setCapId1(null);this.infoTableGroupCodeObj.setCapId2(null);this.infoTableGroupCodeObj.setCapId3(null);this.infoTableGroupCodeObj.setReferenceId(u);this.infoTableGroupCodeObj.setReferenceType(a);this.infoTableGroupCodeObj.setReferenceDesc(f)}}}return n};this.enable=function(){this.refLicModel.setAuditStatus("A")};this.disable=function(){this.refLicModel.setAuditStatus("I")};this.getAssociatedRecords=function(){var e=new Array;if(this.valid){var t=aa.licenseScript.getCapIDsByLicenseModel(this.refLicModel);if(t.getSuccess()){var n=t.getOutput();if(n!=null)e=n}}return e};this.updateRecord=function(){var e=false;if(this.valid){this.refreshTables();var t=aa.licenseScript.editRefLicenseProf(this.refLicModel);e=t.getSuccess()}return e};return this}function linkPublicUserToContact(){var e="Applicant";var t;var n;var r;if(arguments.length>0)e=arguments[0];var i=aa.people.getCapContactByCapID(capId);if(i.getSuccess()){var s=i.getOutput();for(yy in s){if(e.equals(s[yy].getCapContactModel().getPeople().getContactType()))t=s[yy]}}if(!t){logDebug("Couldn't link public user for "+e+", no such contact");return false}if(t.getPeople().getContactTypeFlag().equals("organization")){logDebug("Couldn't link public user for "+e+", the contact is an organization");return false}n=t.getCapContactModel().getRefContactNumber();var o=aa.publicUser.getPublicUserByPUser(publicUserID);if(o.getSuccess()&&o.getOutput()){r=o.getOutput();logDebug("linkPublicUserToContact: Found an existing public user: "+r.getUserID())}else{logDebug("Couldn't link public user for "+e+", no such public user");return false}if(n){logDebug("linkPublicUserToContact: Linking this public user with reference contact : "+n);aa.licenseScript.associateContactWithPublicUser(r.getUserSeqNum(),n)}return r}function loadAddressAttributes(e){var t=capId;if(arguments.length==2)t=arguments[1];var n=null;var r=aa.address.getAddressWithAttributeByCapId(t);if(r.getSuccess())var n=r.getOutput();else logDebug("**ERROR: Failed to get Address object: "+r.getErrorType()+":"+r.getErrorMessage());for(i in n){addressAttrObj=n[i].getAttributes().toArray();for(z in addressAttrObj)e["AddressAttribute."+addressAttrObj[z].getB1AttributeName()]=addressAttrObj[z].getB1AttributeValue();e["AddressAttribute.PrimaryFlag"]=n[i].getPrimaryFlag();e["AddressAttribute.HouseNumberStart"]=n[i].getHouseNumberStart();e["AddressAttribute.StreetDirection"]=n[i].getStreetDirection();e["AddressAttribute.StreetName"]=n[i].getStreetName();e["AddressAttribute.StreetSuffix"]=n[i].getStreetSuffix();e["AddressAttribute.City"]=n[i].getCity();e["AddressAttribute.State"]=n[i].getState();e["AddressAttribute.Zip"]=n[i].getZip();e["AddressAttribute.AddressStatus"]=n[i].getAddressStatus();e["AddressAttribute.County"]=n[i].getCounty();e["AddressAttribute.Country"]=n[i].getCountry();e["AddressAttribute.AddressDescription"]=n[i].getAddressDescription();e["AddressAttribute.XCoordinate"]=n[i].getXCoordinator();e["AddressAttribute.YCoordinate"]=n[i].getYCoordinator()}}function loadAddressAttributes4ACA(e){fcapAddressObj=cap.getAddressModel();if(!fcapAddressObj){logDebug("No Address to get attributes");return false}addressAttr=fcapAddressObj.getAttributes();if(!addressAttr){logDebug("No attributes on this address");return false}addressAttrObj=addressAttr.toArray();for(z in addressAttrObj)e["AddressAttribute."+addressAttrObj[z].getB1AttributeName()]=addressAttrObj[z].getB1AttributeValue();e["AddressAttribute.PrimaryFlag"]=fcapAddressObj.getPrimaryFlag();e["AddressAttribute.HouseNumberStart"]=fcapAddressObj.getHouseNumberStart();e["AddressAttribute.StreetDirection"]=fcapAddressObj.getStreetDirection();e["AddressAttribute.StreetName"]=fcapAddressObj.getStreetName();e["AddressAttribute.StreetSuffix"]=fcapAddressObj.getStreetSuffix();e["AddressAttribute.City"]=fcapAddressObj.getCity();e["AddressAttribute.State"]=fcapAddressObj.getState();e["AddressAttribute.Zip"]=fcapAddressObj.getZip();e["AddressAttribute.AddressStatus"]=fcapAddressObj.getAddressStatus();e["AddressAttribute.County"]=fcapAddressObj.getCounty();e["AddressAttribute.Country"]=fcapAddressObj.getCountry();e["AddressAttribute.AddressDescription"]=fcapAddressObj.getAddressDescription();e["AddressAttribute.XCoordinate"]=fcapAddressObj.getXCoordinator();e["AddressAttribute.YCoordinate"]=fcapAddressObj.getYCoordinator()}function loadAppSpecific(e){var t=capId;if(arguments.length==2)t=arguments[1];var n=aa.appSpecificInfo.getByCapID(t);if(n.getSuccess()){var r=n.getOutput();for(loopk in r){if(useAppSpecificGroupName)e[r[loopk].getCheckboxType()+"."+r[loopk].checkboxDesc]=r[loopk].checklistComment;else e[r[loopk].checkboxDesc]=r[loopk].checklistComment}}}function loadAppSpecific4ACA(e){var t=capId;if(arguments.length>=2){t=arguments[1];var n=aa.appSpecificInfo.getByCapID(t).getOutput();for(loopk in n){if(useAppSpecificGroupName)e[n[loopk].getCheckboxType()+"."+n[loopk].checkboxDesc]=n[loopk].checklistComment;else e[n[loopk].checkboxDesc]=n[loopk].checklistComment}}else{var r=cap.getAppSpecificInfoGroups();if(!r){logDebug("No ASI for the CapModel")}else{var i=cap.getAppSpecificInfoGroups().iterator();while(i.hasNext()){var s=i.next();var o=s.getFields();if(o!=null){var u=o.iterator();while(u.hasNext()){var a=u.next();if(useAppSpecificGroupName)e[a.getCheckboxType()+"."+a.getCheckboxDesc()]=a.getChecklistComment();else e[a.getCheckboxDesc()]=a.getChecklistComment()}}}}}}function loadAppSpecific4Contact(e,t){var n=capId;if(arguments.length==3)n=arguments[2];var r=aa.people.getCapContactByPK(n,t);if(r.getSuccess()){var i=r.getOutput().getCapContactModel();if(i==null||i.getTemplate()==null||i.getTemplate().getTemplateForms()==null){return}var s=i.getTemplate();var o=s.getTemplateForms();for(var u=0;u<o.size();u++){var a=o.get(u);var f=a.subgroups;if(f==null){continue}for(var l=0;l<f.size();l++){var c=f.get(l);if(c==null||c.fields==null){continue}var h=c.fields;for(var p=0;p<h.size();p++){var d=h.get(p);e[d.displayFieldName]=d.defaultValue}}}}}function loadASITable(e){var t=capId;if(arguments.length==2)t=arguments[1];var n=aa.appSpecificTableScript.getAppSpecificTableGroupModel(t).getOutput();var r=n.getTablesArray();var i=r.iterator();while(i.hasNext()){var s=i.next();var o=s.getTableName();if(!o.equals(e))continue;if(s.rowIndex.isEmpty()){logDebug("Couldn't load ASI Table "+e+" it is empty");return false}var u=new Array;var a=new Array;var f=s.getTableField().iterator();var l=s.getColumns().iterator();var c=s.getAppSpecificTableModel().getReadonlyField().iterator();var h=1;while(f.hasNext()){if(!l.hasNext()){var l=s.getColumns().iterator();a.push(u);var u=new Array;h++}var p=l.next();var d=f.next();var v="N";if(c.hasNext()){v=c.next()}var m=new asiTableValObj(p.getColumnName(),d,v);u[p.getColumnName()]=m}a.push(u)}return a}function loadASITables(){var itemCap=capId;if(arguments.length==1)itemCap=arguments[0];var gm=aa.appSpecificTableScript.getAppSpecificTableGroupModel(itemCap).getOutput();var ta=gm.getTablesArray();var tai=ta.iterator();while(tai.hasNext()){var tsm=tai.next();var tempObject=new Array;var tempArray=new Array;var tn=tsm.getTableName();var numrows=0;tn=String(tn).replace(/[^a-zA-Z0-9]+/g,"");if(!isNaN(tn.substring(0,1)))tn="TBL"+tn;if(!tsm.rowIndex.isEmpty()){var tsmfldi=tsm.getTableField().iterator();var tsmcoli=tsm.getColumns().iterator();var readOnlyi=tsm.getAppSpecificTableModel().getReadonlyField().iterator();var numrows=1;while(tsmfldi.hasNext()){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next();var tval=tsmfldi.next();var readOnly="N";if(readOnlyi.hasNext()){readOnly=readOnlyi.next()}var fieldInfo=new asiTableValObj(tcol.getColumnName(),tval,readOnly);tempObject[tcol.getColumnName()]=fieldInfo}tempArray.push(tempObject)}var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)");eval(copyStr)}}function loadASITables4ACA(){var itemCap=capId;if(arguments.length==1){itemCap=arguments[0];var gm=aa.appSpecificTableScript.getAppSpecificTableGroupModel(itemCap).getOutput()}else{var gm=cap.getAppSpecificTableGroupModel()}var ta=gm.getTablesMap();var tai=ta.values().iterator();while(tai.hasNext()){var tsm=tai.next();if(tsm.rowIndex.isEmpty())continue;var tempObject=new Array;var tempArray=new Array;var tn=tsm.getTableName();tn=String(tn).replace(/[^a-zA-Z0-9]+/g,"");if(!isNaN(tn.substring(0,1)))tn="TBL"+tn;var tsmfldi=tsm.getTableField().iterator();var tsmcoli=tsm.getColumns().iterator();var numrows=1;while(tsmfldi.hasNext()){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next();var tval=tsmfldi.next().getInputValue();tempObject[tcol.getColumnName()]=tval}tempArray.push(tempObject);var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)");eval(copyStr)}}function loadASITablesBefore(){var gm=aa.env.getValue("AppSpecificTableGroupModel");var gmItem=gm;if(gm!=null&&typeof gm.size!="undefined"&&gm.size()>0){gmItem=gm.get(0)}else{gmItem=gm}if(null!=gmItem&&gmItem!=""){var ta=gmItem.getTablesMap().values();var tai=ta.iterator();while(tai.hasNext()){var tsm=tai.next();if(tsm.rowIndex.isEmpty())continue;var tempObject=new Array;var tempArray=new Array;var tn=tsm.getTableName();var numrows=0;tn=String(tn).replace(/[^a-zA-Z0-9]+/g,"");if(!isNaN(tn.substring(0,1)))tn="TBL"+tn;if(!tsm.rowIndex.isEmpty()){var tsmfldi=tsm.getTableField().iterator();var tsmcoli=tsm.getColumns().iterator();var numrows=1;while(tsmfldi.hasNext()){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next();var tval=tsmfldi.next();var readOnly="N";var fieldInfo=new asiTableValObj(tcol.getColumnName(),tval,readOnly);tempObject[tcol.getColumnName()]=fieldInfo}tempArray.push(tempObject)}var copyStr=""+tn+" = tempArray";aa.print("ASI Table Array : "+tn+" ("+numrows+" Rows)");eval(copyStr)}}}function loadFees(){var e=capId;if(arguments.length>0){ltcapidstr=arguments[0];if(typeof ltcapidstr=="string"){var t=aa.cap.getCapID(ltcapidstr);if(t.getSuccess())e=t.getOutput();else{logMessage("**ERROR: Failed to get cap ID: "+ltcapidstr+" error: "+t.getErrorMessage());return false}}else e=ltcapidstr}var n=new Array;var r=aa.fee.getFeeItems(e);if(r.getSuccess()){var i=r.getOutput()}else{logDebug("**ERROR: getting fee items: "+r.getErrorMessage());return false}for(ff in i){fFee=i[ff];var s=new Fee;var o=0;var u=aa.finance.getPaymentFeeItems(e,null);if(u.getSuccess()){var a=u.getOutput();for(ij in a)if(fFee.getFeeSeqNbr()==a[ij].getFeeSeqNbr())o+=a[ij].getFeeAllocation()}s.sequence=fFee.getFeeSeqNbr();s.code=fFee.getFeeCod();s.description=fFee.getFeeDescription();s.unit=fFee.getFeeUnit();s.amount=fFee.getFee();s.amountPaid=o;if(fFee.getApplyDate())s.applyDate=convertDate(fFee.getApplyDate());if(fFee.getEffectDate())s.effectDate=convertDate(fFee.getEffectDate());if(fFee.getExpireDate())s.expireDate=convertDate(fFee.getExpireDate());s.status=fFee.getFeeitemStatus();s.period=fFee.getPaymentPeriod();s.display=fFee.getDisplay();s.accCodeL1=fFee.getAccCodeL1();s.accCodeL2=fFee.getAccCodeL2();s.accCodeL3=fFee.getAccCodeL3();s.formula=fFee.getFormula();s.udes=fFee.getUdes();s.UDF1=fFee.getUdf1();s.UDF2=fFee.getUdf2();s.UDF3=fFee.getUdf3();s.UDF4=fFee.getUdf4();s.subGroup=fFee.getSubGroup();s.calcFlag=fFee.getCalcFlag();s.calcProc=fFee.getFeeCalcProc();s.version=fFee.getF4FeeItemModel().getVersion();n.push(s)}return n}function Fee(){this.sequence=null;this.code=null;this.description=null;this.unit=null;this.amount=null;this.amountPaid=null;this.applyDate=null;this.effectDate=null;this.expireDate=null;this.status=null;this.recDate=null;this.period=null;this.display=null;this.accCodeL1=null;this.accCodeL2=null;this.accCodeL3=null;this.formula=null;this.udes=null;this.UDF1=null;this.UDF2=null;this.UDF3=null;this.UDF4=null;this.subGroup=null;this.calcFlag=null;this.calcProc=null;this.auditDate=null;this.auditID=null;this.auditStatus=null;this.version=null}function loadGuideSheetItems(e){var t=new Array;var n=capId;if(arguments.length==2)n=arguments[1];var r=aa.inspection.getInspections(n);if(r.getSuccess()){var s=r.getOutput();for(i in s){if(s[i].getIdNumber()==e){var o=s[i].getInspection();var u=o.getGuideSheets();if(u){gsArray=u.toArray();for(var a in gsArray){var f=gsArray[a].getItems().toArray();for(var l in f)t[f[l].getGuideItemText()]=f[l].getGuideItemStatus()}}else logDebug("No guidesheets for this inspection")}}}logDebug("loaded "+t.length+" guidesheet items");return t}function loadParcelAttributes(e){var t=capId;if(arguments.length==2)t=arguments[1];var n=null;var r=aa.parcel.getParcelandAttribute(t,null);if(r.getSuccess())var n=r.getOutput().toArray();else logDebug("**ERROR: Failed to get Parcel object: "+r.getErrorType()+":"+r.getErrorMessage());for(i in n){parcelArea+=n[i].getParcelArea();parcelAttrObj=n[i].getParcelAttribute().toArray();for(z in parcelAttrObj)e["ParcelAttribute."+parcelAttrObj[z].getB1AttributeName()]=parcelAttrObj[z].getB1AttributeValue();e["ParcelAttribute.Block"]=n[i].getBlock();e["ParcelAttribute.Book"]=n[i].getBook();e["ParcelAttribute.CensusTract"]=n[i].getCensusTract();e["ParcelAttribute.CouncilDistrict"]=n[i].getCouncilDistrict();e["ParcelAttribute.ExemptValue"]=n[i].getExemptValue();e["ParcelAttribute.ImprovedValue"]=n[i].getImprovedValue();e["ParcelAttribute.InspectionDistrict"]=n[i].getInspectionDistrict();e["ParcelAttribute.LandValue"]=n[i].getLandValue();e["ParcelAttribute.LegalDesc"]=n[i].getLegalDesc();e["ParcelAttribute.Lot"]=n[i].getLot();e["ParcelAttribute.MapNo"]=n[i].getMapNo();e["ParcelAttribute.MapRef"]=n[i].getMapRef();e["ParcelAttribute.ParcelStatus"]=n[i].getParcelStatus();e["ParcelAttribute.SupervisorDistrict"]=n[i].getSupervisorDistrict();e["ParcelAttribute.Tract"]=n[i].getTract();e["ParcelAttribute.PlanArea"]=n[i].getPlanArea()}}function loadTasks(e){if(typeof e=="string"){var t=aa.cap.getCapID(e);if(t.getSuccess())ltCapId=t.getOutput();else{logMessage("**ERROR: Failed to get cap ID: "+e+" error: "+t.getErrorMessage());return false}}else ltCapId=e;var n=new Array;var r=aa.workflow.getTasks(ltCapId);if(r.getSuccess())wfObj=r.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in wfObj){fTask=wfObj[i];var s=new Task;s.status=fTask.getDisposition();s.comment=fTask.getDispositionComment();s.process=fTask.getProcessCode();if(fTask.getStatusDate())s.statusdate=""+(fTask.getStatusDate().getMonth()+1)+"/"+fTask.getStatusDate().getDate()+"/"+(fTask.getStatusDate().getYear()+1900);s.processID=fTask.getProcessID();s.note=fTask.getDispositionNote();s.step=fTask.getStepNumber();s.active=fTask.getActiveFlag();n[fTask.getTaskDescription()]=s}return n}function Task(){this.status=null;this.comment=null;this.note=null;this.statusdate=null;this.process=null;this.processID=null;this.step=null;this.active=null}function loadTaskSpecific(e){var t=capId;if(arguments.length==2)t=arguments[1];var n=aa.workflow.getTasks(t);if(n.getSuccess())var r=n.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+n.getErrorMessage());return false}for(i in r){var s=r[i];var o=s.getStepNumber();var u=s.getProcessID();var a=aa.taskSpecificInfo.getTaskSpecificInfoByTask(t,u,o);if(a.getSuccess()){var f=a.getOutput();for(a1 in f){if(useTaskSpecificGroupName)e[s.getProcessCode()+"."+s.getTaskDescription()+"."+f[a1].getCheckboxDesc()]=f[a1].getChecklistComment();else e[f[a1].getCheckboxDesc()]=f[a1].getChecklistComment()}}}}function logDebug(e){vLevel=1;if(arguments.length>1)vLevel=arguments[1];if((showDebug&vLevel)==vLevel||vLevel==1)debug+=e+br;if((showDebug&vLevel)==vLevel)aa.debug(aa.getServiceProviderCode()+" : "+aa.env.getValue("CurrentUserID"),e)}function logGlobals(e){for(loopGlob in e)logDebug("{"+loopGlob+"} = "+e[loopGlob])}function logMessage(e){message+=e+br}function lookup(e,t){var n;var r=aa.bizDomain.getBizDomainByValue(e,t);if(r.getSuccess()){var i=r.getOutput();n=""+i.getDescription();logDebug("lookup("+e+","+t+") = "+n)}else{logDebug("lookup("+e+","+t+") does not exist")}return n}function lookupDateRange(e,t){var n=1;if(arguments.length==3)n=arguments[2];var r=new Date(t);var i;for(var s=1;s<=9999;s++){var o="0000"+s;var o=String(o).substring(o.length,o.length-4);var u=aa.bizDomain.getBizDomainByValue(e,o);if(u.getSuccess()){var a=u.getOutput();var f=a.getDescription();if(a.getAuditStatus()!="I"){var l=i;var i=f.split("\\^");var c=new Date(i[0]);if(c>=r)if(l)return l[n];else break}}else if(i)return i[n];else break}}function lookupFeesByValuation(e,t,n){var r=1;if(arguments.length==4)r=arguments[3];var i;var s=lookup(e,t);if(s){workArr=s.split("^");for(var o in workArr){aa.print(workArr[o]);workVals=workArr[o].split("|");if(workVals[0]>n)return i;else if(r==1)i=workVals[r];else{i=parseInt((n-workVals[0])/100);if((n-workVals[0])%100>0)i++;i=i*workVals[r]}}}return i}function lookupFeesByValuationSlidingScale(e,t,n){var r=2;if(arguments.length==4)r=arguments[3]+1;var i;var s=lookup(e,t);if(s){workArr=s.split("^");for(var o in workArr){aa.print(workArr[o]);workVals=workArr[o].split("|");if(workVals[0]>n)return i;else if(r==2)i=workVals[r];else{var u=workVals[1];i=parseInt((n-workVals[0])/u);if((n-workVals[0])%u>0)i++;i=i*workVals[r]}}}return i}function loopTask(e,t,n,r){var s=false;var o="";if(arguments.length==5){o=arguments[4];s=true}var u=aa.workflow.getTaskItems(capId,e,o,null,null,null);if(u.getSuccess())var a=u.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}if(!t)t="NA";for(i in a){var f=a[i];if(f.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||f.getProcessCode().equals(o))){var l=aa.date.getCurrentDate();var c=f.getStepNumber();var h=f.getProcessID();if(s)aa.workflow.handleDisposition(capId,c,h,t,l,r,n,systemUserObj,"L");else aa.workflow.handleDisposition(capId,c,t,l,r,n,systemUserObj,"L");logMessage("Closing Workflow Task: "+e+" with status "+t+", Looping...");logDebug("Closing Workflow Task: "+e+" with status "+t+", Looping...")}}}function matches(e,t){for(var n=1;n<arguments.length;n++){if(arguments[n]==e){return true}}return false}function nextWorkDay(e){if(!e)t=new Date;else t=convertDate(e);if(!aa.calendar.getNextWorkDay){logDebug("getNextWorkDay function is only available in Accela Automation 6.3.2 or higher.")}else{var t=new Date(aa.calendar.getNextWorkDay(aa.date.parseDate(t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear())).getOutput().getTime())}return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear();}function openUrlInNewWindow(e){newurl='<invalidTag LANGUAGE="JavaScript">\r\n<!--\r\n newwin = window.open("';newurl+=e;newurl+='"); \r\n  //--> \r\n </SCRIPT>';comment(newurl)}function pairObj(e){this.ID=e;this.cri=null;this.act=null;this.elseact=null;this.enabled=true;this.continuation=false;this.branch=new Array;this.load=function(e){loadArr=e.split("\\^");if(loadArr.length<2||loadArr.length>3){logMessage('**ERROR: The following Criteria/Action pair is incorrectly formatted.  Two or three elements separated by a caret ("^") are required. '+br+br+e)}else{this.cri=loadArr[0];this.act=loadArr[1];this.elseact=loadArr[2];if(this.cri.length()==0)this.continuation=true;var t=loadArr[1];var n=t.indexOf("branch(");while(!enableVariableBranching&&n>=0){var r=t.substring(n);var i=r.indexOf('")');if(i<0)break;if(i>=9)this.branch.push(r.substring(8,i));t=r.substring(i);n=t.indexOf("branch(")}}}}function parcelConditionExists(e){var t=aa.parcel.getParcelandAttribute(capId,null);if(!t.getSuccess()){logDebug("**WARNING: error getting cap parcels : "+t.getErrorMessage());return false}var n=t.getOutput().toArray();for(zz in n){pcResult=aa.parcelCondition.getParcelConditions(n[zz].getParcelNumber());if(!pcResult.getSuccess()){logDebug("**WARNING: error getting parcel conditions : "+pcResult.getErrorMessage());return false}pcs=pcResult.getOutput();for(pc1 in pcs)if(pcs[pc1].getConditionType().equals(e))return true}}function parcelExistsOnCap(){var e=capId;if(arguments.length==1)e=arguments[0];var t=null;var n=aa.parcel.getParcelandAttribute(e,null);if(n.getSuccess())var t=n.getOutput().toArray();else{logDebug("**ERROR: Failed to get Parcel object: "+n.getErrorType()+":"+n.getErrorMessage());return false}for(i in t){return true}return false}function paymentByTrustAccount(e){feeSeqNbr=e;itemCap=capId;if(arguments.length==2)itemCap=arguments[1];iListResult=aa.finance.getInvoiceByCapID(itemCap,null);if(iListResult.getSuccess()){iList=iListResult.getOutput();invNbr="";feeAmount="";iFound=false;for(iNum in iList){fList=aa.invoice.getFeeItemInvoiceByInvoiceNbr(iList[iNum].getInvNbr()).getOutput();for(fNum in fList)if(fList[fNum].getFeeSeqNbr()==feeSeqNbr){invNbr=iList[iNum].getInvNbr();feeAmount=fList[fNum].getFee();iFound=true;logMessage("Invoice Number Found: "+invNbr);logMessage("Fee Amount: "+feeAmount);break}}if(!iFound){logMessage("Invoice not found");return false}}else{logDebug("Error: could not retrieve invoice list: "+iListResult.getErrorMessage());return false}var t=aa.trustAccount.getPrimaryTrustAccountByCAP(itemCap);if(t.getSuccess()){tAccountID=t.getOutput().getAcctID();tAcctResult=aa.trustAccount.getTrustAccountByAccountID(tAccountID);if(tAcctResult.getSuccess()){tAcct=tAcctResult.getOutput();if(tAcct.getOverdraft=="Y"){logDebug("Overdraft allowed");if(tAcct.getAcctBalance()+tAcct.getOverdraftLimit()<feeAmount){logDebug("The trust account balance plus overdraft allowance is less than invoiced fee amount.");logMessage("Trust Account Balance: "+tAcct.getAcctBalance());logDebug("Trust Account Overlimit allowance: "+tAcct.getOverdraftLimit());return false}}else{if(tAcct.getOverdraft=="N"){if(tAcct.getAcctBalance()<feeAmount){logDebug("The trust account balance is less than invoiced fee amount.");logMessage("Trust Account Balance: "+tAcct.getAcctBalance());return false}}}comment("Trust Account ID: "+tAcct.getAcctID());logDebug("Trust Account Balance: "+tAcct.getAcctBalance())}}else{logDebug("Error: could not retrieve trust account object: "+t.getErrorMessage());return false}p=aa.finance.createPaymentScriptModel();p.setAuditDate(aa.date.getCurrentDate());p.setAuditStatus("A");p.setCapID(itemCap);p.setCashierID(p.getAuditID());p.setPaymentSeqNbr(p.getPaymentSeqNbr());p.setPaymentAmount(feeAmount);p.setAmountNotAllocated(feeAmount);p.setPaymentChange(0);p.setPaymentComment("Trust Account Auto-Deduct: "+tAccountID);p.setPaymentDate(aa.date.getCurrentDate());p.setPaymentMethod("Trust Account");p.setPaymentStatus("Paid");p.setAcctID(tAccountID);presult=aa.finance.makePayment(p);if(presult.getSuccess()){pSeq=presult.getOutput();logDebug("Payment successful");pReturn=aa.finance.getPaymentByPK(itemCap,pSeq,currentUserID);if(pReturn.getSuccess()){pR=pReturn.getOutput();logDebug("PaymentSeq: "+pR.getPaymentSeqNbr())}else{logDebug("Error retrieving payment, must apply payment manually: "+pReturn.getErrorMessage());return false}}else{logDebug("error making payment: "+presult.getErrorMessage());return false}feeSeqNbrArray=new Array;feeSeqNbrArray.push(feeSeqNbr);invNbrArray=new Array;invNbrArray.push(invNbr);feeAllocArray=new Array;feeAllocArray.push(feeAmount);applyResult=aa.finance.applyPayment(itemCap,pR.getPaymentSeqNbr(),feeAmount,feeSeqNbrArray,invNbrArray,feeAllocArray,aa.date.getCurrentDate(),"Paid","Paid",pR.getCashierID(),null);if(applyResult.getSuccess()){apply=applyResult.getOutput();logDebug("Apply Payment Successful")}else{logDebug("error applying funds: "+applyResult.getErrorMessage());return false}receiptResult=aa.finance.generateReceipt(itemCap,aa.date.getCurrentDate(),pR.getPaymentSeqNbr(),pR.getCashierID(),null);if(receiptResult.getSuccess()){receipt=receiptResult.getOutput();logDebug("Receipt successfully created: ")}else{logDebug("error generating receipt: "+receiptResult.getErrorMessage());return false}return true}function paymentByTrustAccount(e){feeSeqNbr=e;itemCap=capId;if(arguments.length==2)itemCap=arguments[1];iListResult=aa.finance.getInvoiceByCapID(itemCap,null);if(iListResult.getSuccess()){iList=iListResult.getOutput();invNbr="";feeAmount="";iFound=false;for(iNum in iList){fList=aa.invoice.getFeeItemInvoiceByInvoiceNbr(iList[iNum].getInvNbr()).getOutput();for(fNum in fList)if(fList[fNum].getFeeSeqNbr()==feeSeqNbr){invNbr=iList[iNum].getInvNbr();feeAmount=fList[fNum].getFee();iFound=true;logMessage("Invoice Number Found: "+invNbr);logMessage("Fee Amount: "+feeAmount);break}}if(!iFound){logMessage("Invoice not found");return false}}else{logDebug("Error: could not retrieve invoice list: "+iListResult.getErrorMessage());return false}var t=aa.trustAccount.getPrimaryTrustAccountByCAP(itemCap);if(t.getSuccess()){tAccountID=t.getOutput().getAcctID();tAcctResult=aa.trustAccount.getTrustAccountByAccountID(tAccountID);if(tAcctResult.getSuccess()){tAcct=tAcctResult.getOutput();if(tAcct.getOverdraft=="Y"){logDebug("Overdraft allowed");if(tAcct.getAcctBalance()+tAcct.getOverdraftLimit()<feeAmount){logDebug("The trust account balance plus overdraft allowance is less than invoiced fee amount.");logMessage("Trust Account Balance: "+tAcct.getAcctBalance());logDebug("Trust Account Overlimit allowance: "+tAcct.getOverdraftLimit());return false}}else{if(tAcct.getOverdraft=="N"){if(tAcct.getAcctBalance()<feeAmount){logDebug("The trust account balance is less than invoiced fee amount.");logMessage("Trust Account Balance: "+tAcct.getAcctBalance());return false}}}comment("Trust Account ID: "+tAcct.getAcctID());logDebug("Trust Account Balance: "+tAcct.getAcctBalance())}}else{logDebug("Error: could not retrieve trust account object: "+t.getErrorMessage());return false}p=aa.finance.createPaymentScriptModel();p.setAuditDate(aa.date.getCurrentDate());p.setAuditStatus("A");p.setCapID(itemCap);p.setCashierID(p.getAuditID());p.setPaymentSeqNbr(p.getPaymentSeqNbr());p.setPaymentAmount(feeAmount);p.setAmountNotAllocated(feeAmount);p.setPaymentChange(0);p.setPaymentComment("Trust Account Auto-Deduct: "+tAccountID);p.setPaymentDate(aa.date.getCurrentDate());p.setPaymentMethod("Trust Account");p.setPaymentStatus("Paid");p.setAcctID(tAccountID);presult=aa.finance.makePayment(p);if(presult.getSuccess()){pSeq=presult.getOutput();logDebug("Payment successful");pReturn=aa.finance.getPaymentByPK(itemCap,pSeq,currentUserID);if(pReturn.getSuccess()){pR=pReturn.getOutput();logDebug("PaymentSeq: "+pR.getPaymentSeqNbr())}else{logDebug("Error retrieving payment, must apply payment manually: "+pReturn.getErrorMessage());return false}}else{logDebug("error making payment: "+presult.getErrorMessage());return false}feeSeqNbrArray=new Array;feeSeqNbrArray.push(feeSeqNbr);invNbrArray=new Array;invNbrArray.push(invNbr);feeAllocArray=new Array;feeAllocArray.push(feeAmount);applyResult=aa.finance.applyPayment(itemCap,pR.getPaymentSeqNbr(),feeAmount,feeSeqNbrArray,invNbrArray,feeAllocArray,aa.date.getCurrentDate(),"Paid","Paid",pR.getCashierID(),null);if(applyResult.getSuccess()){apply=applyResult.getOutput();logDebug("Apply Payment Successful")}else{logDebug("error applying funds: "+applyResult.getErrorMessage());return false}receiptResult=aa.finance.generateReceipt(itemCap,aa.date.getCurrentDate(),pR.getPaymentSeqNbr(),pR.getCashierID(),null);if(receiptResult.getSuccess()){receipt=receiptResult.getOutput();logDebug("Receipt successfully created: ")}else{logDebug("error generating receipt: "+receiptResult.getErrorMessage());return false}return true}function paymentGetNotAppliedTot(){var e=aa.cashier.getSumNotAllocated(capId);if(e.getSuccess()){var t=e.getOutput();return parseFloat(t)}else{logDebug("**ERROR: Getting total not applied: "+e.getErrorMessage());return false}return false}function prepareRenewal(){if(isRenewProcess(parentCapId,capId)){logDebug("CAPID("+parentCapId+") is ready for renew. PartialCap ("+capId+")");var e=aa.cap.createRenewalCap(parentCapId,capId,true);if(e.getSuccess()){aa.cap.updateAccessByACA(capId,"N")}else{logDebug("ERROR: Associate partial cap with parent CAP. "+e.getErrorMessage());return false}return true}else{logDebug("Renewal Process did not finish properly");return false}}function proximity(e,t,n){var r="feet";if(arguments.length==4)r=arguments[3];var i=aa.gis.getGISType(e,t);if(i.getSuccess()){var s=i.getOutput();s.addAttributeName(t+"_ID")}else{logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+i.getErrorType()+":"+i.getErrorMessage());return false}var o=aa.gis.getCapGISObjects(capId);if(o.getSuccess())var u=o.getOutput();else{logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+o.getErrorType()+":"+o.getErrorMessage());return false}for(a1 in u){var a=aa.gis.getBufferByRadius(u[a1],n,r,s);if(a.getSuccess())var f=a.getOutput();else{logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+a.getErrorType()+":"+a.getErrorMessage());return false}for(a2 in f){var l=f[a2].getGISObjects();if(l.length){return true}}}}function proximityToAttribute(e,t,n,r,i,s){var o=aa.gis.getGISType(e,t);if(o.getSuccess()){var u=o.getOutput();u.addAttributeName(i)}else{logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+o.getErrorType()+":"+o.getErrorMessage());return false}var a=aa.gis.getCapGISObjects(capId);if(a.getSuccess())var f=a.getOutput();else{logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+a.getErrorType()+":"+a.getErrorMessage());return false}for(a1 in f){var l=aa.gis.getBufferByRadius(f[a1],n,r,u);if(l.getSuccess())var c=l.getOutput();else{logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+l.getErrorType()+":"+l.getErrorMessage());return false}for(a2 in c){proxObj=c[a2].getGISObjects();for(z1 in proxObj){var h=proxObj[z1].getAttributeValues();retString=h[0];if(retString&&retString.equals(s))return true}}}}function refLicProfGetAttribute(e,t){if(e==null||e.length==0||t==null||t.length==0){logDebug("Invalid license number or attribute name parameter");return"INVALID PARAMETER"}var n=getRefLicenseProf(e);var r=0;var s="";if(n){r=n.getLicSeqNbr();s=n.getLicenseType();logDebug("License Seq Num: "+r+", License Type: "+s)}else{logMessage("No reference licensed professional found with state license number of "+e);logDebug("No reference licensed professional found with state license number of "+e);return"NO LICENSE FOUND"}if(!(r==0||r==null||s==""||s==null)){var o=aa.people.getPeopleAttributeByPeople(r,s);if(!o.getSuccess()){logDebug("**ERROR retrieving reference license professional attribute: "+o.getErrorMessage());return false}var u=o.getOutput();if(u){for(i in u){if(t.equals(u[i].getAttributeName())){logDebug("Reference record for license "+e+", attribute "+t+": "+u[i].getAttributeValue());return u[i].getAttributeValue()}}logDebug("Reference record for license "+e+" has no attribute named "+t);return"ATTRIBUTE NOT FOUND"}else{logDebug("Reference record for license "+e+" has no custom attributes");return"ATTRIBUTE NOT FOUND"}}else{logDebug("Missing seq nbr or license type");return false}}function refLicProfGetDate(e,t){if(t==null||t=="")var n="EXPIRE";else{var n=t.toUpperCase();if(!(n=="ISSUE"||n=="RENEW"||n=="BUSINESS"||n=="INSURANCE"))n="EXPIRE"}if(e==null||e==""){logDebug("Invalid license number parameter");return"INVALID PARAMETER"}var r=getRefLicenseProf(e);if(r){var i=new Date;if(n=="EXPIRE"){if(r.getLicenseExpirationDate()){i=convertDate(r.getLicenseExpirationDate());logDebug(e+" License Expiration Date: "+jsDateToMMDDYYYY(i));return i}else{logDebug("Reference record for license "+e+" has no License Expiration Date");return"NO DATE FOUND"}}else if(n=="INSURANCE"){if(r.getInsuranceExpDate()){i=convertDate(r.getInsuranceExpDate());logDebug(e+" Insurance Expiration Date: "+jsDateToMMDDYYYY(i));return i}else{logDebug("Reference record for license "+e+" has no Insurance Expiration Date");return"NO DATE FOUND"}}else if(n=="BUSINESS"){if(r.getBusinessLicExpDate()){i=convertDate(r.getBusinessLicExpDate());logDebug(e+" Business Lic Expiration Date: "+jsDateToMMDDYYYY(i));return i}else{logDebug("Reference record for license "+e+" has no Business Lic Exp Date");return"NO DATE FOUND"}}else if(n=="ISSUE"){if(r.getLicenseIssueDate()){i=convertDate(r.getLicenseIssueDate());logDebug(e+" License Issue Date: "+jsDateToMMDDYYYY(i));return i}else{logDebug("Reference record for license "+e+" has no Issue Date");return"NO DATE FOUND"}}else if(n=="RENEW"){if(r.getLicenseLastRenewalDate()){i=convertDate(r.getLicenseLastRenewalDate());logDebug(e+" License Last Renewal Date: "+jsDateToMMDDYYYY(i));return i}else{logDebug("Reference record for license "+e+" has no Last Renewal Date");return"NO DATE FOUND"}}else return"NO DATE FOUND"}}function removeAllFees(e){getFeeResult=aa.fee.getFeeItems(e,null,"NEW");if(getFeeResult.getSuccess()){var t=getFeeResult.getOutput();for(feeNum in t){if(t[feeNum].getFeeitemStatus().equals("NEW")){var n=t[feeNum].getFeeSeqNbr();var r=aa.finance.removeFeeItem(e,n);if(r.getSuccess()){logDebug("Removed existing Fee Item: "+t[feeNum].getFeeCod())}else{logDebug("**ERROR: removing fee item ("+t[feeNum].getFeeCod()+"): "+r.getErrorMessage());break}}if(t[feeNum].getFeeitemStatus().equals("INVOICED")){logDebug("Invoiced fee "+t[feeNum].getFeeCod()+" found, not removed")}}}else{logDebug("**ERROR: getting fee items ("+t[feeNum].getFeeCod()+"): "+getFeeResult.getErrorMessage())}}function removeASITable(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.appSpecificTableScript.removeAppSpecificTableInfos(e,t,currentUserID);if(!n.getSuccess()){aa.print("**WARNING: error removing ASI table "+e+" "+n.getErrorMessage());return false}else logDebug("Successfully removed all rows from ASI Table: "+e)}function removeCapCondition(e,t){var n=capId;if(arguments.length==3)n=arguments[2];var r=aa.capCondition.getCapConditions(n,e);if(!r.getSuccess()){logDebug("**WARNING: error getting cap conditions : "+r.getErrorMessage());return false}var i=r.getOutput();for(pc1 in i){if(i[pc1].getConditionDescription().equals(t)){var s=aa.capCondition.deleteCapCondition(n,i[pc1].getConditionNumber());if(s.getSuccess())logDebug("Successfully removed condition to CAP : "+n+"  ("+e+") "+t);else logDebug("**ERROR: removing condition to Parcel "+parcelNum+"  ("+e+"): "+addParcelCondResult.getErrorMessage())}}}function removeFee(e,t){getFeeResult=aa.finance.getFeeItemsByFeeCodeAndPeriod(capId,e,t,"NEW");if(getFeeResult.getSuccess()){var n=getFeeResult.getOutput();for(feeNum in n){if(n[feeNum].getFeeitemStatus().equals("NEW")){var r=n[feeNum].getFeeSeqNbr();var i=aa.finance.removeFeeItem(capId,r);if(i.getSuccess()){logDebug("Removed existing Fee Item: "+e)}else{logDebug("**ERROR: removing fee item ("+e+"): "+i.getErrorMessage());break}}if(n[feeNum].getFeeitemStatus().equals("INVOICED")){logDebug("Invoiced fee "+e+" found, not removed")}}}else{logDebug("**ERROR: getting fee items ("+e+"): "+getFeeResult.getErrorMessage())}}function removeParcelCondition(e,t,n){if(!e){var r=aa.parcel.getParcelandAttribute(capId,null);if(r.getSuccess()){var i=r.getOutput().toArray();for(zz in i){e=i[zz].getParcelNumber();logDebug("Adding Condition to parcel #"+zz+" = "+e);var s=aa.parcelCondition.getParcelConditions(e);if(!s.getSuccess()){logDebug("**WARNING: error getting parcel conditions : "+s.getErrorMessage());return false}var o=s.getOutput();for(pc1 in o){if(o[pc1].getConditionType().equals(t)&&o[pc1].getConditionDescription().equals(n)){var u=aa.parcelCondition.removeParcelCondition(o[pc1].getConditionNumber(),e);if(u.getSuccess())logDebug("Successfully removed condition to Parcel "+e+"  ("+t+") "+n)}else logDebug("**ERROR: removing condition to Parcel "+e+"  ("+t+"): "+addParcelCondResult.getErrorMessage())}}}}else{var s=aa.parcelCondition.getParcelConditions(e);if(!s.getSuccess()){logDebug("**WARNING: error getting parcel conditions : "+s.getErrorMessage());return false}var o=s.getOutput();for(pc1 in o){if(o[pc1].getConditionType().equals(t)&&o[pc1].getConditionDescription().equals(n)){var u=aa.parcelCondition.removeParcelCondition(o[pc1].getConditionNumber(),e);if(u.getSuccess())logDebug("Successfully removed condition to Parcel "+e+"  ("+t+") "+n)}else logDebug("**ERROR: removing condition to Parcel "+e+"  ("+t+"): "+addParcelCondResult.getErrorMessage())}}}function removeRefContactAddressFromRecordContact(e,t,n){if(e&&t&&n){var r=aa.address.createXRefContactAddressModel().getOutput();r.setCapID(e);r.setAddressID(n.getAddressID());r.setEntityID(aa.util.parseLong(t));r.setEntityType(n.getEntityType());var i=aa.address.deleteXRefContactAddress(r.getXRefContactAddressModel());if(i.getSuccess){logDebug("Successfully removed reference contact address to cap contact: "+t);return true}else{logDebug("Failed to remove reference contact address to cap: "+i.getErrorMessage());return false}}else{logDebug("Could not remove reference contact address no address model, capId or cap contact sequence number");return false}}function removeTask(e,t){var n=false;var r="";if(arguments.length==3){r=arguments[2];n=true}var s=aa.workflow.getTaskItems(e,t,r,null,null,null);if(s.getSuccess())var o=s.getOutput();else{logDebug("**WARNING: Failed to get workflow object: "+s.getErrorMessage());return false}var u=null;for(i in o){var a=o[i];if(a.getTaskDescription().toUpperCase().equals(t.toUpperCase())&&(!n||a.getProcessCode().toUpperCase().equals(r.toUpperCase()))){u=o[i]}}if(!u){logDebug("**WARNING: Task to remove not found: "+t);return false}var f=aa.workflow.removeTask(u);if(!f.getSuccess()){logDebug("**WARNING: error removing task "+f.getErrorMessage());return false}else{logDebug("Removed task "+u.getTaskDescription())}}function replaceMessageTokens(m){while(m.indexOf("|")){var s=m.indexOf("|");var e=m.indexOf("|",s+1);if(e<=0)break;var r=m.substring(s+1,e);var evalstring="typeof("+r+') != "undefined" ? '+r+' : "undefined"';var v=eval(evalstring);var pattern=new RegExp("\\|"+r+"\\|","g");m=String(m).replace(pattern,v)}while(m.indexOf("{")){var s=m.indexOf("{");var e=m.indexOf("}",s+1);if(e<=0)break;var r=m.substring(s+1,e);var evalstring='AInfo["'+r+'"]';var v=eval(evalstring);var pattern=new RegExp("\\{"+r+"\\}","g");m=String(m).replace(pattern,v)}return m}function replaceNode(e,t,n){var r="";var i="<"+t+">";var s="</"+t+">";startPos=e.indexOf(i)+i.length;endPos=e.indexOf(s);if(startPos>0&&startPos<=endPos){r=e.substring(0,startPos)+n+e.substring(endPos);return unescape(r)}}function resultInspection(e,t,n,r){var i=capId;if(arguments.length>4)i=arguments[4];var s;var o=aa.inspection.getInspections(i);if(o.getSuccess()){var u=o.getOutput();for(xx in u)if(String(e).equals(u[xx].getInspectionType())&&u[xx].getInspectionStatus().toUpperCase().equals("SCHEDULED"))s=u[xx].getIdNumber()}if(s){resultResult=aa.inspection.resultInspection(i,s,t,n,r,currentUserID);if(resultResult.getSuccess()){logDebug("Successfully resulted inspection: "+e+" to Status: "+t)}else{logDebug("**WARNING could not result inspection : "+e+", "+resultResult.getErrorMessage())}}else{logDebug("Could not result inspection : "+e+", not scheduled")}}function runEvent(e,t){try{var n=prefix;if(t){if(doStdChoices){doStandardChoiceActions(t,true,0)}else{logDebug("runEvent:  Can't execute standard choices for control string "+t+" because doStdChoices is false")}}prefix=lookup("EMSE_VARIABLE_BRANCH_PREFIX",e);if(prefix){if(doScripts){doScriptActions()}else{logDebug("runEvent:  Can't execute scripts for event "+e+" because doScripts is false")}}else{logDebug("runEvent:  Can't execute scripts for event "+e+" because prefix is not defined in std Choice EMSE_VARIABLE_BRANCH_PREFIX")}prefix=n}catch(r){handleError(r,s)}}function runReport4Email(e,t,n,r,i,s,o,u){var a=false;if(n){if(!matches(n.people.getEmail(),null,undefined,"")){var f;f=generateReport(e,t,o,r);if(f){var l=new Array;l.push(f);sendNotification(u,n.people.getEmail(),"",s,i,l,e);return true}}else{a=false}}else{a=false}if(!a){return false}}function runReport4EmailOrPrint(e,t,n,r,i,s,o){var u=false;if(n){if(!matches(n.people.getEmail(),null,undefined,"")){var a;a=generateReport(e,t,o,r);if(a){var f=new Array;f.push(a);sendNotification(sysFromEmail,n.people.getEmail(),"",s,i,f);comment("Email with "+t+" was sent to "+n.people.getEmail());u=true}}else{u=true}}else{u=true}if(u){var l=generateReport4Workflow(e,t,o,r);showMessage=true;comment(l)}}function runReportAttach(e,t){var n=t;a=aa.reportManager.getReportInfoModelByName(n);if(!a.getSuccess()){logDebug("**WARNING** couldn't load report "+n+" "+a.getErrorMessage());return false}var r=a.getOutput();var i=aa.cap.getCap(e).getOutput();appTypeResult=i.getCapType();appTypeString=appTypeResult.toString();appTypeArray=appTypeString.split("/");r.setModule(appTypeArray[0]);r.setCapId(e.getID1()+"-"+e.getID2()+"-"+e.getID3());r.getEDMSEntityIdModel().setAltId(e.getCustomID());var s=aa.util.newHashMap();for(var o=2;o<arguments.length;o=o+2){s.put(arguments[o],arguments[o+1]);logDebug("Report parameter: "+arguments[o]+" = "+arguments[o+1])}r.setReportParameters(s);var u=aa.reportManager.hasPermission(n,currentUserID);if(u.getOutput().booleanValue()){var a=aa.reportManager.getReportResult(r);logDebug("Report "+t+" has been run for "+e.getCustomID())}else logDebug("No permission to report: "+n+" for user: "+currentUserID)}function scheduleInspect(e,t,n){var r=null;var i=null;var s="Scheduled via Script";if(arguments.length>=3)if(arguments[2]!=null){var o=aa.person.getUser(arguments[2]);if(o.getSuccess())var r=o.getOutput()}if(arguments.length>=4)if(arguments[3]!=null)i=arguments[3];if(arguments.length==5)if(arguments[4]!=null)s=arguments[4];var u=aa.inspection.scheduleInspection(itemCap,r,aa.date.parseDate(dateAdd(null,n)),i,t,s);if(u.getSuccess())logDebug("Successfully scheduled inspection : "+t+" for "+dateAdd(null,n));else logDebug("**ERROR: adding scheduling inspection ("+t+"): "+u.getErrorMessage())}function scheduleInspectDate(e,t){var n=null;var r=null;var i="Scheduled via Script";if(arguments.length>=3)if(arguments[2]!=null){var s=aa.person.getUser(arguments[2]);if(s.getSuccess())n=s.getOutput()}if(arguments.length>=4)if(arguments[3]!=null)r=arguments[3];if(arguments.length>=5)if(arguments[4]!=null)i=arguments[4];var o=aa.inspection.scheduleInspection(capId,n,aa.date.parseDate(t),r,e,i);if(o.getSuccess())logDebug("Successfully scheduled inspection : "+e+" for "+t);else logDebug("**ERROR: adding scheduling inspection ("+e+"): "+o.getErrorMessage())}function scheduleInspection(e,t){var n=null;var r=null;var i="Scheduled via Script";if(arguments.length>=3)if(arguments[2]!=null){var s=aa.person.getUser(arguments[2]);if(s.getSuccess())var n=s.getOutput()}if(arguments.length>=4)if(arguments[3]!=null)r=arguments[3];if(arguments.length==5)if(arguments[4]!=null)i=arguments[4];var o=aa.inspection.scheduleInspection(capId,n,aa.date.parseDate(dateAdd(null,t)),r,e,i);if(o.getSuccess())logDebug("Successfully scheduled inspection : "+e+" for "+dateAdd(null,t));else logDebug("**ERROR: adding scheduling inspection ("+e+"): "+o.getErrorMessage())}function searchProject(e,t){var n=1;var r;var i=false;var s=new Array;var o=new Array;var u=new Array;var a=new Array;var f=false;var l;while(true){if(!aa.cap.getProjectParents(capId,n).getSuccess())break;n+=1}n-=1;getCapResult=aa.cap.getProjectParents(capId,n);myArray=new Array;myOutArray=new Array;if(e!=null){var r=e.split("/");if(r.length!=4)logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+pCapType)}if(getCapResult.getSuccess()){parentArray=getCapResult.getOutput();if(parentArray.length){for(x in parentArray)childTypeArray=parentArray[x].getCapType().toString().split("/");l=true;for(yy in childTypeArray){if(!r[yy].equals(childTypeArray[yy])&&!r[yy].equals("*")){l=false;break}}if(l)myArray.push(parentArray[x].getCapID())}}if(!myArray.length)return s;a=myArray;var c="";if(t!=null){r=t.split("/");if(r.length!=4)logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+t)}while(true){for(x in a){o=getChildren("*/*/*/*",a[x]);if(o==null)continue;for(y in o){i=false;for(z in s){if(s[z].getCustomID().equals(o[y].getCustomID())){i=true;break}}if(!i){u.push(o[y]);if(!capId.getCustomID().equals(o[y].getCustomID())){var h=aa.cap.getCap(o[y]).getOutput().getCapType().toString().split("/");l=true;for(p in h){if(r[p]!=h[p]&&r[p]!="*"){l=false;break}}if(l){s.push(o[y])}}}}}if(u.length)a=u;else break;u=new Array}return s}function sendNotification(e,t,n,r,i,s){var o=capId;if(arguments.length==7)o=arguments[6];var u=o.ID1;var a=o.ID2;var f=o.ID3;var l=aa.cap.createCapIDScriptModel(u,a,f);var c=null;c=aa.document.sendEmailAndSaveAsDocument(e,t,n,r,i,l,s);if(c.getSuccess()){logDebug("Sent email successfully!");return true}else{logDebug("Failed to send mail. - "+c.getErrorType());return false}}function setContactTypeFlagByType(e){var t=getContactObjs(e);for(var n in t){thisContact=t[n];var r=lookup("CONTACT TYPE FLAG",thisContact.type);if(r==undefined)continue;thisContact.people.setContactTypeFlag(r);thisContact.save()}}function setIVR(e){var t=aa.cap.newCapScriptModel().getOutput();var n=t.getCapModel();var r=n.getCapID();r.setServiceProviderCode(t.getServiceProviderCode());r.setID1(aa.env.getValue("PermitId1"));r.setID2(aa.env.getValue("PermitId2"));r.setID3(aa.env.getValue("PermitId3"));n.setTrackingNbr(e);n.setCapID(r);aa.cap.editCapByPK(n);logDebug("IVR Tracking Number updated to "+e)}function setLicExpirationDate(e){var t=e.getCustomID();if(arguments.length==1){calcDateFrom=null;dateOverride=null;renewalStatus=null}if(arguments.length==2){calcDateFrom=arguments[1];dateOverride=null;renewalStatus=null}if(arguments.length==3){calcDateFrom=arguments[1];dateOverride=arguments[2];renewalStatus=null}if(arguments.length==4){calcDateFrom=arguments[1];dateOverride=arguments[2];renewalStatus=arguments[3]}var n="";b1ExpResult=aa.expiration.getLicensesByCapID(e);if(b1ExpResult.getSuccess()){this.b1Exp=b1ExpResult.getOutput();var r=this.b1Exp.getExpUnit();var i=this.b1Exp.getExpInterval();if(r==null){logDebug("Could not set the expiration date, no expiration unit defined for expiration code: "+this.b1Exp.getExpCode());return false}if(r=="Days"){n=dateAdd(calcDateFrom,i)}if(r=="Months"){n=dateAddMonths(calcDateFrom,i)}if(r=="Years"){n=dateAddMonths(calcDateFrom,i*12)}}thisLic=new licenseObject(t,e);if(dateOverride==null){thisLic.setExpiration(dateAdd(n,0))}else{thisLic.setExpiration(dateAdd(dateOverride,0))}if(renewalStatus!=null){thisLic.setStatus(renewalStatus)}else{thisLic.setStatus("Active")}logDebug("Successfully set the expiration date and status");return true}function setTask(e,t,n){var r=false;var s="";if(arguments.length==4){s=arguments[3];r=true}var o=aa.workflow.getTaskItems(capId,e,s,null,null,null);if(o.getSuccess())var u=o.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in u){var a=u[i];if(a.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!r||a.getProcessCode().equals(s))){var f=a.getStepNumber();var l=a.getProcessID();var c=a.getCompleteFlag();if(r)aa.workflow.adjustTask(capId,f,l,t,n,null,null);else aa.workflow.adjustTask(capId,f,t,n,null,null);logDebug("set Workflow Task: "+e)}}}function stripNN(e){var t="0123456789.";var n="";for(i=0;i<e.length();i++)if(t.indexOf(String.fromCharCode(e.charAt(i)))>=0)n+=String.fromCharCode(e.charAt(i));return n}function taskCloseAllExcept(e,t){var n=new Array;var r=false;if(arguments.length>2){for(var i=2;i<arguments.length;i++)n.push(arguments[i])}else r=true;var s=aa.workflow.getTasks(capId);if(s.getSuccess())var o=s.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s.getErrorMessage());return false}var u;var a;var f;var l=aa.date.getCurrentDate();var c=" ";var h;for(i in o){u=o[i];h=u.getTaskDescription();a=u.getStepNumber();if(r){aa.workflow.handleDisposition(capId,a,e,l,c,t,systemUserObj,"Y");logMessage("Closing Workflow Task "+h+" with status "+e);logDebug("Closing Workflow Task "+h+" with status "+e)}else{if(!exists(h,n)){aa.workflow.handleDisposition(capId,a,e,l,c,t,systemUserObj,"Y");logMessage("Closing Workflow Task "+h+" with status "+e);logDebug("Closing Workflow Task "+h+" with status "+e)}}}}function taskStatus(e){var t=false;var n="";var r=capId;if(arguments.length>=2){n=arguments[1];if(n)t=true}if(arguments.length==3)r=arguments[2];var s=aa.workflow.getTaskItems(r,e,n,null,null,null);if(s.getSuccess())var o=s.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s.getErrorMessage());return false}for(i in o){var u=o[i];if(u.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!t||u.getProcessCode().equals(n)))return u.getDisposition()}}function taskStatusDate(e){var t=capId;if(arguments.length==3)t=arguments[2];var n=false;var r="";if(arguments.length>1&&arguments[1]!=null){r=arguments[1];n=true}var s=aa.workflow.getTaskItems(t,e,r,null,null,null);if(s.getSuccess())var o=s.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+o.getErrorMessage());return false}for(i in o){var u=o[i];if(u.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!n||u.getProcessCode().equals(r)))if(u.getStatusDate()!=null)return""+(u.getStatusDate().getMonth()+1)+"/"+u.getStatusDate().getDate()+"/"+(parseInt(u.getStatusDate().getYear())+1900);else{logMessage("**ERROR: NULL workflow task "+u.getTaskDescription()+" status date. ");return false}}}function token(e){if(!disableTokens){re=new RegExp("\\{","g");e=String(e).replace(re,'AInfo["');re=new RegExp("\\}","g");e=String(e).replace(re,'"]')}return String(e)}function transferFeesAndPayments(e,t){var n=aa.finance.getPaymentByCapID(capId,null).getOutput();var r=new Array;var i=new Array;var s=new Array;for(ik in n){var o=n[ik];var u=aa.finance.getPaymentFeeItems(capId,null);if(u.getSuccess()){var a=u.getOutput();for(ij in a)if(a[ij].getPaymentSeqNbr()==o.getPaymentSeqNbr()){r.push(a[ij].getFeeSeqNbr());i.push(a[ij].getInvoiceNbr());s.push(a[ij].getFeeAllocation())}}if(r.length>0){z=aa.finance.applyRefund(capId,o,r,i,s,"FeeStat","InvStat","123");if(z.getSuccess()){logDebug("Refund applied")}else{logDebug("Error applying refund "+z.getErrorMessage())}}}feeA=loadFees();for(var f in feeA){thisFee=feeA[f];logDebug("status is "+thisFee.status);if(thisFee.status=="INVOICED"){addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"Y",t);voidResult=aa.finance.voidFeeItem(capId,thisFee.sequence);if(voidResult.getSuccess()){logDebug("Fee item "+thisFee.code+"("+thisFee.sequence+") has been voided")}else{logDebug("**ERROR: voiding fee item "+thisFee.code+"("+thisFee.sequence+") "+voidResult.getErrorMessage())}var r=new Array;var l=new Array;r.push(thisFee.sequence);l.push(thisFee.period);var c=aa.finance.createInvoice(capId,r,l);if(!c.getSuccess())logDebug("**ERROR: Invoicing the fee items voided "+feeCapMessage+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}}var h=paymentGetNotAppliedTot();var p=aa.finance.makeFundTransfer(capId,t,currentUserID,"","",sysDate,sysDate,"",sysDate,h,"NA","Fund Transfer","NA","R",null,"","NA","");if(p.getSuccess())logDebug("Successfully did fund transfer to : "+t.getCustomID());else logDebug("**ERROR: doing fund transfer to ("+t.getCustomID()+"): "+p.getErrorMessage());var n=aa.finance.getPaymentByCapID(t,null).getOutput();for(ik in n){var r=new Array;var i=new Array;var s=new Array;var o=n[ik];var d=0;var v=o.getAmountNotAllocated();if(v>0){var m=aa.finance.getInvoiceByCapID(t,null).getOutput();for(var g in m){var y=m[g];var b=y.getInvoiceModel().getBalanceDue();if(b>0){feeT=aa.invoice.getFeeItemInvoiceByInvoiceNbr(y.getInvNbr()).getOutput();for(targetFeeNum in feeT){var w=feeT[targetFeeNum];if(w.getFee()>v)d=v;else d=w.getFee();v=v-d;r.push(w.getFeeSeqNbr());i.push(y.getInvNbr());s.push(d)}}}applyResult=aa.finance.applyPayment(t,o,r,i,s,"PAYSTAT","INVSTAT","123");if(applyResult.getSuccess())logDebug("Successfully applied payment");else logDebug("**ERROR: applying payment to fee ("+w.getFeeDescription()+"): "+applyResult.getErrorMessage())}}}function transferFunds(e,t){var n=parseFloat(t);if(isNaN(n)){logDebug("dollarAmount parameter is not a number, no funds will be transferred");return false}var r=paymentGetNotAppliedTot();if(r<parseFloat(t)){logDebug("Insufficient funds $"+r.toString()+" available. Fund transfer of $"+t.toString()+" not done.");logMessage("Insufficient funds available. No funds transferred.");return false}var i=aa.cap.getCapID(e);if(i.getSuccess()){var s=i.getOutput();var o=aa.finance.makeFundTransfer(capId,s,currentUserID,"","",sysDate,sysDate,"",sysDate,t,"NA","Fund Transfer","NA","R",null,"","NA","");if(o.getSuccess())logDebug("Successfully did fund transfer to : "+e);else logDebug("**ERROR: doing fund transfer to ("+e+"): "+o.getErrorMessage())}else{logDebug("**ERROR: getting parent cap id ("+e+"): "+i.getErrorMessage())}}function transferReceiptAndApply(e,t){var n=parseFloat(aa.cashier.getSumNotAllocated(e).getOutput());var r=aa.cashier.getTotalFeeAmount(t);var i=0;if(r.getSuccess()){i=r.getOutput()}var s=i;if(n<=0){logDebug("insufficient funds to do transfer from receipt record");return false}if(n<i){s=n}var o=aa.finance.makeFundTransfer(e,t,currentUserID,"","",sysDate,sysDate,"",sysDate,s,"NA","Fund Transfer","NA","R",null,"","NA","");if(o.getSuccess())logDebug("Successfully transferred $"+s+" from "+e+" to "+t);else logDebug("Error transferring funds "+o.getErrorMessage());var u=aa.finance.getPaymentByCapID(t,null).getOutput();for(ik in u){var a=new Array;var f=new Array;var l=new Array;var c=u[ik];var h=0;var p=c.getAmountNotAllocated();if(p>0){var d=aa.finance.getInvoiceByCapID(t,null).getOutput();for(var v in d){var m=d[v];var g=m.getInvoiceModel().getBalanceDue();if(g>0){feeT=aa.invoice.getFeeItemInvoiceByInvoiceNbr(m.getInvNbr()).getOutput();for(targetFeeNum in feeT){var y=feeT[targetFeeNum];if(y.getFee()>p)h=p;else h=y.getFee();p=p-h;a.push(y.getFeeSeqNbr());f.push(m.getInvNbr());l.push(h)}}}applyResult=aa.finance.applyPayment(t,c,a,f,l,"PAYSTAT","INVSTAT","123");if(applyResult.getSuccess()){logDebug("Successfully applied payment");return s}else{logDebug("**ERROR: applying payment to fee ("+y.getFeeDescription()+"): "+applyResult.getErrorMessage());return false}}}}function updateAppStatus(e,t){var n=capId;if(arguments.length==3)n=arguments[2];var r=aa.cap.updateAppStatus(n,"APPLICATION",e,sysDate,t,systemUserObj);if(r.getSuccess())logDebug("Updated application status to "+e+" successfully.");else logDebug("**ERROR: application status update to "+e+" was unsuccessful.  The reason is "+r.getErrorType()+":"+r.getErrorMessage())}function updateEnfOfficer(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();cd.setEnforceOfficerName(e);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("updated enf officer name to "+e)}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function updateFee(e,t,n,r,i,s,o){if(s==null||s.length==0)s="Y";else s=s.toUpperCase();var u=false;var a=r;var f=null;feeUpdated=false;if(o==null)getFeeResult=aa.finance.getFeeItemByFeeCode(capId,e,n);else getFeeResult=aa.finance.getFeeItemByPK(capId,o);if(getFeeResult.getSuccess()){if(o==null)var l=getFeeResult.getOutput();else{var l=new Array;l[0]=getFeeResult.getOutput()}for(feeNum in l){if(l[feeNum].getFeeitemStatus().equals("INVOICED")){if(s=="Y"){logDebug("Invoiced fee "+e+" found, subtracting invoiced amount from update qty.");a=a-l[feeNum].getFeeUnit();u=true}else{u=true;logDebug("Invoiced fee "+e+" found.  Not updating this fee. Not assessing new fee "+e)}}if(l[feeNum].getFeeitemStatus().equals("NEW")){a=a-l[feeNum].getFeeUnit()}}for(feeNum in l)if(l[feeNum].getFeeitemStatus().equals("NEW")&&!feeUpdated){var f=l[feeNum].getFeeSeqNbr();var c=aa.finance.editFeeItemUnit(capId,a+l[feeNum].getFeeUnit(),f);feeUpdated=true;if(c.getSuccess()){logDebug("Updated Qty on Existing Fee Item: "+e+" to Qty: "+r);if(i=="Y"){feeSeqList.push(f);paymentPeriodList.push(n)}}else{logDebug("**ERROR: updating qty on fee item ("+e+"): "+c.getErrorMessage());break}}}else{logDebug("**ERROR: getting fee items ("+e+"): "+getFeeResult.getErrorMessage())}if(!feeUpdated&&a!=0&&(!u||u&&s=="Y"))f=addFee(e,t,n,a,i);else f=null;updateFeeItemInvoiceFlag(f,i);return f}function updateFeeItemInvoiceFlag(e,t){if(e==null)return;if(publicUser&&!cap.isCompleteCap()){var n=aa.finance.getFeeItemByPK(capId,e);if(n.getSuccess){var r=n.getOutput().getF4FeeItem();r.setAutoInvoiceFlag(t);aa.finance.editFeeItem(r)}}}function updateGuidesheetASIField(e,t,n,r,i,s,o){var u=capId;var a=aa.inspection.getInspections(u);if(a.getSuccess()){var f=a.getOutput();for(h in f){if(f[h].getIdNumber()==e){var l=f[h].getInspection();var c=l.getGuideSheets();if(c){for(var h=0;h<c.size();h++){var p=c.get(h);if(p&&t.toUpperCase()==p.getGuideType().toUpperCase()){var d=p.getItems();for(var v=0;v<d.size();v++){var m=d.get(v);if(m&&n==m.getGuideItemText()&&r==m.getGuideItemASIGroupName()){var g=m.getItemASISubgroupList();if(g){for(var y=0;y<g.size();y++){var b=g.get(y);if(b&&b.getSubgroupCode()==i){var w=b.getAsiList();if(w){for(var E=0;E<w.size();E++){var S=w.get(E);if(S&&S.getAsiName()==s){logDebug("Change ASI value from:"+S.getAttributeValue()+" to "+o);S.setAttributeValue(o)}}}}}}}}var x=aa.guidesheet.updateGGuidesheet(p,p.getAuditID());if(x.getSuccess()){logDebug("Successfully updated "+t+" on inspection "+e+".");return true}else{logDebug("Could not update guidesheet ID: "+x.getErrorMessage());return false}}}}else{logDebug("No guidesheets for this inspection");return false}}}}else{logDebug("No inspections on the record");return false}logDebug("No updates to the guidesheet made");return false}function updateGuidesheetID(e,t,n){var r=capId;if(arguments>2)r=arguments[2];var s=aa.inspection.getInspections(r);if(s.getSuccess()){var o=s.getOutput();for(i in o){if(o[i].getIdNumber()==e){var u=o[i].getInspection();var a=u.getGuideSheets();if(a){gsArray=a.toArray();for(var f in gsArray){if(t.toUpperCase()==gsArray[f].getGuideType().toUpperCase()){gsArray[f].setIdentifier(n);var l=aa.guidesheet.updateGGuidesheet(gsArray[f],gsArray[f].getAuditID());if(l.getSuccess()){logDebug("Successfully updated "+t+" on inspection "+e+" to and ID of "+n);return true}else{logDebug("Could not update guidesheet ID: "+l.getErrorMessage());return false}}}}else{logDebug("No guidesheets for this inspection");return false}}}}else{logDebug("No inspections on the record");return false}logDebug("No updates to the guidesheet made");return false}function updateRefParcelToCap(){var e=null;if(arguments.length>0)e=arguments[0];else e=capId;var t=aa.parcel.getParcelDailyByCapID(e,null).getOutput();if(t!=null){for(x in t){var n=aa.parcel.getParceListForAdmin(t[x].getParcelNumber(),null,null,null,null,null,null,null,null,null);if(n.getSuccess()){var r=n.getOutput();if(r.length){var i=r[0].getParcelModel();var s=i.getParcelNumber();var o=aa.parcel.warpCapIdParcelModel2CapParcelModel(e,i);if(o.getSuccess()){var u=o.getOutput();u.setL1ParcelNo(s);aa.parcel.updateDailyParcelWithAPOAttribute(u);logDebug("Updated Parcel "+t[x].getParcelNumber()+" with Reference Data")}else logDebug("Failed to Wrap Parcel Model for "+t[x].getParcelNumber())}else logDebug("No matching reference Parcels found for "+t[x].getParcelNumber())}else logDebug("Failed to get reference Parcel for "+t[x].getParcelNumber())}}}function updateShortNotes(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapDetail(t);if(!n.getSuccess()){logDebug("**ERROR: No cap detail script object : "+n.getErrorMessage());return false}var r=n.getOutput();if(!r){logDebug("**ERROR: No cap detail script object");return false}cd=r.getCapDetailModel();cd.setShortNotes(e);cdWrite=aa.cap.editCapDetail(cd);if(cdWrite.getSuccess()){logDebug("updated short notes to "+e)}else{logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage());return false}}function updateTask(e,t,n,r){var s=false;var o="";if(arguments.length>4){if(arguments[4]!=""){o=arguments[4];s=true}}var u=capId;if(arguments.length==6)u=arguments[5];var a=aa.workflow.getTaskItems(u,e,o,null,null,null);if(a.getSuccess())var f=a.getOutput();else{logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}if(!t)t="NA";for(i in f){var l=f[i];if(l.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!s||l.getProcessCode().equals(o))){var c=aa.date.getCurrentDate();var h=l.getStepNumber();var p=l.getProcessID();if(s)aa.workflow.handleDisposition(u,h,p,t,c,r,n,systemUserObj,"U");else aa.workflow.handleDisposition(u,h,t,c,r,n,systemUserObj,"U");logMessage("Updating Workflow Task "+e+" with status "+t);logDebug("Updating Workflow Task "+e+" with status "+t)}}}function updateTaskAssignedDate(e,t){var n=false;var r="";if(arguments.length==3){r=arguments[2];n=true}var s=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(s.getSuccess())var o=s.getOutput();else{logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(i in o){var u=o[i];if(u.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!n||u.getProcessCode().equals(r))){var a=aa.util.now();var f=new Date(t);a.setTime(f.getTime());if(a){var l=u.getTaskItem();l.setAssignmentDate(a);var c=aa.workflow.adjustTaskWithNoAudit(l);if(c.getSuccess())logDebug("Updated Workflow Task : "+e+" Assigned Date to "+t);else logDebug("Error updating wfTask : "+c.getErrorMessage())}else logDebug("Couldn't update assigned date.  Invalid date : "+t)}}}function updateTaskDepartment(e,t){var n=false;var r="";if(arguments.length==3){r=arguments[2];n=true}var i=aa.workflow.getTaskItems(capId,e,r,null,null,null);if(i.getSuccess())wfObj=i.getOutput();else{logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage());return false}for(var s in wfObj){fTask=wfObj[s];if(fTask.getTaskDescription().toUpperCase().equals(e.toUpperCase())&&(!n||fTask.getProcessCode().equals(r))){if(t){var o=fTask.getTaskItem().getAssignedUser();o.setDeptOfUser(t);fTask.setAssignedUser(o);var u=fTask.getTaskItem();var a=aa.workflow.assignTask(u);if(a.getSuccess())logDebug("Updated Workflow Task : "+e+" Department Set to "+t);else logDebug("Error updating wfTask : "+a.getErrorMessage())}else logDebug("Couldn't update Department.  Invalid department : "+t)}}}function updateWorkDesc(e){var t=capId;if(arguments.length>1)t=arguments[1];var n=aa.cap.getCapWorkDesByPK(t);var r;if(!n.getSuccess()){aa.print("**ERROR: Failed to get work description: "+n.getErrorMessage());return false}var i=n.getOutput();if(i){r=i.getCapWorkDesModel()}else{aa.print("**ERROR: Failed to get workdes Obj: "+n.getErrorMessage());return false}r.setDescription(e);aa.cap.editCapWorkDes(r);aa.print("Updated Work Description to : "+e)}function validateGisObjects(){var e=aa.gis.getCapGISObjects(capId);if(e.getSuccess())var t=e.getOutput();else{logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+e.getErrorType()+":"+e.getErrorMessage());return false}for(a1 in t){var n=aa.gis.getGISObjectAttributes(t[a1]);if(n.getSuccess())var r=n.getOutput();else{logDebug("**WARNING: Retrieving GIS Attributes.  Reason is: "+n.getErrorType()+":"+n.getErrorMessage());return false}if(r!=null)return true}}function verhoeff(){var e=new Array;e[0]=new Array(0,1,2,3,4,5,6,7,8,9);e[1]=new Array(1,5,7,6,2,8,3,0,9,4);for(var t=2;t<8;t++){e[t]=new Array;for(var n=0;n<10;n++)e[t][n]=e[t-1][e[1][n]]}Op=new Array;Op[0]=new Array(0,1,2,3,4,5,6,7,8,9);Op[1]=new Array(1,2,3,4,0,6,7,8,9,5);Op[2]=new Array(2,3,4,0,1,7,8,9,5,6);Op[3]=new Array(3,4,0,1,2,8,9,5,6,7);Op[4]=new Array(4,0,1,2,3,9,5,6,7,8);Op[5]=new Array(5,9,8,7,6,0,4,3,2,1);Op[6]=new Array(6,5,9,8,7,1,0,4,3,2);Op[7]=new Array(7,6,5,9,8,2,1,0,4,3);Op[8]=new Array(8,7,6,5,9,3,2,1,0,4);Op[9]=new Array(9,8,7,6,5,4,3,2,1,0);Inv=new Array(0,4,3,2,1,5,6,7,8,9);reverse_str=function(e){var t="";for(var n=e.length-1;n>=0;n--)t=t+e.charAt(n);return t};this.check=function(t){var n=reverse_str(t);var r=0;for(var i=0;i<n.length;i++)r=Op[r][e[i%8][n.charAt(i)]];if(r!=0)return false;else return true};this.compute=function(t){var n="x"+reverse_str(t);var r=0;for(var i=1;i<n.length;i++)r=Op[r][e[i%8][n.charAt(i)]];return t+Inv[r]}}function workDescGet(e){var t=aa.cap.getCapWorkDesByPK(e);if(!t.getSuccess()){logDebug("**ERROR: Failed to get work description: "+t.getErrorMessage());return false}var n=t.getOutput();var r=n.getDescription();return r}function zeroPad(e,t){var n=e+"";while(n.length<t){n="0"+n}return n}String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/,"")};String.prototype.left=function(e){return this.substr(0,e)};String.prototype.right=function(e){return this.substr(this.length-e,this.length)}